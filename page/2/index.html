<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/logo.png" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.20/fancybox/fancybox.css" integrity="sha256-RvRHGSuWAxZpXKV9lLDt2e+rZ+btzn48Wp4ueS3NZKs=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"ancao96.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.18.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":"mac"},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":true,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":true,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"algolia":{"appID":"BFJCK79VF9","apiKey":"613fe5e83863193288c6ef2ab02cefad","indexName":"hexo","hits":{"per_page":10}}}</script><script src="/js/config.js"></script>

    <meta property="og:type" content="website">
<meta property="og:title" content="SCY SPACE">
<meta property="og:url" content="https://ancao96.github.io/page/2/index.html">
<meta property="og:site_name" content="SCY SPACE">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="SCY">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://ancao96.github.io/page/2/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/2/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>SCY SPACE</title>
    







<link rel="dns-prefetch" href="https://waline-server-nxpj3ksyo-scy.vercel.app">
    <noscript>
      <link rel="stylesheet" href="/css/noscript.css">
    </noscript>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lxgw-wenkai-lite-webfont@1.0.0/style.css">
    <style>
      body,div.post-body,h1,h2,h3,h4 {
        font-family: "LXGW WenKai LITE", sans-serif;
        font-size: 108%;
      }
    </style>
  </head>
  <body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
    <div class="headband"></div>
    <main class="main">
      <div class="column">
        <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">SCY SPACE</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">6</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">6</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">20</span></a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container"></div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container">
  <div class="algolia-stats"><hr></div>
  <div class="algolia-hits"></div>
  <div class="algolia-pagination"></div>
</div>

    </div>
  </div>

</header>
          
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="SCY" src="/images/avatar.gif">
  <p class="site-author-name" itemprop="name">SCY</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">20</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/AnCao96" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;AnCao96" rel="external nofollow noopener noreferrer" target="_blank"><i class="fab fa-github fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:ancao.cugb@gmail.com" title="E-Mail → mailto:ancao.cugb@gmail.com" rel="external nofollow noopener noreferrer" target="_blank"><i class="fa fa-envelope fa-fw"></i></a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
        <div class="pjax">
        </div>
  </aside>


      </div>
      <div class="main-inner index posts-expand">

    


<div class="post-block">
    
    

    <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
        <link itemprop="mainEntityOfPage" href="https://ancao96.github.io/2023/08/18/2023-8-18-9%E5%9C%B0%E7%90%86%E6%95%B0%E6%8D%AE%E5%88%B6%E5%9B%BE/">

        <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
            <meta itemprop="image" content="/images/avatar.gif">
            <meta itemprop="name" content="SCY">
        </span>

        <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
            <meta itemprop="name" content="SCY SPACE">
            <meta itemprop="description" content>
        </span>

        <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
            <meta itemprop="name" content="undefined | SCY SPACE">
            <meta itemprop="description" content>
        </span>
        <header class="post-header">
            <h2 class="post-title" itemprop="name headline">
                <a href="/2023/08/18/2023-8-18-9%E5%9C%B0%E7%90%86%E6%95%B0%E6%8D%AE%E5%88%B6%E5%9B%BE/" class="post-title-link" itemprop="url">(9)地理数据制图</a>
            </h2>

            <div class="post-meta-container">
                <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-08-18 06:35:20" itemprop="dateCreated datePublished" datetime="2023-08-18T06:35:20+08:00">2023-08-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-09-06 20:03:07" itemprop="dateModified" datetime="2023-09-06T20:03:07+08:00">2023-09-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/R/" itemprop="url" rel="index"><span itemprop="name">R</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/R/Geocomputaion/" itemprop="url" rel="index"><span itemprop="name">Geocomputaion</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Waline：</span>
  
    <a title="waline" href="/2023/08/18/2023-8-18-9%E5%9C%B0%E7%90%86%E6%95%B0%E6%8D%AE%E5%88%B6%E5%9B%BE/#waline" itemprop="discussionUrl">
      <span class="post-comments-count waline-comment-count" data-path="/2023/08/18/2023-8-18-9%E5%9C%B0%E7%90%86%E6%95%B0%E6%8D%AE%E5%88%B6%E5%9B%BE/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>12k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>45 分钟</span>
    </span>
</div>

            </div>
        </header>

        
        
        
        <div class="post-body" itemprop="articleBody">
            <h1 id="地理数据制图">(9)地理数据制图</h1>
<p>前提条件</p>
<ul>
<li>本章需要使用我们已经在使用的以下包：</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">library<span class="punctuation">(</span>sf<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>terra<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>dplyr<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>spData<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>spDataLarge<span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<ul>
<li>此外，本章还使用以下可视化包（如果您想开发交互式地图应用程序，请安装shiny）：</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># remotes::install_github(&quot;r-tmap/tmap@v4&quot;)</span></span><br><span class="line">library<span class="punctuation">(</span>tmap<span class="punctuation">)</span>    <span class="comment"># for static and interactive maps</span></span><br><span class="line">library<span class="punctuation">(</span>leaflet<span class="punctuation">)</span> <span class="comment"># for interactive maps</span></span><br><span class="line">library<span class="punctuation">(</span>ggplot2<span class="punctuation">)</span> <span class="comment"># tidyverse data visualization package</span></span><br></pre></td></tr></table></figure>
<ul>
<li>您还需要按照以下方式读取几个数据集，以进行<em>栅格数据的空间操作</em>部分的内容：</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nz_elev <span class="operator">=</span> rast<span class="punctuation">(</span>system.file<span class="punctuation">(</span><span class="string">&quot;raster/nz_elev.tif&quot;</span><span class="punctuation">,</span> package <span class="operator">=</span> <span class="string">&quot;spDataLarge&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<h2 id="引言">引言</h2>
<p>地理研究中令人满意和重要的一个方面是传达研究结果。制图——地图制作的艺术——是一项古老的技能，涉及沟通、细节关注和创造性元素。在R中进行静态制图非常简单，可以使用<code>plot()</code>函数。通过使用基本R方法，可以创建高级地图。然而，本章的重点是使用专门的制图包进行地图制作。在学习新技能时，首先在一个领域深入掌握知识，然后再进行扩展，这是合乎情理的做法。制图也不例外，因此本章深入介绍了一个包（<strong>tmap</strong>），而不是浅尝辄止地介绍多个包。</p>
<p>除了有趣和富有创意外，制图还具有重要的实际应用。精心制作的地图可能是传达工作结果的最佳方式，但设计不良的地图可能会留下不好的印象。常见的设计问题包括文本的位置、大小和可读性差，以及颜色的选择不慎，正如《地图杂志》的风格<a target="_blank" rel="external nofollow noopener noreferrer" href="https://www.tandf.co.uk//journals/authors/style/TJOM-suppmaterial-quick-guide.pdf">指南</a>中所述。此外，糟糕的地图制作可能会妨碍结果的传达：</p>
<blockquote>
<p>看起来业余的地图可能会削弱您的受众理解重要信息的能力，减弱专业数据调查的呈现效果。
数千年来，地图已被用于各种各样的目的。
历史上的例子包括3000多年前的旧巴比伦王朝的建筑和土地所有权地图，以及近2000年前托勒密在他的杰作<em>地理学</em>中的世界地图。</p>
</blockquote>
<p>制图活动在历史上曾经只由精英或代表精英进行。随着开源地图制作软件的出现，如R包<strong>tmap</strong>和QGIS中的'print
composer'，任何人都可以制作高质量的地图，从而实现了'公民科学'。地图也常常是以易于理解的方式呈现地理计算研究结果的最佳途径。制图因此是地理计算的关键部分，它不仅强调描述世界，还强调<em>改变</em>世界。</p>
<p>本章介绍了如何制作各种类型的地图。接下来的部分将涵盖静态地图的各种情况，包括美学考虑、分面和插图地图。部分章节将介绍动态和交互式地图（包括网络地图和地图应用程序）。最
后，将介绍一系列备选的地图制作包，包括<strong>ggplot2</strong>和<strong>cartogram</strong>。</p>
<h2 id="静态地图">静态地图</h2>
<p>静态地图是地理计算的最常见的可视输出类型。它们通常以标准格式保存，包括
<code>.png</code>和<code>.pdf</code>用于图形光栅和矢量输出。最初，静态地图是R唯一能够生成的地图类型。随着<strong>sp</strong>的发布[<a href="mailto:见@pebesma" class="email" rel="external nofollow noopener noreferrer" target="_blank">见@pebesma</a>_classes_2005]，自那时以来，许多地图制作技术、函数和软件包得到了发展。然而，尽管有交互式地图的创新，静态绘图仍然是十年后R中地理数据可视化的重点。</p>
<p>通用的 <code>plot()</code>
函数是从矢量和栅格空间对象创建静态地图的最快方法。有时，在项目开发阶段，简单性和速度是首要考虑的因素，这就是
<code>plot()</code> 函数的优势所在。 基本的 R
方法也是可扩展的，<code>plot()</code>
函数提供了许多参数选项。另一种方法是使用 <strong>grid</strong>
软件包，它允许对静态地图进行低级别的控制，如 <span class="citation" data-cites="murrell_r_2016">@murrell_r_2016</span> 的第 <a target="_blank" rel="external nofollow noopener noreferrer" href="https://www.stat.auckland.ac.nz/~paul/RG2e/chapter14.html">14</a>
章所示。本书的这部分将重点介绍
<strong>tmap</strong>，并强调其基本的美学和布局选项。</p>
<p><strong>tmap</strong>是一个功能强大且灵活的制图软件包，具有合理的默认设置。它具有简洁的语法，允许使用最少的代码创建具有吸引力的地图，这对于
<strong>ggplot2</strong>
用户来说会非常熟悉。它还具有独特的功能，通过<code>tmap_mode()</code>可以生成静态和交互式地图，使用相同的代码。最后，它接受比其他替代方案（如
<strong>ggplot2</strong>）更广泛的空间类别（包括 <strong>sf</strong> 和
<strong>terra</strong> 对象）。 <!--toDo:jn-->
<!-- update the below vignettes links -->
<!-- (see the vignettes [`tmap-getstarted`](https://cran.r-project.org/web/packages/tmap/vignettes/tmap-getstarted.html) and [`tmap-changes-v2`](https://cran.r-project.org/web/packages/tmap/vignettes/tmap-changes-v2.html), as well as @tennekes_tmap_2018, for further documentation). --></p>
<h3 id="tmap-基础">tmap 基础</h3>
<p>与<strong>ggplot2</strong>类似，<strong>tmap</strong>基于"图形语法"的理念。这涉及将输入数据与美学（数据如何可视化）分离：每个输入数据集可以通过多种不同的方式进行"映射"，包括在地图上的位置（由数据的<code>geometry</code>定义）、颜色和其他视觉变量。基本构建块是
<code>tm_shape()</code>（定义输入数据：矢量或栅格对象），然后是一个或多个图层元素，如
<code>tm_fill()</code> 和
<code>tm_dots()</code>。以下代码块演示了这种分层结构，生成了图中呈现的地图：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Add fill layer to nz shape</span></span><br><span class="line">tm_shape<span class="punctuation">(</span>nz<span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  tm_fill<span class="punctuation">(</span><span class="punctuation">)</span> </span><br><span class="line"><span class="comment"># Add border layer to nz shape</span></span><br><span class="line">tm_shape<span class="punctuation">(</span>nz<span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  tm_borders<span class="punctuation">(</span><span class="punctuation">)</span> </span><br><span class="line"><span class="comment"># Add fill and border layers to nz shape</span></span><br><span class="line">tm_shape<span class="punctuation">(</span>nz<span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  tm_fill<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  tm_borders<span class="punctuation">(</span><span class="punctuation">)</span> </span><br></pre></td></tr></table></figure>
<p><img data-src="https://scy11.oss-cn-beijing.aliyuncs.com/img/202309031738903.png">
New Zealand's shape plotted with fill (left), border (middle) and fill
and border (right) layers added using tmap functions.</p>
<p>在这种情况下，传递给<code>tm_shape()</code>的对象是<code>nz</code>，一个代表新西兰各个地区的<code>sf</code>对象。添加图层以在视觉上表示<code>nz</code>，使用<code>tm_fill()</code>和<code>tm_borders()</code>分别在上图的左侧面板和中间面板中创建了阴影区。</p>
<ul>
<li><code>tm_fill()</code>: （多）多边形的阴影区域</li>
<li><code>tm_borders()</code>: （多）多边形的边界轮廓</li>
<li><code>tm_polygons()</code>: （多）多边形的阴影区域和边界轮廓</li>
<li><code>tm_lines()</code>: （多）线串的线条</li>
<li><code>tm_symbols()</code>: （多）点、线串和多边形的符号</li>
<li><code>tm_raster()</code>:
栅格数据的彩色单元格（也有用于具有三个图层的栅格的
<code>tm_rgb()</code>）</li>
<li><code>tm_text()</code>: （多）点、线串和多边形的文本信息</li>
</ul>
<!--toDo: jn-->
<!-- update help link -->
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 请参阅 `help(&quot;tmap-element&quot;)` 获取所有可能的图层类型的完整列表。这种图层叠加效果在图的右侧面板中得以体现，这是在填充图层之上添加了边界。 --&gt;</span><br></pre></td></tr></table></figure>
<!--toDo: jn-->
<!-- update when/if -->
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--</span><br><span class="line">&gt; `qtm()` 是一个方便的函数，用于创建快速、主题、地图（因此取了一个简洁的名字）。</span><br><span class="line">它非常简洁，对许多情况下都提供了很好的默认可视化效果：例如，`qtm(nz)` 等同于 `tm_shape(nz) + tm_fill() + tm_borders()`。</span><br><span class="line">此外，可以使用多个 `qtm()` 调用简洁地添加图层，例如 `qtm(nz) + qtm(nz_height)`。</span><br><span class="line">缺点是它使得单个图层的美学更难以控制，这就解释了为什么我们在本章中避免教授它。</span><br><span class="line">--&gt;</span><br></pre></td></tr></table></figure>
<h3 id="地图对象">地图对象</h3>
<p><strong>tmap</strong>
的一个有用特性是它能够存储代表地图的<em>对象</em>。下面的代码块演示了这一点，通过将上图中的最后一个绘图保存为一个<code>tmap</code>类型的对象（注意使用了<code>tm_polygons()</code>，它将<code>tm_fill()+tm_borders()</code>结合成一个函数）：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">map_nz <span class="operator">=</span> tm_shape<span class="punctuation">(</span>nz<span class="punctuation">)</span> <span class="operator">+</span> tm_polygons<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"><span class="built_in">class</span><span class="punctuation">(</span>map_nz<span class="punctuation">)</span></span><br><span class="line"><span class="comment">#&gt; [1] &quot;tmap&quot;</span></span><br></pre></td></tr></table></figure>
<p><code>map_nz</code>可以进行绘图，例如添加额外的图层（如下所示），或者只需在控制台中运行
<code>map_nz</code>，这相当于 <code>print(map_nz)</code>。</p>
<p>可以使用 <code>+ tm_shape(new_obj)</code>
添加新的<em>shapes</em>。在这种情况下，<code>new_obj</code>表示要绘制在之前图层之上的新的空间对象。当以这种方式添加新的形状shape时，所有后续的美学函数都会与它相关联，直到添加另一个新的shape为止。这种语法允许创建具有多个形状和图层的地图，如下面的代码块所示，使用函数
<code>tm_raster()</code>绘制一个栅格图层（设置<code>col_alpha</code>
使图层半透明）：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">map_nz1 <span class="operator">=</span> map_nz <span class="operator">+</span></span><br><span class="line">  tm_shape<span class="punctuation">(</span>nz_elev<span class="punctuation">)</span> <span class="operator">+</span> tm_raster<span class="punctuation">(</span>col_alpha <span class="operator">=</span> <span class="number">0.7</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<!--toDo: jn-->
<!-- explain the SpatRaster object downsampled to 1141 by 877 cells. message -->
<p>Building on the previously created <code>map_nz</code> object, the
preceding code creates a new map object <code>map_nz1</code> that
contains another shape (<code>nz_elev</code>) representing average
elevation across New Zealand (see Figure @ref(fig:tmlayers), left). More
shapes and layers can be added, as illustrated in the code chunk below
which creates <code>nz_water</code>, representing New Zealand's <a target="_blank" rel="external nofollow noopener noreferrer" href="https://en.wikipedia.org/wiki/Territorial_waters">territorial
waters</a>, and adds the resulting lines to an existing map object.</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">nz_water <span class="operator">=</span> st_union<span class="punctuation">(</span>nz<span class="punctuation">)</span> <span class="operator">|&gt;</span></span><br><span class="line">  st_buffer<span class="punctuation">(</span><span class="number">22200</span><span class="punctuation">)</span> <span class="operator">|&gt;</span> </span><br><span class="line">  st_cast<span class="punctuation">(</span>to <span class="operator">=</span> <span class="string">&quot;LINESTRING&quot;</span><span class="punctuation">)</span></span><br><span class="line">map_nz2 <span class="operator">=</span> map_nz1 <span class="operator">+</span></span><br><span class="line">  tm_shape<span class="punctuation">(</span>nz_water<span class="punctuation">)</span> <span class="operator">+</span> tm_lines<span class="punctuation">(</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<p>There is no limit to the number of layers or shapes that can be added
to <code>tmap</code> objects, and the same shape can even be used
multiple times. The final map illustrated in Figure @ref(fig:tmlayers)
is created by adding a layer representing high points (stored in the
object <code>nz_height</code>) onto the previously created
<code>map_nz2</code> object with <code>tm_symbols()</code> (see
<code>?tm_symbols</code> for details on <strong>tmap</strong>'s point
plotting functions). The resulting map, which has four layers, is
illustrated in the right-hand panel of Figure @ref(fig:tmlayers):</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">map_nz3 <span class="operator">=</span> map_nz2 <span class="operator">+</span></span><br><span class="line">  tm_shape<span class="punctuation">(</span>nz_height<span class="punctuation">)</span> <span class="operator">+</span> tm_symbols<span class="punctuation">(</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<p>A useful and little known feature of <strong>tmap</strong> is that
multiple map objects can be arranged in a single 'metaplot' with
<code>tmap_arrange()</code>. This is demonstrated in the code chunk
below which plots <code>map_nz1</code> to <code>map_nz3</code>,
resulting in Figure @ref(fig:tmlayers).</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tmap_arrange<span class="punctuation">(</span>map_nz1<span class="punctuation">,</span> map_nz2<span class="punctuation">,</span> map_nz3<span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<div class="figure" style="text-align: center">
<img data-src="09-mapping_files/figure-html/tmlayers-1.png" alt="Maps with additional layers added to the final map of Figure 9.1." width="100%">
<p class="caption">
(#fig:tmlayers)Maps with additional layers added to the final map of
Figure 9.1.
</p>
</div>
<p>More elements can also be added with the <code>+</code> operator.
Aesthetic settings, however, are controlled by arguments to layer
functions.</p>
<h3 id="可视化变量">可视化变量</h3>
<p>The plots in the previous section demonstrate <strong>tmap</strong>'s
default aesthetic settings. Gray shades are used for
<code>tm_fill()</code> and <code>tm_symbols()</code> layers and a
continuous black line is used to represent lines created with
<code>tm_lines()</code>. Of course, these default values and other
aesthetics can be overridden. The purpose of this section is to show
how.</p>
<p>There are two main types of map aesthetics: those that change with
the data and those that are constant. Unlike <strong>ggplot2</strong>,
which uses the helper function <code>aes()</code> to represent variable
aesthetics, <strong>tmap</strong> accepts a few aesthetic arguments,
depending on a selected layer type:</p>
<ul>
<li><code>fill</code>: fill color of a polygon</li>
<li><code>col</code>: color of a polygon border, line, point, or
raster</li>
<li><code>lwd</code>: line width</li>
<li><code>lty</code>: line type</li>
<li><code>size</code>: size of a symbol</li>
<li><code>shape</code>: shape of a symbol</li>
</ul>
<p>Additionally, we may customize the fill and border color transparency
using <code>fill_alpha</code> and <code>col_alpha</code>.</p>
<p>To map a variable to an aesthetic, pass its column name to the
corresponding argument, and to set a fixed aesthetic, pass the desired
value instead.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> The impact of setting these with
fixed values is illustrated in Figure @ref(fig:tmstatic).</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ma1 <span class="operator">=</span> tm_shape<span class="punctuation">(</span>nz<span class="punctuation">)</span> <span class="operator">+</span> tm_polygons<span class="punctuation">(</span>fill <span class="operator">=</span> <span class="string">&quot;red&quot;</span><span class="punctuation">)</span></span><br><span class="line">ma2 <span class="operator">=</span> tm_shape<span class="punctuation">(</span>nz<span class="punctuation">)</span> <span class="operator">+</span> tm_polygons<span class="punctuation">(</span>fill <span class="operator">=</span> <span class="string">&quot;red&quot;</span><span class="punctuation">,</span> fill_alpha <span class="operator">=</span> <span class="number">0.3</span><span class="punctuation">)</span></span><br><span class="line">ma3 <span class="operator">=</span> tm_shape<span class="punctuation">(</span>nz<span class="punctuation">)</span> <span class="operator">+</span> tm_polygons<span class="punctuation">(</span>col <span class="operator">=</span> <span class="string">&quot;blue&quot;</span><span class="punctuation">)</span></span><br><span class="line">ma4 <span class="operator">=</span> tm_shape<span class="punctuation">(</span>nz<span class="punctuation">)</span> <span class="operator">+</span> tm_polygons<span class="punctuation">(</span>lwd <span class="operator">=</span> <span class="number">3</span><span class="punctuation">)</span></span><br><span class="line">ma5 <span class="operator">=</span> tm_shape<span class="punctuation">(</span>nz<span class="punctuation">)</span> <span class="operator">+</span> tm_polygons<span class="punctuation">(</span>lty <span class="operator">=</span> <span class="number">2</span><span class="punctuation">)</span></span><br><span class="line">ma6 <span class="operator">=</span> tm_shape<span class="punctuation">(</span>nz<span class="punctuation">)</span> <span class="operator">+</span> tm_polygons<span class="punctuation">(</span>fill <span class="operator">=</span> <span class="string">&quot;red&quot;</span><span class="punctuation">,</span> fill_alpha <span class="operator">=</span> <span class="number">0.3</span><span class="punctuation">,</span></span><br><span class="line">                                 col <span class="operator">=</span> <span class="string">&quot;blue&quot;</span><span class="punctuation">,</span> lwd <span class="operator">=</span> <span class="number">3</span><span class="punctuation">,</span> lty <span class="operator">=</span> <span class="number">2</span><span class="punctuation">)</span></span><br><span class="line">tmap_arrange<span class="punctuation">(</span>ma1<span class="punctuation">,</span> ma2<span class="punctuation">,</span> ma3<span class="punctuation">,</span> ma4<span class="punctuation">,</span> ma5<span class="punctuation">,</span> ma6<span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<div class="figure" style="text-align: center">
<img data-src="09-mapping_files/figure-html/tmstatic-1.png" alt="The impact of changing commonly used fill and border aesthetics to fixed values." width="100%">
<p class="caption">
(#fig:tmstatic)The impact of changing commonly used fill and border
aesthetics to fixed values.
</p>
</div>
<p>Like base R plots, arguments defining aesthetics can also receive
values that vary. Unlike the base R code below (which generates the left
panel in Figure @ref(fig:tmcol)), <strong>tmap</strong> aesthetic
arguments will not accept a numeric vector:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">plot<span class="punctuation">(</span>st_geometry<span class="punctuation">(</span>nz<span class="punctuation">)</span><span class="punctuation">,</span> col <span class="operator">=</span> nz<span class="operator">$</span>Land_area<span class="punctuation">)</span>  <span class="comment"># works</span></span><br><span class="line">tm_shape<span class="punctuation">(</span>nz<span class="punctuation">)</span> <span class="operator">+</span> tm_fill<span class="punctuation">(</span>col <span class="operator">=</span> nz<span class="operator">$</span>Land_area<span class="punctuation">)</span> <span class="comment"># fails</span></span><br><span class="line"><span class="comment">#&gt; Error: palette should be a character value</span></span><br></pre></td></tr></table></figure>
<p>Instead <code>col</code> (and other aesthetics that can vary such as
<code>lwd</code> for line layers and <code>size</code> for point layers)
requires a character string naming an attribute associated with the
geometry to be plotted. Thus, one would achieve the desired result as
follows (plotted in the right-hand panel of Figure @ref(fig:tmcol)):</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tm_shape<span class="punctuation">(</span>nz<span class="punctuation">)</span> <span class="operator">+</span> tm_fill<span class="punctuation">(</span>fill <span class="operator">=</span> <span class="string">&quot;Land_area&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<div class="figure" style="text-align: center">
<img data-src="09-mapping_files/figure-html/tmcol-1.png" alt="Comparison of base (left) and tmap (right) handling of a numeric color field." width="45%"><img data-src="09-mapping_files/figure-html/tmcol-2.png" alt="Comparison of base (left) and tmap (right) handling of a numeric color field." width="45%">
<p class="caption">
(#fig:tmcol)Comparison of base (left) and tmap (right) handling of a
numeric color field.
</p>
</div>
<p>Each visual variable has three related additional arguments, with
prefixes of <code>.scale</code>, <code>.legend</code>, and
<code>.free</code>. For example, the <code>tm_fill()</code> function has
arguments such as <code>fill</code>, <code>fill.scale</code>,
<code>fill.legend</code>, and <code>fill.free</code>. The
<code>.scale</code> argument determines how the provided values are
represented on the map and in the legend (Section @ref(scales)), while
the <code>.legend</code> argument is used to customize the legend
settings, such as its title, orientation, or position (Section
@ref(legends)). The <code>.free</code> argument is relevant only for
maps with many facets to determine if each facet has the same or
different scale and legend (Section @ref(faceted-maps)).</p>
<h3 id="标度">标度</h3>
<p> Scales control how the values are represented on the map and in the
legend, and largely depend on the selected visual variable. For example,
when our visual variable is <code>col</code>, then
<code>col.scale</code> controls how the colors of spatial objects are
related to the provided values; and when our visual variable is
<code>size</code>, then <code>size.scale</code> controls how the sizes
represent the provided values. By default, the used scale is
<code>tm_scale()</code>, which selects the visual settings automatically
given by the data type (factor, numeric, and integer).</p>
<p> Let's see how the scales work by customizing polygons' fill colors.
Color settings are an important part of map design -- they can have a
major impact on how spatial variability is portrayed as illustrated in
Figure @ref(fig:tmpal). This figure shows four ways of coloring regions
in New Zealand depending on median income, from left to right (and
demonstrated in the code chunk below):</p>
<ul>
<li>The default setting uses 'pretty' breaks, described in the next
paragraph</li>
<li><code>breaks</code> allows you to manually set the breaks</li>
<li><code>n</code> sets the number of bins into which numeric variables
are categorized</li>
<li><code>values</code> defines the color scheme, for example,
<code>BuGn</code></li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">tm_shape<span class="punctuation">(</span>nz<span class="punctuation">)</span> <span class="operator">+</span> tm_polygons<span class="punctuation">(</span>fill <span class="operator">=</span> <span class="string">&quot;Median_income&quot;</span><span class="punctuation">)</span></span><br><span class="line">tm_shape<span class="punctuation">(</span>nz<span class="punctuation">)</span> <span class="operator">+</span> tm_polygons<span class="punctuation">(</span>fill <span class="operator">=</span> <span class="string">&quot;Median_income&quot;</span><span class="punctuation">,</span></span><br><span class="line">                           fill.scale <span class="operator">=</span> tm_scale<span class="punctuation">(</span>breaks <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">30000</span><span class="punctuation">,</span> <span class="number">40000</span><span class="punctuation">,</span> <span class="number">50000</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">tm_shape<span class="punctuation">(</span>nz<span class="punctuation">)</span> <span class="operator">+</span> tm_polygons<span class="punctuation">(</span>fill <span class="operator">=</span> <span class="string">&quot;Median_income&quot;</span><span class="punctuation">,</span></span><br><span class="line">                           fill.scale <span class="operator">=</span> tm_scale<span class="punctuation">(</span>n <span class="operator">=</span> <span class="number">10</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">tm_shape<span class="punctuation">(</span>nz<span class="punctuation">)</span> <span class="operator">+</span> tm_polygons<span class="punctuation">(</span>fill <span class="operator">=</span> <span class="string">&quot;Median_income&quot;</span><span class="punctuation">,</span></span><br><span class="line">                           fill.scale <span class="operator">=</span> tm_scale<span class="punctuation">(</span>values <span class="operator">=</span> <span class="string">&quot;BuGn&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<div class="figure" style="text-align: center">
<img data-src="09-mapping_files/figure-html/tmpal-1.png" alt="Illustration of settings that affect color settings. The results show (from left to right): default settings, manual breaks, n breaks, and the impact of changing the palette." width="100%">
<p class="caption">
(#fig:tmpal)Illustration of settings that affect color settings. The
results show (from left to right): default settings, manual breaks, n
breaks, and the impact of changing the palette.
</p>
</div>

<div class="rmdnote">
All of the above arguments (<code>breaks</code>, <code>n</code>, and
<code>values</code>) also work for other types of visual variables. For
example, <code>values</code> expects a vector of colors or a palette
name for <code>fill.scale</code> or <code>col.scale</code>, a vector of
sizes for <code>size.scale</code>, or a vector of symbols for
<code>shape.scale</code>.
</div>
<p> We are also able to customize scales using a family of functions
that start with the <code>tm_scale_</code> prefix. The most important
ones are <code>tm_scale_intervals()</code>,
<code>tm_scale_continuous()</code>, and
<code>tm_scale_categorical()</code>.</p>
<p> The <code>tm_scale_intervals()</code> function splits the input data
values into a set of intervals. In addition to manually setting
<code>breaks,</code> <strong>tmap</strong> allows users to specify
algorithms to create breaks with the <code>style</code> argument
automatically. Here are some of the most useful scale functions (Figure
@ref(fig:break-styles)):</p>
<ul>
<li><code>style = "pretty"</code>: the default setting, rounds breaks
into whole numbers where possible and spaces them evenly</li>
<li><code>style = "equal"</code>: divides input values into bins of
equal range and is appropriate for variables with a uniform distribution
(not recommended for variables with a skewed distribution as the
resulting map may end-up having little color diversity)</li>
<li><code>style = "quantile"</code>: ensures the same number of
observations fall into each category (with the potential downside that
bin ranges can vary widely)</li>
<li><code>style = "jenks"</code>: identifies groups of similar values in
the data and maximizes the differences between categories</li>
<li><code>style = "log10_pretty"</code>: a common logarithmic (the
logarithm to base 10) version of the regular pretty style used for
variables with a right-skewed distribution</li>
</ul>

<div class="rmdnote">
Although <code>style</code> is an argument of <strong>tmap</strong>
functions, in fact it originates as an argument in
<code>classInt::classIntervals()</code> --- see the help page of this
function for details.
</div>
<div class="figure" style="text-align: center">
<img data-src="09-mapping_files/figure-html/break-styles-1.png" alt="Illustration of different interval scales' methods set using the style argument in tmap." width="100%">
<p class="caption">
(#fig:break-styles)Illustration of different interval scales' methods
set using the style argument in tmap.
</p>
</div>
<p> The <code>tm_scale_continuous()</code> function present a large
number of colors over continuous color fields and are particularly
suited for continuous rasters. In case of variables with skewed
distribution you can also use its variants --
<code>tm_scale_continuous_log()</code> and
<code>tm_scale_continuous_log1p()</code>. Finally,
<code>tm_scale_categorical()</code> was designed to represent
categorical values and assures that each category receives a unique
color (Figure @ref(fig:concat)).</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#&gt; Warning in strwidth(comp$text, units = &quot;inch&quot;, family = comp$fontfamily, : no</span><br><span class="line">#&gt; font could be found for family &quot;monospace&quot;</span><br><span class="line"></span><br><span class="line">#&gt; Warning in strwidth(comp$text, units = &quot;inch&quot;, family = comp$fontfamily, : no</span><br><span class="line">#&gt; font could be found for family &quot;monospace&quot;</span><br><span class="line">#&gt; Warning in strwidth(comp$text, units = &quot;inch&quot;, family = comp$fontfamily, : font</span><br><span class="line">#&gt; family &#x27;monospace&#x27; not found, will use &#x27;sans&#x27; instead</span><br><span class="line"></span><br><span class="line">#&gt; Warning in strwidth(comp$text, units = &quot;inch&quot;, family = comp$fontfamily, : font</span><br><span class="line">#&gt; family &#x27;monospace&#x27; not found, will use &#x27;sans&#x27; instead</span><br></pre></td></tr></table></figure>
<div class="figure" style="text-align: center">
<img data-src="09-mapping_files/figure-html/concat-1.png" alt="Illustration of continuous and categorical scales in tmap." width="100%">
<p class="caption">
(#fig:concat)Illustration of continuous and categorical scales in tmap.
</p>
</div>
<p> Palettes define the color ranges associated with the bins and
determined by the <code>tm_scale_*()</code> functions, and its
<code>breaks</code> and <code>n</code> arguments described above. The
default color palette is specified in <code>tm_layout()</code> (see
Section @ref(layouts) to learn more); however, it could be quickly
changed using the <code>values</code> argument. It expects a vector of
colors or a new color palette name, which can be find interactively with
<code>cols4all::c4a_gui()</code>. You can also add a <code>-</code> as
the color palette name prefix to reverse the palette order.</p>

<div class="rmdnote">
All of the default <code>values</code> of the visual variables, such as
default color palettes for different types of input variables, can be
found with <code>tmap_options()$values.var</code>.
</div>
<p>There are three main groups of color palettes: categorical,
sequential and diverging (Figure @ref(fig:colpal)), and each of them
serves a different purpose.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> Categorical palettes
consist of easily distinguishable colors and are most appropriate for
categorical data without any particular order such as state names or
land cover classes. Colors should be intuitive: rivers should be blue,
for example, and pastures green. Avoid too many categories: maps with
large legends and many colors can be uninterpretable. <!--^[
toDo:jn
tmap4??
`fill = "MAP_COLORS"` can be used in maps with a large number of individual polygons (for example, a map of individual countries) to create unique fill colors for adjacent polygons.]
--></p>
<p>The second group is sequential palettes. These follow a gradient, for
example from light to dark colors (light colors often tend to represent
lower values), and are appropriate for continuous (numeric) variables.
Sequential palettes can be single (<code>greens</code> goes from light
to dark blue, for example) or multi-color/hue (<code>yl_gn_bu</code> is
gradient from light yellow to blue via green, for example), as
demonstrated in the code chunk below --- output not shown, run the code
yourself to see the results!</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tm_shape<span class="punctuation">(</span>nz<span class="punctuation">)</span> <span class="operator">+</span> tm_polygons<span class="punctuation">(</span><span class="string">&quot;Median_income&quot;</span><span class="punctuation">,</span> fill.scale <span class="operator">=</span> tm_scale<span class="punctuation">(</span>values <span class="operator">=</span> <span class="string">&quot;greens&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">tm_shape<span class="punctuation">(</span>nz<span class="punctuation">)</span> <span class="operator">+</span> tm_polygons<span class="punctuation">(</span><span class="string">&quot;Median_income&quot;</span><span class="punctuation">,</span> fill.scale <span class="operator">=</span> tm_scale<span class="punctuation">(</span>values <span class="operator">=</span> <span class="string">&quot;yl_gn_bu&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<p>The third group, diverging palettes, typically range between three
distinct colors (purple-white-green in Figure @ref(fig:colpal)) and are
usually created by joining two single-color sequential palettes with the
darker colors at each end. Their main purpose is to visualize the
difference from an important reference point, e.g., a certain
temperature, the median household income or the mean probability for a
drought event. The reference point's value can be adjusted in
<strong>tmap</strong> using the <code>midpoint</code> argument.</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tm_shape<span class="punctuation">(</span>nz<span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">  tm_polygons<span class="punctuation">(</span><span class="string">&quot;Median_income&quot;</span><span class="punctuation">,</span></span><br><span class="line">              fill.scale <span class="operator">=</span> tm_scale_continuous<span class="punctuation">(</span>values <span class="operator">=</span> <span class="string">&quot;pu_gn_div&quot;</span><span class="punctuation">,</span> midpoint <span class="operator">=</span> <span class="number">28000</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<div class="figure" style="text-align: center">
<img data-src="09-mapping_files/figure-html/colpal-1.png" alt="Examples of categorical, sequential and diverging palettes." width="75%">
<p class="caption">
(#fig:colpal)Examples of categorical, sequential and diverging palettes.
</p>
</div>
<p>There are two important principles for consideration when working
with colors: perceptibility and accessibility. Firstly, colors on maps
should match our perception. This means that certain colors are viewed
through our experience and also cultural lenses. For example, green
colors usually represent vegetation or lowlands and blue is connected
with water or cool. Color palettes should also be easy to understand to
effectively convey information. It should be clear which values are
lower and which are higher, and colors should change gradually.
<!--toDo:jn--> <!-- update and improve -->
<!-- This property is not preserved in the rainbow color palette; therefore, we suggest avoiding it in geographic data visualization. -->
<!-- Instead, [the viridis color palettes](https://cran.r-project.org/web/packages/viridis/), also available in **tmap**, can be used. -->
Secondly, changes in colors should be accessible to the largest number
of people. Therefore, it is important to use colorblind friendly
palettes as often as possible.<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a></p>
<h3 id="图例">图例</h3>
<p> After we decided on our visual variable and its properties, we
should move our attention toward the related map legend style. Using the
<code>tm_legend()</code> function, we may change its title, position,
orientation, or even disable it. The most important argument in this
function is <code>title</code>, which sets the title of the associated
legend. In general, a map legend title should provide two pieces of
information: what the legend represents and what are the units of the
presented variable. The following code chunk demonstrates this
functionality by providing a more attractive name than the variable name
<code>Land_area</code> (note the use of <code>expression()</code> to
create superscript text):</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">legend_title <span class="operator">=</span> <span class="built_in">expression</span><span class="punctuation">(</span><span class="string">&quot;Area (km&quot;</span><span class="operator">^</span><span class="number">2</span><span class="operator">*</span><span class="string">&quot;)&quot;</span><span class="punctuation">)</span></span><br><span class="line">map_nza <span class="operator">=</span> tm_shape<span class="punctuation">(</span>nz<span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  tm_polygons<span class="punctuation">(</span>fill <span class="operator">=</span> <span class="string">&quot;Land_area&quot;</span><span class="punctuation">,</span> fill.legend <span class="operator">=</span> tm_legend<span class="punctuation">(</span>title <span class="operator">=</span> legend_title<span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<p>The default legend orientation in <strong>tmap</strong> is
<code>"portrait"</code>, however, an alternative legend orientation,
<code>"landscape"</code>, is also possible. Other than that, we can also
customize the location of the legend using the <code>position</code>
argument.</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">map_nza2 <span class="operator">=</span> tm_shape<span class="punctuation">(</span>nz<span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  tm_polygons<span class="punctuation">(</span>fill <span class="operator">=</span> <span class="string">&quot;Land_area&quot;</span><span class="punctuation">,</span> fill.legend <span class="operator">=</span> tm_legend<span class="punctuation">(</span>title <span class="operator">=</span> legend_title<span class="punctuation">,</span></span><br><span class="line">                                                          orientation <span class="operator">=</span> <span class="string">&quot;landscape&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                                          position <span class="operator">=</span> tm_pos_out<span class="punctuation">(</span><span class="string">&quot;center&quot;</span><span class="punctuation">,</span> <span class="string">&quot;bottom&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<p>The legend position (and also the position of several other map
elements in <strong>tmap</strong>) can be customized using one of a few
functions. The two most important are:</p>
<ul>
<li><code>tm_pos_out()</code>: the default, adds the legend outside of
the map frame area. We can customize its location with two values that
represent the horizontal position (<code>"left"</code>,
<code>"center"</code>, or <code>"right"</code>), and the vertical
position (<code>"bottom"</code>, <code>"center"</code>, or
<code>"top"</code>)</li>
<li><code>tm_pos_in()</code>: puts the legend inside of the map frame
area. We may decided on its position using two arguments, where the
first one can be <code>"left"</code>, <code>"center"</code>, or
<code>"right"</code>, and the second one can be <code>"bottom"</code>,
<code>"center"</code>, or <code>"top"</code>.</li>
</ul>
<p>Alternatively, we may just provide a vector of two values (or two
numbers between 0 and 1) here -- and in such case, the legend will be
put inside the map frame.</p>
<h3 id="布局">布局</h3>
<p> The map layout refers to the combination of all map elements into a
cohesive map. Map elements include among others the objects to be
mapped, the title, the scale bar, the map grid, and margins, while the
color settings covered in the previous section relate to the palette and
break-points used to affect how the map looks. Both may result in subtle
changes that can have an equally large impact on the impression left by
your maps.</p>
<p>Additional map elements such as graticules , north arrows, scale bars
and map titles have their own functions: <code>tm_graticules()</code>,
<code>tm_compass()</code>, <code>tm_scalebar()</code>, and
<code>tm_title()</code> (Figure @ref(fig:na-sb)).<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a></p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">map_nz <span class="operator">+</span> </span><br><span class="line">  tm_graticules<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  tm_compass<span class="punctuation">(</span>type <span class="operator">=</span> <span class="string">&quot;8star&quot;</span><span class="punctuation">,</span> position <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;left&quot;</span><span class="punctuation">,</span> <span class="string">&quot;top&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  tm_scalebar<span class="punctuation">(</span>breaks <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">100</span><span class="punctuation">,</span> <span class="number">200</span><span class="punctuation">)</span><span class="punctuation">,</span> text.size <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> position <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;left&quot;</span><span class="punctuation">,</span> <span class="string">&quot;top&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  tm_title<span class="punctuation">(</span><span class="string">&quot;New Zealand&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<div class="figure" style="text-align: center">
<img data-src="09-mapping_files/figure-html/na-sb-1.png" alt="Map with additional elements - a north arrow and scale bar." width="65%">
<p class="caption">
(#fig:na-sb)Map with additional elements - a north arrow and scale bar.
</p>
</div>
<p><strong>tmap</strong> also allows a wide variety of layout settings
to be changed, some of which, produced using the following code (see
<code>args(tm_layout)</code> or <code>?tm_layout</code> for a full
list), are illustrated in Figure @ref(fig:layout1):</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">map_nz <span class="operator">+</span> tm_layout<span class="punctuation">(</span>scale <span class="operator">=</span> <span class="number">4</span><span class="punctuation">)</span></span><br><span class="line">map_nz <span class="operator">+</span> tm_layout<span class="punctuation">(</span>bg.color <span class="operator">=</span> <span class="string">&quot;lightblue&quot;</span><span class="punctuation">)</span></span><br><span class="line">map_nz <span class="operator">+</span> tm_layout<span class="punctuation">(</span>frame <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<div class="figure" style="text-align: center">
<img data-src="09-mapping_files/figure-html/layout1-1.png" alt="Layout options specified by (from left to right) title, scale, bg.color and frame arguments." width="100%">
<p class="caption">
(#fig:layout1)Layout options specified by (from left to right) title,
scale, bg.color and frame arguments.
</p>
</div>
<p>The other arguments in <code>tm_layout()</code> provide control over
many more aspects of the map in relation to the canvas on which it is
placed. Here are some useful layout settings (some of which are
illustrated in Figure @ref(fig:layout2)):</p>
<ul>
<li>Margin settings including <code>outer.margin</code> and
<code>inner.margin</code></li>
<li>Font settings controlled by <code>fontface</code> and
<code>fontfamily</code></li>
<li>Legend settings including options such as <code>legend.show</code>
(whether or not to show the legend) <code>legend.orientation</code>,
<code>legend.position</code>, and <code>legend.frame</code></li>
<li>Frame width (<code>frame.lwd</code>) and an option to allow double
lines (<code>frame.double.line</code>)</li>
<li>Color settings controlling <code>color.sepia.intensity</code> (how
<em>yellowy</em> the map looks) and <code>color.saturation</code> (a
color-grayscale)</li>
</ul>
<div class="figure" style="text-align: center">
<img data-src="09-mapping_files/figure-html/layout2-1.png" alt="Illustration of selected layout options." width="100%">
<p class="caption">
(#fig:layout2)Illustration of selected layout options.
</p>
</div>
<h3 id="地图分面">地图分面</h3>
<p> Faceted maps, also referred to as 'small multiples', are composed of
many maps arranged side-by-side, and sometimes stacked vertically.
Facets enable the visualization of how spatial relationships change with
respect to another variable, such as time. The changing populations of
settlements, for example, can be represented in a faceted map with each
panel representing the population at a particular moment in time. The
time dimension could be represented via another <em>visual variable</em>
such as color. However, this risks cluttering the map because it will
involve multiple overlapping points (cities do not tend to move over
time!).</p>
<p>Typically all individual facets in a faceted map contain the same
geometry data repeated multiple times, once for each column in the
attribute data (this is the default plotting method for <code>sf</code>
objects, see Chapter @ref(spatial-class)). However, facets can also
represent shifting geometries such as the evolution of a point pattern
over time. This use case of faceted plot is illustrated in Figure
@ref(fig:urban-facet).</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">urb_1970_2030 <span class="operator">=</span> urban_agglomerations <span class="operator">|&gt;</span> </span><br><span class="line">  filter<span class="punctuation">(</span>year <span class="operator">%in%</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">1970</span><span class="punctuation">,</span> <span class="number">1990</span><span class="punctuation">,</span> <span class="number">2010</span><span class="punctuation">,</span> <span class="number">2030</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">tm_shape<span class="punctuation">(</span>world<span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  tm_polygons<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  tm_shape<span class="punctuation">(</span>urb_1970_2030<span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  tm_symbols<span class="punctuation">(</span>fill <span class="operator">=</span> <span class="string">&quot;black&quot;</span><span class="punctuation">,</span> col <span class="operator">=</span> <span class="string">&quot;white&quot;</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="string">&quot;population_millions&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  tm_facets_wrap<span class="punctuation">(</span>by <span class="operator">=</span> <span class="string">&quot;year&quot;</span><span class="punctuation">,</span> nrow <span class="operator">=</span> <span class="number">2</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<div class="figure" style="text-align: center">
<img data-src="09-mapping_files/figure-html/urban-facet-1.png" alt="Faceted map showing the top 30 largest urban agglomerations from 1970 to 2030 based on population projections by the United Nations." width="100%">
<p class="caption">
(#fig:urban-facet)Faceted map showing the top 30 largest urban
agglomerations from 1970 to 2030 based on population projections by the
United Nations.
</p>
</div>
<p>The preceding code chunk demonstrates key features of faceted maps
created using the <code>tm_facets_wrap()</code> function:</p>
<ul>
<li>Shapes that do not have a facet variable are repeated (the countries
in <code>world</code> in this case)</li>
<li>The <code>by</code> argument which varies depending on a variable
(<code>"year"</code> in this case)</li>
<li>The <code>nrow</code>/<code>ncol</code> setting specifying the
number of rows and columns that facets should be arranged into</li>
</ul>
<p>Alternatively, it is possible to use the
<code>tm_facets_grid()</code> function that allows to have facets based
on up to three different variables: one for <code>rows</code>, one for
<code>columns</code>, and possibly one for <code>pages</code>.</p>
<p>In addition to their utility for showing changing spatial
relationships, faceted maps are also useful as the foundation for
animated maps (see Section @ref(animated-maps)).</p>
<h3 id="插图地图">插图地图</h3>
<p> An inset map is a smaller map rendered within or next to the main
map. It could serve many different purposes, including providing a
context (Figure @ref(fig:insetmap1)) or bringing some non-contiguous
regions closer to ease their comparison (Figure @ref(fig:insetmap2)).
They could be also used to focus on a smaller area in more detail or to
cover the same area as the map, but representing a different topic.</p>
<p>In the example below, we create a map of the central part of New
Zealand's Southern Alps. Our inset map will show where the main map is
in relation to the whole New Zealand. The first step is to define the
area of interest, which can be done by creating a new spatial object,
<code>nz_region</code>.</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">nz_region <span class="operator">=</span> st_bbox<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span>xmin <span class="operator">=</span> <span class="number">1340000</span><span class="punctuation">,</span> xmax <span class="operator">=</span> <span class="number">1450000</span><span class="punctuation">,</span></span><br><span class="line">                      ymin <span class="operator">=</span> <span class="number">5130000</span><span class="punctuation">,</span> ymax <span class="operator">=</span> <span class="number">5210000</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                    crs <span class="operator">=</span> st_crs<span class="punctuation">(</span>nz_height<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">|&gt;</span> </span><br><span class="line">  st_as_sfc<span class="punctuation">(</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<p>In the second step, we create a base map showing the New Zealand's
Southern Alps area. This is a place where the most important message is
stated.</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">nz_height_map <span class="operator">=</span> tm_shape<span class="punctuation">(</span>nz_elev<span class="punctuation">,</span> bbox <span class="operator">=</span> nz_region<span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  tm_raster<span class="punctuation">(</span>col.scale <span class="operator">=</span> tm_scale_continuous<span class="punctuation">(</span>values <span class="operator">=</span> <span class="string">&quot;YlGn&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">            col.legend <span class="operator">=</span> tm_legend<span class="punctuation">(</span>position <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;left&quot;</span><span class="punctuation">,</span> <span class="string">&quot;top&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  tm_shape<span class="punctuation">(</span>nz_height<span class="punctuation">)</span> <span class="operator">+</span> tm_symbols<span class="punctuation">(</span>shape <span class="operator">=</span> <span class="number">2</span><span class="punctuation">,</span> col <span class="operator">=</span> <span class="string">&quot;red&quot;</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  tm_scalebar<span class="punctuation">(</span>position <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;left&quot;</span><span class="punctuation">,</span> <span class="string">&quot;bottom&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<p>The third step consists of the inset map creation. It gives a context
and helps to locate the area of interest. Importantly, this map needs to
clearly indicate the location of the main map, for example by stating
its borders.</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">nz_map <span class="operator">=</span> tm_shape<span class="punctuation">(</span>nz<span class="punctuation">)</span> <span class="operator">+</span> tm_polygons<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  tm_shape<span class="punctuation">(</span>nz_height<span class="punctuation">)</span> <span class="operator">+</span> tm_symbols<span class="punctuation">(</span>shape <span class="operator">=</span> <span class="number">2</span><span class="punctuation">,</span> col <span class="operator">=</span> <span class="string">&quot;red&quot;</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">0.1</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">  tm_shape<span class="punctuation">(</span>nz_region<span class="punctuation">)</span> <span class="operator">+</span> tm_borders<span class="punctuation">(</span>lwd <span class="operator">=</span> <span class="number">3</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  tm_layout<span class="punctuation">(</span>bg.color <span class="operator">=</span> <span class="string">&quot;lightblue&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<p>One of the main differences between regular charts (e.g.,
scatterplots) and maps is that the input data determine the aspect ratio
of maps. Thus, in this case, we need to calculate the aspect ratios of
our two main datasets, <code>nz_region</code> and <code>nz</code>. The
following function, <code>norm_dim()</code> returns the normalized width
(<code>"w"</code>) and height (<code>"h"</code>) of the object (as
<code>"snpc"</code> units understood my the graphic device).</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">library<span class="punctuation">(</span>grid<span class="punctuation">)</span></span><br><span class="line">norm_dim <span class="operator">=</span> <span class="keyword">function</span><span class="punctuation">(</span>obj<span class="punctuation">)</span><span class="punctuation">&#123;</span></span><br><span class="line">    bbox <span class="operator">=</span> st_bbox<span class="punctuation">(</span>obj<span class="punctuation">)</span></span><br><span class="line">    width <span class="operator">=</span> bbox<span class="punctuation">[[</span><span class="string">&quot;xmax&quot;</span><span class="punctuation">]</span><span class="punctuation">]</span> <span class="operator">-</span> bbox<span class="punctuation">[[</span><span class="string">&quot;xmin&quot;</span><span class="punctuation">]</span><span class="punctuation">]</span></span><br><span class="line">    height <span class="operator">=</span> bbox<span class="punctuation">[[</span><span class="string">&quot;ymax&quot;</span><span class="punctuation">]</span><span class="punctuation">]</span> <span class="operator">-</span> bbox<span class="punctuation">[[</span><span class="string">&quot;ymin&quot;</span><span class="punctuation">]</span><span class="punctuation">]</span></span><br><span class="line">    w <span class="operator">=</span> width <span class="operator">/</span> <span class="built_in">max</span><span class="punctuation">(</span>width<span class="punctuation">,</span> height<span class="punctuation">)</span></span><br><span class="line">    h <span class="operator">=</span> height <span class="operator">/</span> <span class="built_in">max</span><span class="punctuation">(</span>width<span class="punctuation">,</span> height<span class="punctuation">)</span></span><br><span class="line">    <span class="built_in">return</span><span class="punctuation">(</span>unit<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span>w<span class="punctuation">,</span> h<span class="punctuation">)</span><span class="punctuation">,</span> <span class="string">&quot;snpc&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line">main_dim <span class="operator">=</span> norm_dim<span class="punctuation">(</span>nz_region<span class="punctuation">)</span></span><br><span class="line">ins_dim <span class="operator">=</span> norm_dim<span class="punctuation">(</span>nz<span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<p>Next, knowing the aspect ratios, we need to specify the sizes and
locations of our two maps -- the main map and the inset map -- using the
<code>viewport()</code> function. A viewport is part of a graphics
device we use to draw the graphical elements at a given moment. The
viewport of our main map is just the representation of its aspect
ratio.</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">main_vp <span class="operator">=</span> viewport<span class="punctuation">(</span>width <span class="operator">=</span> main_dim<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">,</span> height <span class="operator">=</span> main_dim<span class="punctuation">[</span><span class="number">2</span><span class="punctuation">]</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<p>On the other hand, the viewport of the inset map needs to specify its
size and location. Here, we would make the inset map twice smaller as
the main one by multiplying the width and height by 0.5, and we will
locate it 0.5 cm from the bottom right of the main map frame.</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ins_vp <span class="operator">=</span> viewport<span class="punctuation">(</span>width <span class="operator">=</span> ins_dim<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="operator">*</span> <span class="number">0.5</span><span class="punctuation">,</span> height <span class="operator">=</span> ins_dim<span class="punctuation">[</span><span class="number">2</span><span class="punctuation">]</span> <span class="operator">*</span> <span class="number">0.5</span><span class="punctuation">,</span></span><br><span class="line">                  x <span class="operator">=</span> unit<span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span> <span class="string">&quot;npc&quot;</span><span class="punctuation">)</span> <span class="operator">-</span> unit<span class="punctuation">(</span><span class="number">0.5</span><span class="punctuation">,</span> <span class="string">&quot;cm&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> y <span class="operator">=</span> unit<span class="punctuation">(</span><span class="number">0.5</span><span class="punctuation">,</span> <span class="string">&quot;cm&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                  just <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;right&quot;</span><span class="punctuation">,</span> <span class="string">&quot;bottom&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<p>Finally, we combine the two maps by creating a new, blank canvas,
printing out the main map, and then placing the inset map inside of the
main map viewport.</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">grid.newpage<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line">print<span class="punctuation">(</span>nz_height_map<span class="punctuation">,</span> vp <span class="operator">=</span> main_vp<span class="punctuation">)</span></span><br><span class="line">pushViewport<span class="punctuation">(</span>main_vp<span class="punctuation">)</span></span><br><span class="line">print<span class="punctuation">(</span>nz_map<span class="punctuation">,</span> vp <span class="operator">=</span> ins_vp<span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<div class="figure" style="text-align: center">
<img data-src="09-mapping_files/figure-html/insetmap1-1.png" alt="Inset map providing a context - location of the central part of the Southern Alps in New Zealand." width="100%">
<p class="caption">
(#fig:insetmap1)Inset map providing a context - location of the central
part of the Southern Alps in New Zealand.
</p>
</div>
<p>Inset map can be saved to file either by using a graphic device (see
Section @ref(visual-outputs)) or the <code>tmap_save()</code> function
and its arguments - <code>insets_tm</code> and
<code>insets_vp</code>.</p>
<p>Inset maps are also used to create one map of non-contiguous areas.
Probably, the most often used example is a map of the United States,
which consists of the contiguous United States, Hawaii and Alaska. It is
very important to find the best projection for each individual inset in
these types of cases (see Chapter @ref(reproj-geo-data) to learn more).
We can use US National Atlas Equal Area for the map of the contiguous
United States by putting its EPSG code in the <code>projection</code>
argument of <code>tm_shape()</code>.</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">us_states_map <span class="operator">=</span> tm_shape<span class="punctuation">(</span>us_states<span class="punctuation">,</span> projection <span class="operator">=</span> <span class="string">&quot;EPSG:2163&quot;</span><span class="punctuation">)</span> <span class="operator">+</span> tm_polygons<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">  tm_layout<span class="punctuation">(</span>frame <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<p>The rest of our objects, <code>hawaii</code> and <code>alaska</code>,
already have proper projections; therefore, we just need to create two
separate maps:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">hawaii_map <span class="operator">=</span> tm_shape<span class="punctuation">(</span>hawaii<span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  tm_polygons<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">  tm_title<span class="punctuation">(</span><span class="string">&quot;Hawaii&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  tm_layout<span class="punctuation">(</span>frame <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span> bg.color <span class="operator">=</span> <span class="literal">NA</span><span class="punctuation">,</span> </span><br><span class="line">            title.position <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;LEFT&quot;</span><span class="punctuation">,</span> <span class="string">&quot;BOTTOM&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">alaska_map <span class="operator">=</span> tm_shape<span class="punctuation">(</span>alaska<span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  tm_polygons<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">  tm_title<span class="punctuation">(</span><span class="string">&quot;Alaska&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  tm_layout<span class="punctuation">(</span>frame <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span> bg.color <span class="operator">=</span> <span class="literal">NA</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<p>The final map is created by combining and arranging these three
maps:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">us_states_map</span><br><span class="line">print<span class="punctuation">(</span>hawaii_map<span class="punctuation">,</span> vp <span class="operator">=</span> grid<span class="operator">::</span>viewport<span class="punctuation">(</span><span class="number">0.35</span><span class="punctuation">,</span> <span class="number">0.1</span><span class="punctuation">,</span> width <span class="operator">=</span> <span class="number">0.2</span><span class="punctuation">,</span> height <span class="operator">=</span> <span class="number">0.1</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">print<span class="punctuation">(</span>alaska_map<span class="punctuation">,</span> vp <span class="operator">=</span> grid<span class="operator">::</span>viewport<span class="punctuation">(</span><span class="number">0.15</span><span class="punctuation">,</span> <span class="number">0.15</span><span class="punctuation">,</span> width <span class="operator">=</span> <span class="number">0.3</span><span class="punctuation">,</span> height <span class="operator">=</span> <span class="number">0.3</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<div class="figure" style="text-align: center">
<img data-src="09-mapping_files/figure-html/insetmap2-1.png" alt="Map of the United States." width="100%">
<p class="caption">
(#fig:insetmap2)Map of the United States.
</p>
</div>
<p>The code presented above is compact and can be used as the basis for
other inset maps but the results, in Figure @ref(fig:insetmap2), provide
a poor representation of the locations of Hawaii and Alaska. For a more
in-depth approach, see the <a target="_blank" rel="external nofollow noopener noreferrer" href="https://geocompx.github.io/geocompkg/articles/us-map.html"><code>us-map</code></a>
vignette from the <strong>geocompkg</strong>.</p>
<h2 id="动画地图">动画地图</h2>
<p> Faceted maps, described in Section @ref(faceted-maps), can show how
spatial distributions of variables change (e.g., over time), but the
approach has disadvantages. Facets become tiny when there are many of
them. Furthermore, the fact that each facet is physically separated on
the screen or page means that subtle differences between facets can be
hard to detect.</p>
<p>Animated maps solve these issues. Although they depend on digital
publication, this is becoming less of an issue as more and more content
moves online. Animated maps can still enhance paper reports: you can
always link readers to a web-page containing an animated (or
interactive) version of a printed map to help make it come alive. There
are several ways to generate animations in R, including with animation
packages such as <strong>gganimate</strong>, which builds on
<strong>ggplot2</strong> (see Section @ref(other-mapping-packages)).
This section focuses on creating animated maps with
<strong>tmap</strong> because its syntax will be familiar from previous
sections and the flexibility of the approach.</p>
<p>Figure @ref(fig:urban-animated) is a simple example of an animated
map. Unlike the faceted plot, it does not squeeze multiple maps into a
single screen and allows the reader to see how the spatial distribution
of the world's most populous agglomerations evolve over time (see the
book's website for the animated version).</p>
<div class="figure" style="text-align: center">
<img data-src="figures/urban-animated.gif" alt="Animated map showing the top 30 largest urban agglomerations from 1950 to 2030 based on population projects by the United Nations. Animated version available online at: r.geocompx.org." width="100%">
<p class="caption">
(#fig:urban-animated)Animated map showing the top 30 largest urban
agglomerations from 1950 to 2030 based on population projects by the
United Nations. Animated version available online at: r.geocompx.org.
</p>
</div>
<p>The animated map illustrated in Figure @ref(fig:urban-animated) can
be created using the same <strong>tmap</strong> techniques that generate
faceted maps, demonstrated in Section @ref(faceted-maps). There are two
differences, however, related to arguments in
<code>tm_facets()</code>:</p>
<ul>
<li><code>nrow = 1, ncol = 1</code> are added to keep one moment in time
as one layer</li>
<li><code>free.coords = FALSE</code>, which maintains the map extent for
each map iteration</li>
</ul>
<p>These additional arguments are demonstrated in the subsequent code
chunk<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a>:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">urb_anim <span class="operator">=</span> tm_shape<span class="punctuation">(</span>world<span class="punctuation">)</span> <span class="operator">+</span> tm_polygons<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">  tm_shape<span class="punctuation">(</span>urban_agglomerations<span class="punctuation">)</span> <span class="operator">+</span> tm_symbols<span class="punctuation">(</span>size <span class="operator">=</span> <span class="string">&quot;population_millions&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  tm_facets<span class="punctuation">(</span>by <span class="operator">=</span> <span class="string">&quot;year&quot;</span><span class="punctuation">,</span> nrow <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> ncol <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> free.coords <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<p>The resulting <code>urb_anim</code> represents a set of separate maps
for each year. The final stage is to combine them and save the result as
a <code>.gif</code> file with <code>tmap_animation()</code>. The
following command creates the animation illustrated in Figure
@ref(fig:urban-animated), with a few elements missing, that we will add
in during the exercises:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tmap_animation<span class="punctuation">(</span>urb_anim<span class="punctuation">,</span> filename <span class="operator">=</span> <span class="string">&quot;urb_anim.gif&quot;</span><span class="punctuation">,</span> delay <span class="operator">=</span> <span class="number">25</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<p>Another illustration of the power of animated maps is provided in
Figure @ref(fig:animus). This shows the development of states in the
United States, which first formed in the east and then incrementally to
the west and finally into the interior. Code to reproduce this map can
be found in the script <code>09-usboundaries.R</code>.</p>
<div class="figure" style="text-align: center">
<img data-src="https://user-images.githubusercontent.com/1825120/38543030-5794b6f0-3c9b-11e8-9da9-10ec1f3ea726.gif" alt="Animated map showing population growth, state formation and boundary changes in the United States, 1790-2010. Animated version available online at r.geocompx.org." width="100%">
<p class="caption">
(#fig:animus)Animated map showing population growth, state formation and
boundary changes in the United States, 1790-2010. Animated version
available online at r.geocompx.org.
</p>
</div>
<h2 id="交互地图">交互地图</h2>
<p> While static and animated maps can enliven geographic datasets,
interactive maps can take them to a new level. Interactivity can take
many forms, the most common and useful of which is the ability to pan
around and zoom into any part of a geographic dataset overlaid on a 'web
map' to show context. Less advanced interactivity levels include popups
which appear when you click on different features, a kind of interactive
label. More advanced levels of interactivity include the ability to tilt
and rotate maps, as demonstrated in the <strong>mapdeck</strong> example
below, and the provision of "dynamically linked" sub-plots which
automatically update when the user pans and zooms.</p>
<p>The most important type of interactivity, however, is the display of
geographic data on interactive or 'slippy' web maps. The release of the
<strong>leaflet</strong> package in 2015 (that uses the leaflet
JavaScript library) revolutionized interactive web map creation from
within R and a number of packages have built on these foundations adding
new features (e.g., <strong>leaflet.extras</strong>) and making the
creation of web maps as simple as creating static maps (e.g.,
<strong>mapview</strong> and <strong>tmap</strong>). This section
illustrates each approach in the opposite order. We will explore how to
make slippy maps with <strong>tmap</strong> (the syntax of which we have
already learned), <strong>mapview</strong>, <strong>mapdeck</strong> and
finally <strong>leaflet</strong> (which provides low-level control over
interactive maps).</p>
<p>A unique feature of <strong>tmap</strong> mentioned in Section
@ref(static-maps) is its ability to create static and interactive maps
using the same code. Maps can be viewed interactively at any point by
switching to view mode, using the command
<code>tmap_mode("view")</code>. This is demonstrated in the code below,
which creates an interactive map of New Zealand based on the
<code>tmap</code> object <code>map_nz</code>, created in Section
@ref(map-obj), and illustrated in Figure @ref(fig:tmview):</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tmap_mode<span class="punctuation">(</span><span class="string">&quot;view&quot;</span><span class="punctuation">)</span></span><br><span class="line">map_nz</span><br></pre></td></tr></table></figure>
<div class="figure" style="text-align: center">
<iframe src="https://geocompx.org/static/img/tmview-1.html" width="100%" height="400px" data-external="1">
</iframe>
<p class="caption">
(#fig:tmview)Interactive map of New Zealand created with tmap in view
mode. Interactive version available online at: r.geocompx.org.
</p>
</div>
<!--toDo:jn-->
<!-- tmap_leaflet? -->
<p>Now that the interactive mode has been 'turned on', all maps produced
with <strong>tmap</strong> will launch (another way to create
interactive maps is with the <code>tmap_leaflet()</code> function).
Notable features of this interactive mode include the ability to specify
the basemap with <code>tm_basemap()</code> (or
<code>tmap_options()</code>) as demonstrated below (result not
shown):</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">map_nz <span class="operator">+</span> tm_basemap<span class="punctuation">(</span>server <span class="operator">=</span> <span class="string">&quot;OpenTopoMap&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<p>An impressive and little-known feature of <strong>tmap</strong>'s
view mode is that it also works with faceted plots. The argument
<code>sync</code> in <code>tm_facets()</code> can be used in this case
to produce multiple maps with synchronized zoom and pan settings, as
illustrated in Figure @ref(fig:sync), which was produced by the
following code:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">world_coffee <span class="operator">=</span> left_join<span class="punctuation">(</span>world<span class="punctuation">,</span> coffee_data<span class="punctuation">,</span> by <span class="operator">=</span> <span class="string">&quot;name_long&quot;</span><span class="punctuation">)</span></span><br><span class="line">facets <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;coffee_production_2016&quot;</span><span class="punctuation">,</span> <span class="string">&quot;coffee_production_2017&quot;</span><span class="punctuation">)</span></span><br><span class="line">tm_shape<span class="punctuation">(</span>world_coffee<span class="punctuation">)</span> <span class="operator">+</span> tm_polygons<span class="punctuation">(</span>facets<span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">  tm_facets_wrap<span class="punctuation">(</span>nrow <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> sync <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<div class="figure" style="text-align: center">
<img data-src="figures/interactive-facets.png" alt="Faceted interactive maps of global coffee production in 2016 and 2017 in sync, demonstrating tmap's view mode in action." width="100%">
<p class="caption">
(#fig:sync)Faceted interactive maps of global coffee production in 2016
and 2017 in sync, demonstrating tmap's view mode in action.
</p>
</div>
<p>Switch <strong>tmap</strong> back to plotting mode with the same
function:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tmap_mode<span class="punctuation">(</span><span class="string">&quot;plot&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#&gt; tmap mode set to &#x27;plot&#x27;</span></span><br></pre></td></tr></table></figure>
<p>If you are not proficient with <strong>tmap</strong>, the quickest
way to create interactive maps in R may be with
<strong>mapview</strong>. The following 'one liner' is a reliable way to
interactively explore a wide range of geographic data formats:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mapview<span class="operator">::</span>mapview<span class="punctuation">(</span>nz<span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<div class="figure" style="text-align: center">
<img data-src="figures/mapview.png" alt="Illustration of mapview in action." width="100%">
<p class="caption">
(#fig:mapview)Illustration of mapview in action.
</p>
</div>
<p><strong>mapview</strong> has a concise syntax yet is powerful. By
default, it has some standard GIS functionality such as mouse position
information, attribute queries (via pop-ups), scale bar, and
zoom-to-layer buttons. It also offers advanced controls including the
ability to 'burst' datasets into multiple layers and the addition of
multiple layers with <code>+</code> followed by the name of a geographic
object. Additionally, it provides automatic coloring of attributes via
the <code>zcol</code> argument. In essence, it can be considered a
data-driven <strong>leaflet</strong> API (see below for more information
about <strong>leaflet</strong>). Given that <strong>mapview</strong>
always expects a spatial object (including <code>sf</code> and
<code>SpatRaster</code>) as its first argument, it works well at the end
of piped expressions. Consider the following example where
<strong>sf</strong> is used to intersect lines and polygons and then is
visualized with <strong>mapview</strong> (Figure
@ref(fig:mapview2)).</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">library<span class="punctuation">(</span>mapview<span class="punctuation">)</span></span><br><span class="line">oberfranken <span class="operator">=</span> subset<span class="punctuation">(</span>franconia<span class="punctuation">,</span> district <span class="operator">==</span> <span class="string">&quot;Oberfranken&quot;</span><span class="punctuation">)</span></span><br><span class="line">trails <span class="operator">|&gt;</span></span><br><span class="line">  st_transform<span class="punctuation">(</span>st_crs<span class="punctuation">(</span>oberfranken<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">|&gt;</span></span><br><span class="line">  st_intersection<span class="punctuation">(</span>oberfranken<span class="punctuation">)</span> <span class="operator">|&gt;</span></span><br><span class="line">  st_collection_extract<span class="punctuation">(</span><span class="string">&quot;LINESTRING&quot;</span><span class="punctuation">)</span> <span class="operator">|&gt;</span></span><br><span class="line">  mapview<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;red&quot;</span><span class="punctuation">,</span> lwd <span class="operator">=</span> <span class="number">3</span><span class="punctuation">,</span> layer.name <span class="operator">=</span> <span class="string">&quot;trails&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  mapview<span class="punctuation">(</span>franconia<span class="punctuation">,</span> zcol <span class="operator">=</span> <span class="string">&quot;district&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  breweries</span><br></pre></td></tr></table></figure>
<div class="figure" style="text-align: center">
<img data-src="figures/mapview-example.png" alt="Using mapview at the end of a sf-based pipe expression." width="100%">
<p class="caption">
(#fig:mapview2)Using mapview at the end of a sf-based pipe expression.
</p>
</div>
<p>One important thing to keep in mind is that <strong>mapview</strong>
layers are added via the <code>+</code> operator (similar to
<strong>ggplot2</strong> or <strong>tmap</strong>). By default,
<strong>mapview</strong> uses the leaflet JavaScript library to render
the output maps, which is user-friendly and has a lot of features.
However, some alternative rendering libraries could be more performant
(work more smoothly on larger datasets). <strong>mapview</strong> allows
to set alternative rendering libraries (<code>"leafgl"</code> and
<code>"mapdeck"</code>) in the <code>mapviewOptions()</code>.<a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a> For further information on
<strong>mapview</strong>, see the package's website at: <a target="_blank" rel="external nofollow noopener noreferrer" href="https://r-spatial.github.io/mapview/articles/">r-spatial.github.io/mapview/</a>.</p>
<p>There are other ways to create interactive maps with R. The
<strong>googleway</strong> package, for example, provides an interactive
mapping interface that is flexible and extensible (see the <a target="_blank" rel="external nofollow noopener noreferrer" href="https://cran.r-project.org/web/packages/googleway/vignettes/googleway-vignette.html"><code>googleway-vignette</code></a>
for details). Another approach by the same author is <a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/SymbolixAU/mapdeck"><strong>mapdeck</strong></a>,
which provides access to Uber's <code>Deck.gl</code> framework. Its use
of WebGL enables it to interactively visualize large datasets up to
millions of points. The package uses Mapbox <a target="_blank" rel="external nofollow noopener noreferrer" href="https://docs.mapbox.com/help/getting-started/access-tokens/">access
tokens</a>, which you must register for before using the package.</p>

<div class="rmdnote">
Note that the following block assumes the access token is stored in your
R environment as <code>MAPBOX=your_unique_key</code>. This can be added
with <code>usethis::edit_r_environ()</code>.
</div>
<p>A unique feature of <strong>mapdeck</strong> is its provision of
interactive 2.5D perspectives, illustrated in Figure @ref(fig:mapdeck).
This means you can can pan, zoom and rotate around the maps, and view
the data 'extruded' from the map. Figure @ref(fig:mapdeck), generated by
the following code chunk, visualizes road traffic crashes in the UK,
with bar height representing casualties per area.</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">library<span class="punctuation">(</span>mapdeck<span class="punctuation">)</span></span><br><span class="line">set_token<span class="punctuation">(</span>Sys.getenv<span class="punctuation">(</span><span class="string">&quot;MAPBOX&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">crash_data <span class="operator">=</span> read.csv<span class="punctuation">(</span><span class="string">&quot;https://git.io/geocompr-mapdeck&quot;</span><span class="punctuation">)</span></span><br><span class="line">crash_data <span class="operator">=</span> na.omit<span class="punctuation">(</span>crash_data<span class="punctuation">)</span></span><br><span class="line">ms <span class="operator">=</span> mapdeck_style<span class="punctuation">(</span><span class="string">&quot;dark&quot;</span><span class="punctuation">)</span></span><br><span class="line">mapdeck<span class="punctuation">(</span>style <span class="operator">=</span> ms<span class="punctuation">,</span> pitch <span class="operator">=</span> <span class="number">45</span><span class="punctuation">,</span> location <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">52</span><span class="punctuation">)</span><span class="punctuation">,</span> zoom <span class="operator">=</span> <span class="number">4</span><span class="punctuation">)</span> <span class="operator">|&gt;</span></span><br><span class="line">  add_grid<span class="punctuation">(</span>data <span class="operator">=</span> crash_data<span class="punctuation">,</span> lat <span class="operator">=</span> <span class="string">&quot;lat&quot;</span><span class="punctuation">,</span> lon <span class="operator">=</span> <span class="string">&quot;lng&quot;</span><span class="punctuation">,</span> cell_size <span class="operator">=</span> <span class="number">1000</span><span class="punctuation">,</span></span><br><span class="line">           elevation_scale <span class="operator">=</span> <span class="number">50</span><span class="punctuation">,</span> colour_range <span class="operator">=</span> hcl.colors<span class="punctuation">(</span><span class="number">6</span><span class="punctuation">,</span> <span class="string">&quot;plasma&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<div class="figure" style="text-align: center">
<img data-src="figures/mapdeck-mini.png" alt="Map generated by mapdeck, representing road traffic casualties across the UK. Height of 1 km cells represents number of crashes." width="100%">
<p class="caption">
(#fig:mapdeck)Map generated by mapdeck, representing road traffic
casualties across the UK. Height of 1 km cells represents number of
crashes.
</p>
</div>
<p>You can zoom and drag the map in the browser, in addition to rotating
and tilting it when pressing <code>Cmd</code>/<code>Ctrl</code>.
Multiple layers can be added with the pipe operator, as demonstrated in
the <a target="_blank" rel="external nofollow noopener noreferrer" href="https://cran.r-project.org/web/packages/mapdeck/vignettes/mapdeck.html"><code>mapdeck</code>
vignettes</a>. <strong>mapdeck</strong> also supports <code>sf</code>
objects, as can be seen by replacing the <code>add_grid()</code>
function call in the preceding code chunk with
<code>add_polygon(data = lnd, layer_id = "polygon_layer")</code>, to add
polygons representing London to an interactive tilted map.</p>
<p>Last but not least is <strong>leaflet</strong> which is the most
mature and widely used interactive mapping package in R.
<strong>leaflet</strong> provides a relatively low-level interface to
the Leaflet JavaScript library and many of its arguments can be
understood by reading the documentation of the original JavaScript
library (see <a target="_blank" rel="external nofollow noopener noreferrer" href="https://leafletjs.com/">leafletjs.com</a>).</p>
<p>Leaflet maps are created with <code>leaflet()</code>, the result of
which is a <code>leaflet</code> map object which can be piped to other
<strong>leaflet</strong> functions. This allows multiple map layers and
control settings to be added interactively, as demonstrated in the code
below which generates Figure @ref(fig:leaflet) (see <a target="_blank" rel="external nofollow noopener noreferrer" href="https://rstudio.github.io/leaflet/">rstudio.github.io/leaflet/</a>
for details).</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">pal <span class="operator">=</span> colorNumeric<span class="punctuation">(</span><span class="string">&quot;RdYlBu&quot;</span><span class="punctuation">,</span> domain <span class="operator">=</span> cycle_hire<span class="operator">$</span>nbikes<span class="punctuation">)</span></span><br><span class="line">leaflet<span class="punctuation">(</span>data <span class="operator">=</span> cycle_hire<span class="punctuation">)</span> <span class="operator">|&gt;</span> </span><br><span class="line">  addProviderTiles<span class="punctuation">(</span>providers<span class="operator">$</span>CartoDB.Positron<span class="punctuation">)</span> <span class="operator">|&gt;</span></span><br><span class="line">  addCircles<span class="punctuation">(</span>col <span class="operator">=</span> <span class="operator">~</span>pal<span class="punctuation">(</span>nbikes<span class="punctuation">)</span><span class="punctuation">,</span> opacity <span class="operator">=</span> <span class="number">0.9</span><span class="punctuation">)</span> <span class="operator">|&gt;</span> </span><br><span class="line">  addPolygons<span class="punctuation">(</span>data <span class="operator">=</span> lnd<span class="punctuation">,</span> fill <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span> <span class="operator">|&gt;</span> </span><br><span class="line">  addLegend<span class="punctuation">(</span>pal <span class="operator">=</span> pal<span class="punctuation">,</span> values <span class="operator">=</span> <span class="operator">~</span>nbikes<span class="punctuation">)</span> <span class="operator">|&gt;</span> </span><br><span class="line">  setView<span class="punctuation">(</span>lng <span class="operator">=</span> <span class="operator">-</span><span class="number">0.1</span><span class="punctuation">,</span> <span class="number">51.5</span><span class="punctuation">,</span> zoom <span class="operator">=</span> <span class="number">12</span><span class="punctuation">)</span> <span class="operator">|&gt;</span> </span><br><span class="line">  addMiniMap<span class="punctuation">(</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<div class="figure" style="text-align: center">
<img data-src="figures/leaflet-1.png" alt="The leaflet package in action, showing cycle hire points in London. See interactive version [online](https://geocompr.github.io/img/leaflet.html)." width="100%">
<p class="caption">
(#fig:leaflet)The leaflet package in action, showing cycle hire points
in London. See interactive version <a target="_blank" rel="external nofollow noopener noreferrer" href="https://geocompr.github.io/img/leaflet.html">online</a>.
</p>
</div>
<h2 id="地图应用">地图应用</h2>
<aside id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>If there is a clash between a fixed value and a column
name, the column name takes precedence. This can be verified by running
the next code chunk after running <code>nz$red = 1:nrow(nz)</code>.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>A fourth group of color palettes, called bivariate, also
exists. They are used when we want to represent relations between two
variables on one map.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>See the "Color vision" options and the "Color Blind
Friendliness" panel in <code>cols4all::c4a_gui()</code>.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>Another additional map elements include
<code>tm_grid()</code>, <code>tm_logo()</code> and
<code>tm_credits()</code>.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p>There is also a shortcut for this approach:
<code>tm_facets_pagewise()</code>.<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn6"><p>You may also try to use
<code>mapviewOptions(georaster = TRUE)</code> for more performant
visualizations of large raster data.<a href="#fnref6" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</aside>

            
        </div>

        
        
        

        <div>
            
        </div>

        <footer class="post-footer">
            <div class="post-eof"></div>
            
        </footer>
    </article>
</div>




    


<div class="post-block">
    
    

    <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
        <link itemprop="mainEntityOfPage" href="https://ancao96.github.io/2023/08/17/2023-8-17-8%E5%9C%B0%E7%90%86%E6%95%B0%E6%8D%AEIO/">

        <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
            <meta itemprop="image" content="/images/avatar.gif">
            <meta itemprop="name" content="SCY">
        </span>

        <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
            <meta itemprop="name" content="SCY SPACE">
            <meta itemprop="description" content>
        </span>

        <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
            <meta itemprop="name" content="undefined | SCY SPACE">
            <meta itemprop="description" content>
        </span>
        <header class="post-header">
            <h2 class="post-title" itemprop="name headline">
                <a href="/2023/08/17/2023-8-17-8%E5%9C%B0%E7%90%86%E6%95%B0%E6%8D%AEIO/" class="post-title-link" itemprop="url">(8)地理数据 I/O</a>
            </h2>

            <div class="post-meta-container">
                <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-08-17 14:11:20" itemprop="dateCreated datePublished" datetime="2023-08-17T14:11:20+08:00">2023-08-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-09-06 20:03:09" itemprop="dateModified" datetime="2023-09-06T20:03:09+08:00">2023-09-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/R/" itemprop="url" rel="index"><span itemprop="name">R</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/R/Geocomputaion/" itemprop="url" rel="index"><span itemprop="name">Geocomputaion</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Waline：</span>
  
    <a title="waline" href="/2023/08/17/2023-8-17-8%E5%9C%B0%E7%90%86%E6%95%B0%E6%8D%AEIO/#waline" itemprop="discussionUrl">
      <span class="post-comments-count waline-comment-count" data-path="/2023/08/17/2023-8-17-8%E5%9C%B0%E7%90%86%E6%95%B0%E6%8D%AEIO/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>9.9k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>36 分钟</span>
    </span>
</div>

            </div>
        </header>

        
        
        
        <div class="post-body" itemprop="articleBody">
            <p>本章关于读取和写入地理数据。地理数据<em>输入</em>对地理计算至关重要，没有数据就不可能有真实世界的应用。数据<em>输出</em>也非常关键,它能够让其他人使用由你的工作产生的有价值的新数据集或改进后的数据集。总而言之,输入/输出这些进程可以称为数据I/O。
            <!--noindex-->
            <div class="post-button">
                <a class="btn" href="/2023/08/17/2023-8-17-8%E5%9C%B0%E7%90%86%E6%95%B0%E6%8D%AEIO/#more" rel="contents">
                    阅读全文 &raquo;
                </a>
            </div>
            <!--/noindex-->
            
            
        </p></div>

        
        
        

        <div>
            
        </div>

        <footer class="post-footer">
            <div class="post-eof"></div>
            
        </footer>
    </article>
</div>




    


<div class="post-block">
    
    

    <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
        <link itemprop="mainEntityOfPage" href="https://ancao96.github.io/2023/08/16/2023-8-16-7%E5%9C%B0%E7%90%86%E6%95%B0%E6%8D%AE%E9%87%8D%E6%8A%95%E5%BD%B1/">

        <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
            <meta itemprop="image" content="/images/avatar.gif">
            <meta itemprop="name" content="SCY">
        </span>

        <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
            <meta itemprop="name" content="SCY SPACE">
            <meta itemprop="description" content>
        </span>

        <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
            <meta itemprop="name" content="undefined | SCY SPACE">
            <meta itemprop="description" content>
        </span>
        <header class="post-header">
            <h2 class="post-title" itemprop="name headline">
                <a href="/2023/08/16/2023-8-16-7%E5%9C%B0%E7%90%86%E6%95%B0%E6%8D%AE%E9%87%8D%E6%8A%95%E5%BD%B1/" class="post-title-link" itemprop="url">(7)地理数据重投影</a>
            </h2>

            <div class="post-meta-container">
                <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-08-16 09:05:20" itemprop="dateCreated datePublished" datetime="2023-08-16T09:05:20+08:00">2023-08-16</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-09-06 20:03:12" itemprop="dateModified" datetime="2023-09-06T20:03:12+08:00">2023-09-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/R/" itemprop="url" rel="index"><span itemprop="name">R</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/R/Geocomputaion/" itemprop="url" rel="index"><span itemprop="name">Geocomputaion</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Waline：</span>
  
    <a title="waline" href="/2023/08/16/2023-8-16-7%E5%9C%B0%E7%90%86%E6%95%B0%E6%8D%AE%E9%87%8D%E6%8A%95%E5%BD%B1/#waline" itemprop="discussionUrl">
      <span class="post-comments-count waline-comment-count" data-path="/2023/08/16/2023-8-16-7%E5%9C%B0%E7%90%86%E6%95%B0%E6%8D%AE%E9%87%8D%E6%8A%95%E5%BD%B1/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>11k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>40 分钟</span>
    </span>
</div>

            </div>
        </header>

        
        
        
        <div class="post-body" itemprop="articleBody">
            <p>本章演示了如何设置并将地理数据从一个CRS<em>转换</em>到另一个CRS，并进一步突出了由于忽略CRS而可能出现的特定问题，当您的数据以经纬度坐标存储时，应该特别注意。
            <!--noindex-->
            <div class="post-button">
                <a class="btn" href="/2023/08/16/2023-8-16-7%E5%9C%B0%E7%90%86%E6%95%B0%E6%8D%AE%E9%87%8D%E6%8A%95%E5%BD%B1/#more" rel="contents">
                    阅读全文 &raquo;
                </a>
            </div>
            <!--/noindex-->
            
            
        </p></div>

        
        
        

        <div>
            
        </div>

        <footer class="post-footer">
            <div class="post-eof"></div>
            
        </footer>
    </article>
</div>




    


<div class="post-block">
    
    

    <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
        <link itemprop="mainEntityOfPage" href="https://ancao96.github.io/2023/08/15/2023-8-15-6%E6%A0%85%E6%A0%BC%E7%9F%A2%E9%87%8F%E4%BA%A4%E5%8F%89/">

        <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
            <meta itemprop="image" content="/images/avatar.gif">
            <meta itemprop="name" content="SCY">
        </span>

        <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
            <meta itemprop="name" content="SCY SPACE">
            <meta itemprop="description" content>
        </span>

        <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
            <meta itemprop="name" content="undefined | SCY SPACE">
            <meta itemprop="description" content>
        </span>
        <header class="post-header">
            <h2 class="post-title" itemprop="name headline">
                <a href="/2023/08/15/2023-8-15-6%E6%A0%85%E6%A0%BC%E7%9F%A2%E9%87%8F%E4%BA%A4%E5%8F%89/" class="post-title-link" itemprop="url">(6)栅格矢量交叉</a>
            </h2>

            <div class="post-meta-container">
                <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-08-15 18:29:20" itemprop="dateCreated datePublished" datetime="2023-08-15T18:29:20+08:00">2023-08-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-09-06 20:03:05" itemprop="dateModified" datetime="2023-09-06T20:03:05+08:00">2023-09-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/R/" itemprop="url" rel="index"><span itemprop="name">R</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/R/Geocomputaion/" itemprop="url" rel="index"><span itemprop="name">Geocomputaion</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Waline：</span>
  
    <a title="waline" href="/2023/08/15/2023-8-15-6%E6%A0%85%E6%A0%BC%E7%9F%A2%E9%87%8F%E4%BA%A4%E5%8F%89/#waline" itemprop="discussionUrl">
      <span class="post-comments-count waline-comment-count" data-path="/2023/08/15/2023-8-15-6%E6%A0%85%E6%A0%BC%E7%9F%A2%E9%87%8F%E4%BA%A4%E5%8F%89/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>4.4k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>16 分钟</span>
    </span>
</div>

            </div>
        </header>

        
        
        
        <div class="post-body" itemprop="articleBody">
            <p>本章专注于栅格和矢量地理数据模型之间的相互作用。包括四个主要技术：使用矢量对象进行栅格裁剪和遮罩；使用不同类型的矢量数据提取栅格值；以及栅格与矢量之间的转换。以上概念使用前几章中使用的数据进行演示，以了解其潜在的现实应用。
            <!--noindex-->
            <div class="post-button">
                <a class="btn" href="/2023/08/15/2023-8-15-6%E6%A0%85%E6%A0%BC%E7%9F%A2%E9%87%8F%E4%BA%A4%E5%8F%89/#more" rel="contents">
                    阅读全文 &raquo;
                </a>
            </div>
            <!--/noindex-->
            
            
        </p></div>

        
        
        

        <div>
            
        </div>

        <footer class="post-footer">
            <div class="post-eof"></div>
            
        </footer>
    </article>
</div>




    


<div class="post-block">
    
    

    <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
        <link itemprop="mainEntityOfPage" href="https://ancao96.github.io/2023/08/14/2023-8-14-5%E5%87%A0%E4%BD%95%E6%93%8D%E4%BD%9C/">

        <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
            <meta itemprop="image" content="/images/avatar.gif">
            <meta itemprop="name" content="SCY">
        </span>

        <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
            <meta itemprop="name" content="SCY SPACE">
            <meta itemprop="description" content>
        </span>

        <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
            <meta itemprop="name" content="undefined | SCY SPACE">
            <meta itemprop="description" content>
        </span>
        <header class="post-header">
            <h2 class="post-title" itemprop="name headline">
                <a href="/2023/08/14/2023-8-14-5%E5%87%A0%E4%BD%95%E6%93%8D%E4%BD%9C/" class="post-title-link" itemprop="url">(5)几何操作</a>
            </h2>

            <div class="post-meta-container">
                <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-08-14 07:40:20" itemprop="dateCreated datePublished" datetime="2023-08-14T07:40:20+08:00">2023-08-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-09-06 20:03:13" itemprop="dateModified" datetime="2023-09-06T20:03:13+08:00">2023-09-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/R/" itemprop="url" rel="index"><span itemprop="name">R</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/R/Geocomputaion/" itemprop="url" rel="index"><span itemprop="name">Geocomputaion</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Waline：</span>
  
    <a title="waline" href="/2023/08/14/2023-8-14-5%E5%87%A0%E4%BD%95%E6%93%8D%E4%BD%9C/#waline" itemprop="discussionUrl">
      <span class="post-comments-count waline-comment-count" data-path="/2023/08/14/2023-8-14-5%E5%87%A0%E4%BD%95%E6%93%8D%E4%BD%9C/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>9.1k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>33 分钟</span>
    </span>
</div>

            </div>
        </header>

        
        
        
        <div class="post-body" itemprop="articleBody">
            <p>本章重点介绍如何操作地理对象的地理元素，例如通过简化和转换矢量几何图形、裁剪栅格数据集以及将矢量对象转换为栅格并从栅格转换为矢量。阅读本章并尝试章末的练习后，你应该能理解并控制<code>sf</code>对象中的几何列，以及与其他地理对象相关的栅格中所表示像素的范围和地理位置。
            <!--noindex-->
            <div class="post-button">
                <a class="btn" href="/2023/08/14/2023-8-14-5%E5%87%A0%E4%BD%95%E6%93%8D%E4%BD%9C/#more" rel="contents">
                    阅读全文 &raquo;
                </a>
            </div>
            <!--/noindex-->
            
            
        </p></div>

        
        
        

        <div>
            
        </div>

        <footer class="post-footer">
            <div class="post-eof"></div>
            
        </footer>
    </article>
</div>




    


<div class="post-block">
    
    

    <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
        <link itemprop="mainEntityOfPage" href="https://ancao96.github.io/2023/08/13/2023-8-13-4%E7%A9%BA%E9%97%B4%E6%93%8D%E4%BD%9C/">

        <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
            <meta itemprop="image" content="/images/avatar.gif">
            <meta itemprop="name" content="SCY">
        </span>

        <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
            <meta itemprop="name" content="SCY SPACE">
            <meta itemprop="description" content>
        </span>

        <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
            <meta itemprop="name" content="undefined | SCY SPACE">
            <meta itemprop="description" content>
        </span>
        <header class="post-header">
            <h2 class="post-title" itemprop="name headline">
                <a href="/2023/08/13/2023-8-13-4%E7%A9%BA%E9%97%B4%E6%93%8D%E4%BD%9C/" class="post-title-link" itemprop="url">(4)空间操作</a>
            </h2>

            <div class="post-meta-container">
                <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-08-13 01:12:20" itemprop="dateCreated datePublished" datetime="2023-08-13T01:12:20+08:00">2023-08-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-09-01 14:33:55" itemprop="dateModified" datetime="2023-09-01T14:33:55+08:00">2023-09-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/R/" itemprop="url" rel="index"><span itemprop="name">R</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/R/Geocomputaion/" itemprop="url" rel="index"><span itemprop="name">Geocomputaion</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Waline：</span>
  
    <a title="waline" href="/2023/08/13/2023-8-13-4%E7%A9%BA%E9%97%B4%E6%93%8D%E4%BD%9C/#waline" itemprop="discussionUrl">
      <span class="post-comments-count waline-comment-count" data-path="/2023/08/13/2023-8-13-4%E7%A9%BA%E9%97%B4%E6%93%8D%E4%BD%9C/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>13k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>47 分钟</span>
    </span>
</div>

            </div>
        </header>

        
        
        
        <div class="post-body" itemprop="articleBody">
            <p>空间操作，包括矢量数据集之间的空间连接以及栅格数据集上的局部和焦点操作，是地理计算的重要部分。本章展示了如何基于空间对象的位置和形状以多种方式进行修改。许多空间操作有与之对应的非空间（属性）操作，因此上一章中演示的如子集提取和数据集连接等概念在此也适用。
            <!--noindex-->
            <div class="post-button">
                <a class="btn" href="/2023/08/13/2023-8-13-4%E7%A9%BA%E9%97%B4%E6%93%8D%E4%BD%9C/#more" rel="contents">
                    阅读全文 &raquo;
                </a>
            </div>
            <!--/noindex-->
            
            
        </p></div>

        
        
        

        <div>
            
        </div>

        <footer class="post-footer">
            <div class="post-eof"></div>
            
        </footer>
    </article>
</div>




    


<div class="post-block">
    
    

    <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
        <link itemprop="mainEntityOfPage" href="https://ancao96.github.io/2023/08/12/2023-8-12-3%E5%B1%9E%E6%80%A7%E6%93%8D%E4%BD%9C/">

        <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
            <meta itemprop="image" content="/images/avatar.gif">
            <meta itemprop="name" content="SCY">
        </span>

        <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
            <meta itemprop="name" content="SCY SPACE">
            <meta itemprop="description" content>
        </span>

        <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
            <meta itemprop="name" content="undefined | SCY SPACE">
            <meta itemprop="description" content>
        </span>
        <header class="post-header">
            <h2 class="post-title" itemprop="name headline">
                <a href="/2023/08/12/2023-8-12-3%E5%B1%9E%E6%80%A7%E6%93%8D%E4%BD%9C/" class="post-title-link" itemprop="url">(3)属性操作</a>
            </h2>

            <div class="post-meta-container">
                <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-08-12 23:11:20" itemprop="dateCreated datePublished" datetime="2023-08-12T23:11:20+08:00">2023-08-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-09-02 14:32:31" itemprop="dateModified" datetime="2023-09-02T14:32:31+08:00">2023-09-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/R/" itemprop="url" rel="index"><span itemprop="name">R</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/R/Geocomputaion/" itemprop="url" rel="index"><span itemprop="name">Geocomputaion</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Waline：</span>
  
    <a title="waline" href="/2023/08/12/2023-8-12-3%E5%B1%9E%E6%80%A7%E6%93%8D%E4%BD%9C/#waline" itemprop="discussionUrl">
      <span class="post-comments-count waline-comment-count" data-path="/2023/08/12/2023-8-12-3%E5%B1%9E%E6%80%A7%E6%93%8D%E4%BD%9C/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>8.9k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>32 分钟</span>
    </span>
</div>

            </div>
        </header>

        
        
        
        <div class="post-body" itemprop="articleBody">
            <p>本章讲授如何基于属性来操作地理对象，例如矢量数据集中的公交站名和栅格数据集中像素的高程。对
于矢量数据，意味着应用例如<code>subsetting</code>和<code>aggregation</code>方法（参见矢量属性提取子集和矢量属性聚合章节）。和
创建属性移除空间信息章节演示了如何通过共享<strong>ID</strong>将数据连接到简单要素对象以及如何创建新变量。这
些操作都有空间等效功能：例如，基于属性和空间对象的<code>subsetting</code>操作都可以使用R中的<code>[</code>运算符；您还可以使用<code>spatial joins</code>将两个地理数据集的属性进行连接。本
章所培养的技能具有交叉传递性。<em>空</em>
<em>间数据操作</em>章节将本章介绍的方法扩展到空间方面。
            <!--noindex-->
            <div class="post-button">
                <a class="btn" href="/2023/08/12/2023-8-12-3%E5%B1%9E%E6%80%A7%E6%93%8D%E4%BD%9C/#more" rel="contents">
                    阅读全文 &raquo;
                </a>
            </div>
            <!--/noindex-->
            
            
        </p></div>

        
        
        

        <div>
            
        </div>

        <footer class="post-footer">
            <div class="post-eof"></div>
            
        </footer>
    </article>
</div>




    


<div class="post-block">
    
    

    <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
        <link itemprop="mainEntityOfPage" href="https://ancao96.github.io/2023/08/11/2023-8-11-2%E7%A9%BA%E9%97%B4%E6%95%B0%E6%8D%AE/">

        <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
            <meta itemprop="image" content="/images/avatar.gif">
            <meta itemprop="name" content="SCY">
        </span>

        <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
            <meta itemprop="name" content="SCY SPACE">
            <meta itemprop="description" content>
        </span>

        <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
            <meta itemprop="name" content="undefined | SCY SPACE">
            <meta itemprop="description" content>
        </span>
        <header class="post-header">
            <h2 class="post-title" itemprop="name headline">
                <a href="/2023/08/11/2023-8-11-2%E7%A9%BA%E9%97%B4%E6%95%B0%E6%8D%AE/" class="post-title-link" itemprop="url">(2)R中的地理数据</a>
            </h2>

            <div class="post-meta-container">
                <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-08-11 12:37:20" itemprop="dateCreated datePublished" datetime="2023-08-11T12:37:20+08:00">2023-08-11</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-09-06 20:03:19" itemprop="dateModified" datetime="2023-09-06T20:03:19+08:00">2023-09-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/R/" itemprop="url" rel="index"><span itemprop="name">R</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/R/Geocomputaion/" itemprop="url" rel="index"><span itemprop="name">Geocomputaion</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Waline：</span>
  
    <a title="waline" href="/2023/08/11/2023-8-11-2%E7%A9%BA%E9%97%B4%E6%95%B0%E6%8D%AE/#waline" itemprop="discussionUrl">
      <span class="post-comments-count waline-comment-count" data-path="/2023/08/11/2023-8-11-2%E7%A9%BA%E9%97%B4%E6%95%B0%E6%8D%AE/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>16k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>57 分钟</span>
    </span>
</div>

            </div>
        </header>

        
        
        
        <div class="post-body" itemprop="articleBody">
            <blockquote><p>本文由SCY翻译自《Geocomputation with R》<a target="_blank" rel="external nofollow noopener noreferrer" href="https://r.geocompx.org/spatial-class#spatial-class">第二章</a></p>
</blockquote>
<h1 id="r中的地理数据">R中的地理数据</h1>
<p>本章将简要介绍两种基本的地理数据模型：矢量和栅格。我们将介绍每种数据模型背后的理论以及它们在哪些学科中占主导地位,然后演示它们在R中的实现。</p>
            <!--noindex-->
            <div class="post-button">
                <a class="btn" href="/2023/08/11/2023-8-11-2%E7%A9%BA%E9%97%B4%E6%95%B0%E6%8D%AE/#more" rel="contents">
                    阅读全文 &raquo;
                </a>
            </div>
            <!--/noindex-->
            
            
        </div>

        
        
        

        <div>
            
        </div>

        <footer class="post-footer">
            <div class="post-eof"></div>
            
        </footer>
    </article>
</div>




    


<div class="post-block">
    
    

    <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
        <link itemprop="mainEntityOfPage" href="https://ancao96.github.io/2023/08/10/2023-8-10-1%E5%BC%95%E8%A8%80/">

        <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
            <meta itemprop="image" content="/images/avatar.gif">
            <meta itemprop="name" content="SCY">
        </span>

        <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
            <meta itemprop="name" content="SCY SPACE">
            <meta itemprop="description" content>
        </span>

        <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
            <meta itemprop="name" content="undefined | SCY SPACE">
            <meta itemprop="description" content>
        </span>
        <header class="post-header">
            <h2 class="post-title" itemprop="name headline">
                <a href="/2023/08/10/2023-8-10-1%E5%BC%95%E8%A8%80/" class="post-title-link" itemprop="url">(1)引言</a>
            </h2>

            <div class="post-meta-container">
                <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-08-10 18:29:20" itemprop="dateCreated datePublished" datetime="2023-08-10T18:29:20+08:00">2023-08-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-09-06 20:03:16" itemprop="dateModified" datetime="2023-09-06T20:03:16+08:00">2023-09-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/R/" itemprop="url" rel="index"><span itemprop="name">R</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/R/Geocomputaion/" itemprop="url" rel="index"><span itemprop="name">Geocomputaion</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Waline：</span>
  
    <a title="waline" href="/2023/08/10/2023-8-10-1%E5%BC%95%E8%A8%80/#waline" itemprop="discussionUrl">
      <span class="post-comments-count waline-comment-count" data-path="/2023/08/10/2023-8-10-1%E5%BC%95%E8%A8%80/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>8.5k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>31 分钟</span>
    </span>
</div>

            </div>
        </header>

        
        
        
        <div class="post-body" itemprop="articleBody">
            <blockquote><p>本文由SCY翻译自《Geocomputation with R》<a target="_blank" rel="external nofollow noopener noreferrer" href="https://r.geocompx.org/intro#intro">第一章</a></p>
</blockquote>
<p>这本书是关于使用计算机的力量来处理地理数据的。它教授一系列的空间技能，包括：读、写和操作地理数据；制作静态和交互式地图；应用地理计算解决现实问题；并对地理现象进行建模。通过展示各种地理操作是如何联系在一起的，在穿插的可复制"代码块"中，本书还教授了一个透明而科学的工作流程。学习如何使用R命令行提供的丰富的地理空间工具令人兴奋，但创建新的工具可以真正解放。使用贯穿始终的命令行驱动方法，以及章节所涵盖的编程技术，可以帮助消除软件对您的创造力施加的限制。在读完这本书和完成练习后，你应该对R令人印象深刻的地理能力所开辟的可能性有很强的理解，用地理数据解决现实世界问题的新技能，以及用地图和可复制的代码来交流你的工作的能力。
            <!--noindex-->
            <div class="post-button">
                <a class="btn" href="/2023/08/10/2023-8-10-1%E5%BC%95%E8%A8%80/#more" rel="contents">
                    阅读全文 &raquo;
                </a>
            </div>
            <!--/noindex-->
            
            
        </p></div>

        
        
        

        <div>
            
        </div>

        <footer class="post-footer">
            <div class="post-eof"></div>
            
        </footer>
    </article>
</div>




    


<div class="post-block">
    
    

    <article itemscope itemtype="http://schema.org/Article" class="post-content" lang>
        <link itemprop="mainEntityOfPage" href="https://ancao96.github.io/2020/10/20/2023-8-20-%E4%BA%A7%E6%B0%B4%E9%87%8F%E8%AE%A1%E7%AE%97/">

        <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
            <meta itemprop="image" content="/images/avatar.gif">
            <meta itemprop="name" content="SCY">
        </span>

        <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
            <meta itemprop="name" content="SCY SPACE">
            <meta itemprop="description" content>
        </span>

        <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
            <meta itemprop="name" content="undefined | SCY SPACE">
            <meta itemprop="description" content>
        </span>
        <header class="post-header">
            <h2 class="post-title" itemprop="name headline">
                <a href="/2020/10/20/2023-8-20-%E4%BA%A7%E6%B0%B4%E9%87%8F%E8%AE%A1%E7%AE%97/" class="post-title-link" itemprop="url">产水量计算</a>
            </h2>

            <div class="post-meta-container">
                <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-10-20 20:45:20" itemprop="dateCreated datePublished" datetime="2020-10-20T20:45:20+08:00">2020-10-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-09-01 14:31:43" itemprop="dateModified" datetime="2023-09-01T14:31:43+08:00">2023-09-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Ecosystem-service/" itemprop="url" rel="index"><span itemprop="name">Ecosystem service</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Ecosystem-service/Annual-Water-Yield/" itemprop="url" rel="index"><span itemprop="name">Annual Water Yield</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Waline：</span>
  
    <a title="waline" href="/2020/10/20/2023-8-20-%E4%BA%A7%E6%B0%B4%E9%87%8F%E8%AE%A1%E7%AE%97/#waline" itemprop="discussionUrl">
      <span class="post-comments-count waline-comment-count" data-path="/2020/10/20/2023-8-20-%E4%BA%A7%E6%B0%B4%E9%87%8F%E8%AE%A1%E7%AE%97/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>5.7k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>21 分钟</span>
    </span>
</div>

            </div>
        </header>

        
        
        
        <div class="post-body" itemprop="articleBody">
            <h1 id="产水量模型">产水量模型</h1>
<p>InVEST模型的产水量：水库水电生产模块，不仅评估了景观中各次一级流域对产水的相对贡献量，而且有助于研究土地利用格局变化如何影响年地表产水量和水电生产。</p>
<p>模拟景观格局变化和水文过程的关系是个科学难题。用来模拟这些关系及其相关
过程的复杂模型（如WEAP水资源评估和规划系统模型）要求较高的数据和资源资料，并且要求大量专业知识。为满足更多学科背景需求，使用易获取的数据，InVEST模型绘制和模拟用于景观水电生产的年平均产水量，而不是直接评估土地利用/覆被变化导致的水电减产，因为这一过程在逐日和逐月的时间尺度上主要由流入水量变化决定。
因此，InVEST模型计算了景观中各子流域对产水的相对贡献量及其对应的水电产量。
水库经济使用年限内的水电生产净现值也可以通过年收益还原法计算。
            <!--noindex-->
            <div class="post-button">
                <a class="btn" href="/2020/10/20/2023-8-20-%E4%BA%A7%E6%B0%B4%E9%87%8F%E8%AE%A1%E7%AE%97/#more" rel="contents">
                    阅读全文 &raquo;
                </a>
            </div>
            <!--/noindex-->
            
            
        </p></div>

        
        
        

        <div>
            
        </div>

        <footer class="post-footer">
            <div class="post-eof"></div>
            
        </footer>
    </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="上一页" aria-label="上一页" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span>
  </nav>

</div>
    </main>
    <footer class="footer">
      <div class="footer-inner">

<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="站点总字数">168k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">10:12</span>
  </span>
</div>
<div class="busuanzi-count">
</div>

<!-- 删除 “由 Hexo & NexT.Gemini 强力驱动” -->
<!-- -->

      </div>
    </footer>
    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>

    
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/next-theme-pjax/0.6.0/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.20/fancybox/fancybox.umd.js" integrity="sha256-q8XkJ6dj5VwSvzI8+nATCHHQG+Xv/dAZBCgqmu93zOY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lozad.js/1.16.0/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pangu/4.0.7/pangu.min.js" integrity="sha256-j+yj56cdEY2CwkVtGyz18fNybFGpMGJ8JxG3GSyO2+I=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script><script src="/js/pjax.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/algoliasearch/4.19.1/algoliasearch-lite.umd.js" integrity="sha256-qzlNbRtZWHoUV5I2mI2t9QR7oYXlS9oNctX+0pECXI0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/instantsearch.js/4.56.8/instantsearch.production.min.js" integrity="sha256-xUys6KCuRGBxFaRaYZlWulRUjY48XFv6/Q2s0mb1dmc=" crossorigin="anonymous"></script><script src="/js/third-party/search/algolia-search.js"></script>
<script class="next-config" data-name="chatra" type="application/json">{"enable":true,"async":true,"id":null}</script>
<script src="/js/third-party/chat/chatra.js"></script>
<script async src="https://call.chatra.io/chatra.js"></script>

  <script class="next-config" data-name="pdf" type="application/json">{"object_url":{"url":"https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.2.12/pdfobject.min.js","integrity":"sha256-g2xji1rlE3KsGVClvuxTbcR0Kn2+wtQADSff2Tbb4zA="},"url":"/lib/pdf/web/viewer.html"}</script>
  <script src="/js/third-party/tags/pdf.js"></script>

  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.3.0/mermaid.min.js","integrity":"sha256-9y71g5Lz/KLsHjB8uXwnkuWDtAMDSzD/HdIbqhJfTAI="}}</script>
  <script src="/js/third-party/tags/mermaid.js"></script>

  <script class="next-config" data-name="wavedrom" type="application/json">{"enable":true,"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/wavedrom/3.3.0/wavedrom.min.js","integrity":"sha256-IRMDzTC+wK5stMucZ/XSXkeS5VNtxZ+/Bm8Mcqfoxdo="}}</script>
  <script class="next-config" data-name="wavedrom_skin" type="application/json">{"enable":true,"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/wavedrom/3.3.0/skins/default.js","integrity":"sha256-fduc/Zszk5ezWws2uInY/ALWVmIrmV6VTgXbsYSReFI="}}</script>
  <script src="/js/third-party/tags/wavedrom.js"></script>

  <script src="/js/third-party/fancybox.js"></script>


  <script src="/js/third-party/addtoany.js"></script>

    
  <script data-pjax async src="/js/busuanzi.js"></script>



  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"ams","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>


  <script src="https://cdnjs.cloudflare.com/ajax/libs/quicklink/2.3.0/quicklink.umd.js" integrity="sha256-yvJQOINiH9fWemHn0vCA5lsHWJaHs6/ZmO+1Ft04SvM=" crossorigin="anonymous"></script>
  <script class="next-config" data-name="quicklink" type="application/json">{"enable":true,"home":true,"archive":true,"delay":true,"timeout":3000,"priority":true,"url":"https://ancao96.github.io/page/2/"}</script>
  <script src="/js/third-party/quicklink.js"></script>
<script class="next-config" data-name="waline" type="application/json">{"lang":"zh-cn","enable":true,"serverURL":"https://waline-server-nxpj3ksyo-scy.vercel.app","cssUrl":"https://unpkg.com/@waline/client@v2/dist/waline.css","commentCount":true,"pageview":false,"placeholder":"请文明评论呀~","avatar":"mm","meta":["nick","mail","link"],"pageSize":10,"visitor":true,"comment_count":true,"requiredFields":["nick","mail"],"libUrl":"//unpkg.com/@waline/client@v2/dist/waline.js","eemoji":["https://unpkg.com/@waline/emojis@1.1.0/tw-emoji","//unpkg.com/@waline/emojis@1.1.0/bilibili","//unpkg.com/@waline/emojis@1.1.0/alus","https://unpkg.com/@waline/emojis@1.1.0/weibo"],"el":"#waline","comment":true,"path":"/page/2/"}</script>
<link rel="stylesheet" href="https://unpkg.com/@waline/client@v2/dist/waline.css">
<script>
document.addEventListener('page:loaded', () => {
  NexT.utils.loadComments(CONFIG.waline.el).then(() =>
    NexT.utils.getScript(CONFIG.waline.libUrl, { condition: window.Waline })
  ).then(() => 
    Waline.init(Object.assign({}, CONFIG.waline,{ el: document.querySelector(CONFIG.waline.el) }))
  );
});
</script>

    <link rel="stylesheet" href="/dist/APlayer.min.css">
    <div id="aplayer"></div>
    <script type="text/javascript" src="/dist/APlayer.min.js"></script>
    <script type="text/javascript" src="/dist/music.js"></script>
    
  </body>
</html>
