<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>产水量计算</title>
    <url>/2020/10/20/%E4%BA%A7%E6%B0%B4%E9%87%8F%E6%A8%A1%E5%9E%8B-b63tyHRMm8fk2BrGA64LsT/</url>
    <content><![CDATA[<h1 id="产水量模型"><a class="markdownIt-Anchor" href="#产水量模型"></a> 产水量模型</h1>
<p>InVEST模型的产水量：水库水电生产模块，不仅评估了景观中各次一级流域对产水的相对贡献量，而且有助于研究土地利用格局变化如何影响年地表产水量和水电生产。</p>
<p>模拟景观格局变化和水文过程的关系是个科学难题。用来模拟这些关系及其相关 过程的复杂模型（如WEAP水资源评估和规划系统模型）要求较高的数据和资源资料，并且要求大量专业知识。为满足更多学科背景需求，使用易获取的数据，InVEST模型绘制和模拟用于景观水电生产的年平均产水量，而不是直接评估土地利用/覆被变化导致的水电减产，因为这一过程在逐日和逐月的时间尺度上主要由流入水量变化决定。 因此，InVEST模型计算了景观中各子流域对产水的相对贡献量及其对应的水电产量。 水库经济使用年限内的水电生产净现值也可以通过年收益还原法计算。</p>
<span id="more"></span>
<ul>
<li>
<p><a href="#%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86">工作原理</a></p>
</li>
<li>
<p><a href="#%E6%95%B0%E6%8D%AE%E9%9C%80%E6%B1%82">数据需求</a></p>
<ul>
<li><a href="#%E5%9C%9F%E5%A3%A4%E7%9A%84%E6%9C%80%E5%A4%A7%E6%A0%B9%E7%B3%BB%E5%9F%8B%E8%97%8F%E6%B7%B1%E5%BA%A6%E5%BF%85%E9%9C%80">土壤的最大根系埋藏深度（必需）：</a></li>
<li><a href="#%E5%B9%B4%E9%99%8D%E6%B0%B4%E9%87%8F%E5%BF%85%E9%9C%80">年降水量（必需）：</a></li>
<li><a href="#%E6%A4%8D%E7%89%A9%E5%8F%AF%E5%88%A9%E7%94%A8%E6%B0%B4%E9%87%8F%E5%BF%85%E9%9C%80">植物可利用水量（必需）：</a></li>
<li><a href="#%E5%B9%B4%E5%B9%B3%E5%9D%87%E6%BD%9C%E5%9C%A8%E8%92%B8%E6%95%A3%E5%8F%91%E5%BF%85%E9%9C%80">年平均潜在蒸散发（必需）：</a></li>
<li><a href="#%E5%9C%9F%E5%9C%B0%E5%88%A9%E7%94%A8%E8%A6%86%E8%A2%AB%E5%BF%85%E9%9C%80">土地利用/覆被（必需）：</a></li>
<li><a href="#%E6%B5%81%E5%9F%9F%E5%BF%85%E9%9C%80">流域（必需）：</a></li>
<li><a href="#%E6%AC%A1%E4%B8%80%E7%BA%A7%E5%B0%8F%E6%B5%81%E5%9F%9F%E5%BF%85%E9%9C%80">次一级小流域（必需）：</a></li>
<li><a href="#%E7%94%9F%E7%89%A9%E7%89%A9%E7%90%86%E7%B3%BB%E6%95%B0%E8%A1%A8%E5%BF%85%E9%9C%80">生物物理系数表（必需）：</a></li>
<li><a href="#%E5%AD%A3%E8%8A%82%E5%B8%B8%E6%95%B0Z%E5%BF%85%E9%9C%80">季节常数Z（必需）：</a></li>
<li><a href="#%E7%94%A8%E6%B0%B4%E9%9C%80%E6%B1%82%E8%A1%A8%E5%BF%85%E9%9C%80">用水需求表（必需）：</a></li>
</ul>
</li>
<li>
<p><a href="#%E7%BB%93%E6%9E%9C%E5%88%86%E6%9E%90">结果分析</a></p>
</li>
</ul>
<h1 id="工作原理"><a class="markdownIt-Anchor" href="#工作原理"></a> <em>工作原理</em></h1>
<p>模型运行基于栅格地图。模型估算了研究区各次一级流域对水电生产贡献水量及其经济价值。模块包括三个组件，按顺序运行。</p>
<ol>
<li>模型估算了每栅格单元降水量减去实际蒸散发后的水量即水源供给量。 模型不做地表水、地下水、基流的区分，而是假设每个栅格单元的产水通过上述途径汇集到信息点。然后，模型计算出次一级流域产水量的总量和平均值。栅格计算有助于确定决定流域产汇流空间异质性的关键因素，如土壤类型，降水量，植被类型等。 但是，这组模型的基础理论基于次一级流域到流域尺度，对次一级流域过程的模型解释是可信的，因此产水量的总量和/或平均值结果也应当维持在次一级流域水平上。模型仅为校准和模型检验提供输出结果的栅格数据。这些栅格数据图件不能用于水文过程的解释说明，或作为任何类型的决策信息源。</li>
<li>模型计算了用于水电生产的水源供给量，即将水源供给总量减去除水电生产以外的其他用水量。</li>
<li>模型计算了到达水库水流的发电量及其水库有效使用年期内的经济价值。</li>
</ol>
<p><em><strong>NOTE</strong></em>: Water Yield 模块运行的前提条件是假设栅格单元的产水量都是通过地表径流或 者地下径流的方式汇集到流域出口，在这个前提条件下计算每个栅格单元的产水量, 即降水量减去植被蒸腾与地表蒸散。</p>
<p><em><strong>产水量评估模型</strong></em></p>
<p>产水量评估模块基于Budyko水热耦合平衡假设（1974）和年平均降水量数据。首先，确定研究区每个栅格单元<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">x</span></span></span></span>的年产水量<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">Y(x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span>，公式如下：</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>Y</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><mrow><mo fence="true">(</mo><mn>1</mn><mo>−</mo><mfrac><mrow><mi>A</mi><mi>E</mi><mi>T</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><mrow><mi>P</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow></mfrac><mo fence="true">)</mo></mrow><mo>⋅</mo><mi>P</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">Y(x)=\left(1-\frac{A E T(x)}{P(x)}\right) \cdot P(x)
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.40003em;vertical-align:-0.95003em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span></span></p>
<p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mi>E</mi><mi>T</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">AET(x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span>表示栅格单元<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">x</span></span></span></span>的年实际蒸散量、<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">P(x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span>表示栅格单元<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">x</span></span></span></span>的年降水量。</p>
<p>水量平衡公式中，土地利用/覆被类型的植被蒸散发<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mrow><mi>A</mi><mi>E</mi><mi>T</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><mrow><mi>P</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow></mfrac></mrow><annotation encoding="application/x-tex">\frac{A E T(x)}{P(x)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.53em;vertical-align:-0.52em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.01em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">P</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight">x</span><span class="mclose mtight">)</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.485em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">A</span><span class="mord mathnormal mtight" style="margin-right:0.05764em;">E</span><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight">x</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.52em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>计算，采用Fu和Zhang等提出的Budyko水热耦合平衡假设公式：</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mfrac><mrow><mi>A</mi><mi>E</mi><mi>T</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><mrow><mi>P</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow></mfrac><mo>=</mo><mn>1</mn><mo>+</mo><mfrac><mrow><mi>P</mi><mi>E</mi><mi>T</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><mrow><mi>P</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow></mfrac><mo>−</mo><msup><mrow><mo fence="true">[</mo><mn>1</mn><mo>+</mo><msup><mrow><mo fence="true">(</mo><mfrac><mrow><mi>P</mi><mi>E</mi><mi>T</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><mrow><mi>P</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow></mfrac><mo fence="true">)</mo></mrow><mi>ω</mi></msup><mo fence="true">]</mo></mrow><mrow><mn>1</mn><mi mathvariant="normal">/</mi><mi>ω</mi></mrow></msup></mrow><annotation encoding="application/x-tex">\frac{A E T(x)}{P(x)}=1+\frac{P E T(x)}{P(x)}-\left[1+\left(\frac{P E T(x)}{P(x)}\right)^{\omega}\right]^{1 / \omega}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.363em;vertical-align:-0.936em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:2.363em;vertical-align:-0.936em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:2.732222em;vertical-align:-0.95003em;"></span><span class="minner"><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">[</span></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="minner"><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.504292em;"><span style="top:-3.9029000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">ω</span></span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">]</span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.782192em;"><span style="top:-3.957192em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">/</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">ω</span></span></span></span></span></span></span></span></span></span></span></span></span></p>
<p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mi>E</mi><mi>T</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">PET(x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span><strong>表示潜在蒸散量</strong>、<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ω</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">ω(x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">ω</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span>表示自然气候-土壤性质的非物理参数。<br />
潜在蒸散量<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mi>E</mi><mi>T</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">PET(x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span>定义为：</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mrow><mi>P</mi><mi>E</mi><mi>T</mi></mrow><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><msub><mi>K</mi><mi>c</mi></msub><mrow><mo fence="true">(</mo><msub><mi mathvariant="normal">ℓ</mi><mi>x</mi></msub><mo fence="true">)</mo></mrow><mo>⋅</mo><mi>E</mi><msub><mi>T</mi><mn>0</mn></msub><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">{PET}(x)=K_{c}\left(\ell_{x}\right) \cdot E T_{0}(x)
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord">ℓ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">x</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span></span></p>
<p>式中，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><msub><mi>T</mi><mn>0</mn></msub><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">ET_0(x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span>表示栅格单元<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">x</span></span></span></span>的参考作物蒸散，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>K</mi><mi>c</mi></msub><mo stretchy="false">(</mo><msub><mi mathvariant="normal">ℓ</mi><mi>x</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">K_c(\ell_x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord">ℓ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>表示栅格单元<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">x</span></span></span></span>中特定土地利用/覆被类型的植物（植被）蒸散系数。<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><msub><mi>T</mi><mn>0</mn></msub><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">ET_0(x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span>通过参考作物蒸散量反映当地气候条件，例如苜蓿的蒸散量反映其草地生境气候。<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>K</mi><mi>c</mi></msub><mo stretchy="false">(</mo><msub><mi mathvariant="normal">ℓ</mi><mi>x</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">K_c(\ell_x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord">ℓ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>很大程度上取决于栅格单元<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">x</span></span></span></span>中土地利用/覆被的植被性质。在土地利用/覆被图中，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>K</mi><mi>c</mi></msub></mrow><annotation encoding="application/x-tex">K_c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>用于将<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><msub><mi>T</mi><mn>0</mn></msub><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">ET_0(x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span>修正为栅格单元中特定作物或植被类型蒸散量。</p>
<p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ω</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">ω(x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">ω</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span>是一个经验参数，通常用<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mrow><mi>A</mi><mi>W</mi><mi>C</mi><mo>×</mo><mi>N</mi></mrow><mi>P</mi></mfrac></mrow><annotation encoding="application/x-tex">\frac{A W C \times N}{P}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.217331em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.872331em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">P</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">A</span><span class="mord mathnormal mtight" style="margin-right:0.13889em;">W</span><span class="mord mathnormal mtight" style="margin-right:0.07153em;">C</span><span class="mbin mtight">×</span><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>线性函数表示，式中<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi></mrow><annotation encoding="application/x-tex">N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span></span></span></span>表示每年的降水事件数，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mi>W</mi><mi>C</mi></mrow><annotation encoding="application/x-tex">AWC</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span></span></span></span>表示植物可利用水含量。虽然基于全球数据的$ ω(x)  $公式亟待进一步研究， InVEST模型采用Donohue等人提出的公式表达，定义为：</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow></mrow><annotation encoding="application/x-tex"></annotation></semantics></math></span><span class="katex-html" aria-hidden="true"></span></span></span></p>
<ul>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mi>W</mi><mi>C</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">AWC(x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span>表示土壤有效含水量（mm），由土壤质地和土壤有效深度决定，用来确定土壤为植物生长储存和提供的总水量。由植物利用水分含量<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>P</mi><mi>A</mi><mi>W</mi><mi>C</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(PAWC)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mclose">)</span></span></span></span>， 以及土壤的最大根系埋藏深度和植物根系深度的最小值决定：</li>
</ul>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>A</mi><mi>W</mi><mi>C</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><mi mathvariant="normal">Min</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>R</mi><mi>e</mi><mi>s</mi><mi>t</mi><mi mathvariant="normal">.</mi><mi>l</mi><mi>a</mi><mi>y</mi><mi>e</mi><mi>r</mi><mi mathvariant="normal">.</mi><mi>d</mi><mi>e</mi><mi>p</mi><mi>t</mi><mi>h</mi><mo separator="true">,</mo><mi>r</mi><mi>o</mi><mi>o</mi><mi>t</mi><mi mathvariant="normal">.</mi><mi>d</mi><mi>e</mi><mi>p</mi><mi>t</mi><mi>h</mi><mo stretchy="false">)</mo><mo>⋅</mo><mi>P</mi><mi>A</mi><mi>W</mi><mi>C</mi></mrow><annotation encoding="application/x-tex">A W C(x)=\operatorname{Min}( Re st.layer.depth, root.depth ) \cdot PAWC
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop"><span class="mord mathrm">M</span><span class="mord mathrm">i</span><span class="mord mathrm">n</span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mord mathnormal">e</span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mord">.</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord">.</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal">p</span><span class="mord mathnormal">t</span><span class="mord mathnormal">h</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">o</span><span class="mord mathnormal">o</span><span class="mord mathnormal">t</span><span class="mord">.</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal">p</span><span class="mord mathnormal">t</span><span class="mord mathnormal">h</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span></span></span></span></span></p>
<p>土壤的最大根系埋藏深度是指由于环境的物理和化学特征不同，植物根系在土壤中能够延伸的最大深度（也叫土壤深度）。植物根系深度通常指特定植物类型的根系生物量为95%的土层深度。<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mi>A</mi><mi>W</mi><mi>C</mi></mrow><annotation encoding="application/x-tex">PAWC</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span></span></span></span>表示植物利用水分含量，即田间持水量和萎蔫点之间的差值。</p>
<ul>
<li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Z</mi></mrow><annotation encoding="application/x-tex">Z</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">Z</span></span></span></span>为经验常数，又称<code>季节常数</code>，能够代表区域降水分布及其他水文地质特征。<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Z</mi></mrow><annotation encoding="application/x-tex">Z</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">Z</span></span></span></span>与<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi></mrow><annotation encoding="application/x-tex">N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span></span></span></span>正相关，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi></mrow><annotation encoding="application/x-tex">N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span></span></span></span>是每年降水发生次数。1.25为<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ω</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">ω(x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">ω</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span>基数，即裸地（根系深度为0）的植被年需水量和年降水量比值。<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ω</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">ω(x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">ω</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span>上限为5。</li>
</ul>
<p>其他土地利用/覆被类型（开放水域，城市，湿地）的实际蒸散发通过参考作物蒸散<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><msub><mi>T</mi><mn>0</mn></msub><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">ET_0(x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span>直接计算，由降水量决定其最大值：</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>A</mi><mi>E</mi><mi>T</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><mi mathvariant="normal">Min</mi><mo>⁡</mo><mrow><mo fence="true">(</mo><msub><mi>K</mi><mi>c</mi></msub><mrow><mo fence="true">(</mo><msub><mi mathvariant="normal">ℓ</mi><mi>x</mi></msub><mo fence="true">)</mo></mrow><mo>⋅</mo><mi>E</mi><msub><mi>T</mi><mn>0</mn></msub><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo separator="true">,</mo><mi>P</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">A E T(x)=\operatorname{Min}\left(K_{c}\left(\ell_{x}\right) \cdot E T_{0}(x), P(x)\right)
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop"><span class="mord mathrm">M</span><span class="mord mathrm">i</span><span class="mord mathrm">n</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord">ℓ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">x</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span></span></p>
<p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><msub><mi>T</mi><mn>0</mn></msub><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">ET_0(x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span>表示参考作物蒸散，而<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>K</mi><mi>c</mi></msub><mo stretchy="false">(</mo><msub><mi mathvariant="normal">ℓ</mi><mi>x</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">K_c(\ell_x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord">ℓ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>表示特定土地利用/覆被类型蒸腾作用的影响因子。</p>
<h1 id="数据需求"><a class="markdownIt-Anchor" href="#数据需求"></a> <em><strong>数据需求</strong></em></h1>
<p>模型使用的数据需求列表如下，关于数据来源和预处理的详细信息见附录。所有数据输入前，应先定义栅格数据投影，栅格单位为米（m）。</p>
<h2 id="土壤的最大根系埋藏深度必需"><a class="markdownIt-Anchor" href="#土壤的最大根系埋藏深度必需"></a> 土壤的最大根系埋藏深度（必需）：</h2>
<p>每个栅格对应一个土壤的最大根系埋藏深度平均值的GIS栅格数据集。土壤的最大根系埋藏深度是指由于环境的物理和化学特征不同，植物根系在土壤中能够延伸的最大深度，单位毫米（mm）。根系限制层深度可从一些土壤图中获得。如果无法获得根系限制层深度或按土壤类型划分的可扎根深度，可使用土壤深度作为替代。如果有几个土壤层是详细的，那么限制根系层的深度就是非限制性土壤层的深度之和。</p>
<p>*命名：*用户自定义，但若为ESRI GRID格式，文件名不能有空格并且少于13个字， 若为TIF或IMG格式，命名可能更长。</p>
<p><em>格式：</em> GIS标准栅格文件（如：ESRI GRID，TIF或IMG），每个栅格对应一个土壤的最大根系埋藏深度平均值，单位毫米（mm）。</p>
<p><em>数据获得：</em></p>
<ol>
<li><a href="http://globalchange.bnu.edu.cn/research/cdtb.jsp" title="http://globalchange.bnu.edu.cn/research/cdtb.jsp">http://globalchange.bnu.edu.cn/research/cdtb.jsp</a> （单位为m，需转化为mm，已下载处理，上传百度☁️）<br />
原文 <a href="https://doi.org/10.1038/s41597-019-0345-6" title="https://doi.org/10.1038/s41597-019-0345-6">https://doi.org/10.1038/s41597-019-0345-6</a></li>
<li>SoilGrids250m 2017-03 - Depth to bedrock (R horizon)  （单位为cm，需转化为mm）<a href="https://data.isric.org/geonetwork/srv/eng/catalog.search#/metadata/bfb01655-db81-4571-b6eb-3caae86c037a" title="https://data.isric.org/geonetwork/srv/eng/catalog.search#/metadata/bfb01655-db81-4571-b6eb-3caae86c037a">https://data.isric.org/geonetwork/srv/eng/catalog.search#/metadata/bfb01655-db81-4571-b6eb-3caae86c037a</a></li>
</ol>
<h2 id="年降水量必需"><a class="markdownIt-Anchor" href="#年降水量必需"></a> 年降水量（必需）：</h2>
<p>每个栅格对应一个非空值的<strong>年平均降水量</strong>的GIS栅格数据集，单位毫米（mm）。</p>
<p><em>命名</em>：用户自定义，但若为ESRI GRID格式，文件名不能有空格并且少于13个字， 若为TIF或IMG格式，命名可能更长。</p>
<p><em>格式</em>：GIS标准栅格文件（如：ESRI GRID，TIF或IMG），每个栅格对应一个年平 均降水量。</p>
<p><em>数据获得</em>：</p>
<ol>
<li>利用<a href="https://www.wolai.com/pLvSQy6dLBrwJX9ATDTiy4" title="日值（v3）数据">日值（v3）数据</a>进行差值。</li>
<li>国家地球系统科学数据中心：中国1km分辨率年降水量数据（2001-2020年）已下载直接使用，单位为0.1mm  <a href="http://www.geodata.cn/data/datadetails.html?dataguid=113786088533256&amp;docid=3549" title="http://www.geodata.cn/data/datadetails.html?dataguid=113786088533256&amp;docid=3549">http://www.geodata.cn/data/datadetails.html?dataguid=113786088533256&amp;docid=3549</a></li>
<li>WorldClim (v 2.1) 数据范围：1970-2000，月值，最大精度：30s ，单位:mm <a href="https://www.worldclim.org/data/worldclim21.html" title="https://www.worldclim.org/data/worldclim21.html">https://www.worldclim.org/data/worldclim21.html</a></li>
<li>GEE （“UCSB-CHG/CHIRPS/DAILY”)数据集，完整教程见<a href="https://www.wolai.com/mQ6iivaJ3BAPg21kq2uXsE" title="编程分享-利用GEE得到研究区年、月、日降水量数据">编程分享-利用GEE得到研究区年、月、日降水量数据</a></li>
</ol>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="variable constant_">ROI</span> = ee.<span class="title class_">FeatureCollection</span>(<span class="string">&quot;users/rice20220411/AH&quot;</span>);</span><br><span class="line"><span class="title class_">Map</span>.<span class="title function_">addLayer</span>(<span class="variable constant_">ROI</span>,&#123;&#125;,<span class="string">&#x27;ROI&#x27;</span>);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">2015</span>;i&lt;=<span class="number">2021</span>;i++)&#123;</span><br><span class="line"><span class="keyword">var</span> CHIRPS_Daily = ee.<span class="title class_">ImageCollection</span>(<span class="string">&quot;UCSB-CHG/CHIRPS/DAILY&quot;</span>)</span><br><span class="line">.<span class="title function_">filterDate</span>(i+<span class="string">&#x27;-01-01&#x27;</span>, i+<span class="string">&#x27;-12-31&#x27;</span>)</span><br><span class="line"> .<span class="title function_">select</span>(<span class="string">&#x27;precipitation&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> CHIRPS_Year_mean = CHIRPS_Daily.<span class="title function_">mean</span>().<span class="title function_">clip</span>(<span class="variable constant_">ROI</span>)</span><br><span class="line"><span class="keyword">var</span> precipitationVis = &#123;</span><br><span class="line">  <span class="attr">min</span>: <span class="number">1.0</span>,</span><br><span class="line">  <span class="attr">max</span>: <span class="number">17.0</span>,</span><br><span class="line">  <span class="attr">palette</span>: [<span class="string">&#x27;001137&#x27;</span>, <span class="string">&#x27;0aab1e&#x27;</span>, <span class="string">&#x27;e7eb05&#x27;</span>, <span class="string">&#x27;ff4a2d&#x27;</span>, <span class="string">&#x27;e90000&#x27;</span>],</span><br><span class="line">&#125;;</span><br><span class="line"><span class="title function_">print</span>(CHIRPS_Year_mean)</span><br><span class="line"><span class="title class_">Map</span>.<span class="title function_">addLayer</span>(CHIRPS_Year_mean, precipitationVis, i+<span class="string">&#x27;_CHIRPS_Year_mean&#x27;</span>);</span><br><span class="line"><span class="comment">// Map.addLayer(CHIRPS_Daily.first().clip(ROI), precipitationVis, &#x27;CHIRPS_Year_mean_first&#x27;);</span></span><br><span class="line"><span class="title class_">Export</span>.<span class="property">image</span>.<span class="title function_">toDrive</span>(&#123;</span><br><span class="line">      <span class="attr">image</span>: CHIRPS_Year_mean,</span><br><span class="line">      <span class="attr">description</span>: i+<span class="string">&#x27;year_mean&#x27;</span>,</span><br><span class="line">      <span class="attr">region</span>: <span class="variable constant_">ROI</span>,</span><br><span class="line">      <span class="attr">maxPixels</span>: <span class="number">1e13</span>,</span><br><span class="line">      <span class="attr">folder</span>: <span class="string">&#x27;CHIRPS&#x27;</span></span><br><span class="line">    &#125;) </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<h2 id="植物可利用水量必需"><a class="markdownIt-Anchor" href="#植物可利用水量必需"></a> 植物可利用水量（必需）：</h2>
<p>每个栅格对应一个植物可利用水的GIS栅格数据集。 植物可利用水（PAWC）是指土壤土层中为植物生长提供的水量所占比例。PAWC是[0,1]的小数。</p>
<p><em>命名</em>：用户自定义，但若为ESRI GRID格式，文件名不能有空格并且少于13个字， 若为TIF或IMG格式，命名可能更长。 </p>
<p><em>格式</em>：GIS标准栅格文件（如：ESRI GRID，TIF或IMG），每个栅格对应一个植物可利用水含量百分比。</p>
<p><em>数据获得</em>：（下载好处理好后传百度☁️）</p>
<p>SoilGrids250m 2017-03 - “Derived available soil water capacity (volumetric fraction) until wilting point” (<a href="https://data.isric.org/geonetwork/srv/eng/catalog.search#/metadata/e33e75c0-d9ab-46b5-a915-cb344345099c" title="https://data.isric.org/geonetwork/srv/eng/catalog.search#/metadata/e33e75c0-d9ab-46b5-a915-cb344345099c">https://data.isric.org/geonetwork/srv/eng/catalog.search#/metadata/e33e75c0-d9ab-46b5-a915-cb344345099c</a>)  SoilGrids 2.0版目前不提供AWC。SoilGrids 2017提供7个土壤深度区间的AWC层。所有7个深度区间都需要下载，然后合并成一个单一的图层，以便在模型中使用。</p>
<p>栅格值以整数百分比的形式给出（如25，表示AWC值为25%）。<br />
（标准）深度区间的平均值，如0-5厘米或0-30厘米，可以通过使用数字积分，如梯形规则，对深度区间内的预测值进行加权平均来得出：</p>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mrow><mo fence="true">(</mo><mfrac><mn>1</mn><mrow><mo stretchy="false">(</mo><mi>b</mi><mo>−</mo><mi>a</mi><mo stretchy="false">)</mo></mrow></mfrac><mo fence="true">)</mo></mrow><mrow><mo fence="true">(</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><mo fence="true">)</mo></mrow><munderover><mo>∑</mo><mrow><mi>k</mi><mo>=</mo><mn>1</mn></mrow><mrow><mi>N</mi><mo>−</mo><mn>1</mn></mrow></munderover><mrow><mo fence="true">(</mo><msub><mi>x</mi><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>−</mo><msub><mi>x</mi><mi>k</mi></msub><mo fence="true">)</mo></mrow><mrow><mo fence="true">(</mo><mi>f</mi><mrow><mo fence="true">(</mo><msub><mi>x</mi><mi>k</mi></msub><mo fence="true">)</mo></mrow><mo>+</mo><mi>f</mi><mrow><mo fence="true">(</mo><msub><mi>x</mi><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow></msub><mo fence="true">)</mo></mrow><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">\left(\frac{1}{(b-a)}\right)\left(\frac{1}{2}\right) \sum_{k=1}^{N-1}\left(x_{k+1}-x_{k}\right)\left(f\left(x_{k}\right)+f\left(x_{k+1}\right)\right)
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3.1304490000000005em;vertical-align:-1.302113em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mopen">(</span><span class="mord mathnormal">b</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathnormal">a</span><span class="mclose">)</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8283360000000002em;"><span style="top:-1.8478869999999998em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.0500049999999996em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.300005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.302113em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span></span></p>
<p>其中，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi></mrow><annotation encoding="application/x-tex">N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span></span></span></span>是深度数，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mi>k</mi></msub></mrow><annotation encoding="application/x-tex">x_k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>是第<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span>个深度，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><msub><mi>x</mi><mi>k</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">f(x_k)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>是目标变量（即土壤属性）在深度<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mi>k</mi></msub></mrow><annotation encoding="application/x-tex">x_k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>的值。</p>
<p>操作步骤：</p>
<ol>
<li>从ISRIC网站上下载所有可用的深度区间。深度区间为0cm-200cm。注意，每个栅格的大小为1.5GB。</li>
<li>使用 GIS 缓冲区工具，在你要建模的流域/感兴趣的区域周围创建一个缓冲区。由于SoilGrids数据的分辨率为250米，因此缓冲区的宽度为250或500米。这样做是为了确保土壤数据完全覆盖你正在建模的流域，边界周围没有漏洞。</li>
<li>使用缓冲流域，将所有原始的ISRIC AWC 栅格数据剪辑到你感兴趣的区域。在ArcGIS中，这可以通过空间分析工具<code>掩模提取</code>来完成。在这个例子中，我们将把剪下的图层称为AWC_sl1_clip.tif、AWC_sl2_clip.tif … AWC_sl7_clip.tif。</li>
<li>使用GIS栅格计算器工具来计算合并后的AWC层。将其代入上面的方程，我们可以得到：<p class='katex-block katex-error' title='ParseError: KaTeX parse error: Undefined control sequence: \* at position 13: (1/(200-0)) \̲*̲ (1/2) \* ( ((5…'>(1/(200-0)) \* (1/2) \* ( ((5-0) \* (AWC\_sl1\_clip.tif + AWC\_sl2\_clip.tif)) + ((15-5) \* (AWC\_sl2\_clip.tif + AWC\_sl3\_clip.tif)) + ((30-15) \* (AWC\_sl3\_clip.tif + AWC\_sl4\_clip.tif)) + ((60-30) \* (AWC\_sl4\_clip.tif + AWC\_sl5\_clip.tif)) + ((100-60) \* (AWC\_sl5\_clip.tif + AWC\_sl6\_clip.tif)) + ((200-100) \* ( AWC\_sl6\_clip.tif + AWC\_sl7\_clip.tif)) )
</p>
将此公式输入光栅计算器，根据需要调整文件名。</li>
<li>得到的栅格应该包含0-100范围内的数值，代表整数百分比。该模型<strong>要求AWC以分数</strong>的形式给出，因此将步骤4中计算的<strong>栅格除以100</strong>。</li>
<li>重新投影AWC分数层，使其具有与其他模型输入相同的投影坐标系统。这个栅格现在可以用作模型的可用水含量输入。</li>
</ol>
<h2 id="年平均潜在蒸散发必需"><a class="markdownIt-Anchor" href="#年平均潜在蒸散发必需"></a> 年平均潜在蒸散发（必需）：</h2>
<p> 每个栅格对应一个<strong>年平均潜在蒸散发</strong>的GIS栅格数据集。潜在蒸散发是指水分充足的情况下，通过土壤蒸发和植物（如苜蓿或其他草类等健康植被）蒸散作用可能散逸的水量，单位毫米（mm）。</p>
<p><em>命名</em>：用户自定义，但若为ESRI GRID格式，文件名不能有空格并且少于13个字，若为TIF或IMG格式，命名可能更长。 </p>
<p><em>格式</em>：GIS标准栅格文件（如：ESRI GRID，TIF或IMG），每个栅格对应一个年平均潜在蒸散发。</p>
<p><em>数据获得</em>：</p>
<ul>
<li>FA0工具计算，详见<a href="https://www.wolai.com/sWbxWLVBydbK2t5aT584Fa" title="使用EToCalculator 计算潜在蒸散发详细教程">使用EToCalculator 计算潜在蒸散发详细教程</a><a href="https://blog.sciencenet.cn/blog-3459054-1308734.html" title="https://blog.sciencenet.cn/blog-3459054-1308734.html">https://blog.sciencenet.cn/blog-3459054-1308734.html</a></li>
<li>Global Aridity Index and Potential Evapotranspiration (ET0) Climate Database v2 (Penman Monteith Evapotranspiration equation，30弧秒，1970-2000，暂时未使用，有待验证。) <a href="https://figshare.com/articles/dataset/Global_Aridity_Index_and_Potential_Evapotranspiration_ET0_Climate_Database_v2/7504448/3" title="https://figshare.com/articles/dataset/Global_Aridity_Index_and_Potential_Evapotranspiration_ET0_Climate_Database_v2/7504448/3">https://figshare.com/articles/dataset/Global_Aridity_Index_and_Potential_Evapotranspiration_ET0_Climate_Database_v2/7504448/3</a></li>
<li>大部分研究采用，Modified-Hargreaves 法对潜在蒸散量进行计算。<br />
式中：<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><msub><mi>T</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">ET_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>代表栅格单元上的潜在蒸散量（mm）；<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi><mi>A</mi></mrow><annotation encoding="application/x-tex">RA</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mord mathnormal">A</span></span></span></span>为太阳大气顶层辐射 （<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>M</mi><mi>J</mi><mo separator="true">⋅</mo><msup><mi>m</mi><mrow><mo>−</mo><mn>2</mn></mrow></msup><mo separator="true">⋅</mo><msup><mi>d</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup></mrow><annotation encoding="application/x-tex">MJ·m^{-2}·d^{-1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mord mathnormal" style="margin-right:0.09618em;">J</span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">2</span></span></span></span></span></span></span></span></span><span class="mpunct">⋅</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span></span></span></span>）；<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>T</mi><mi>a</mi></msub></mrow><annotation encoding="application/x-tex">T_a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">a</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>为不同小流域的日最高温均值和日最低温均值的平均值（°C）； <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>T</mi><mi>d</mi></msub></mrow><annotation encoding="application/x-tex">T_d</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">d</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>为小流域上的日最高温均值和日最低温均值的差值（°C）；<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi></mrow><annotation encoding="application/x-tex">P</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span></span>为小流域的降雨量 （mm）。</li>
</ul>
<p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>E</mi><msub><mi>T</mi><mn>0</mn></msub><mo>=</mo><mn>0.0013</mn><mo>×</mo><mn>0.408</mn><mo>×</mo><mi>R</mi><mi>A</mi><mo>×</mo><mrow><mo fence="true">(</mo><msub><mi>T</mi><mi mathvariant="normal">a</mi></msub><mo>+</mo><mn>17</mn><mo fence="true">)</mo></mrow><mo>×</mo><msup><mrow><mo fence="true">(</mo><msub><mi>T</mi><mi mathvariant="normal">d</mi></msub><mo>−</mo><mn>0.0123</mn><mi>P</mi><mo fence="true">)</mo></mrow><mn>0.76</mn></msup></mrow><annotation encoding="application/x-tex">ET_{0}=0.0013 \times 0.408 \times R A \times\left(T_{\mathrm{a}}+17\right) \times\left(T_{\mathrm{d}}-0.0123 P\right)^{0.76}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">0</span><span class="mord">0</span><span class="mord">1</span><span class="mord">3</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">4</span><span class="mord">0</span><span class="mord">8</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.76666em;vertical-align:-0.08333em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mord mathnormal">A</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathrm mtight">a</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">1</span><span class="mord">7</span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.204008em;vertical-align:-0.25em;"></span><span class="minner"><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathrm mtight">d</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">0</span><span class="mord">1</span><span class="mord">2</span><span class="mord">3</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.954008em;"><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span><span class="mord mtight">.</span><span class="mord mtight">7</span><span class="mord mtight">6</span></span></span></span></span></span></span></span></span></span></span></span></span></p>
<ul>
<li>GEE获取 (Penman-Monteith法)（代码传GEE和GitHub） 已经下载全国区域的2000-2020年数据压缩上传百度云     </li>
</ul>
<p> 原文链接 <a href="https://doi.org/10.1016/j.rse.2018.12.031" title="https://doi.org/10.1016/j.rse.2018.12.031">https://doi.org/10.1016/j.rse.2018.12.031</a></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//完美运行，输入坐标即可，获取每年的平均值。</span></span><br><span class="line"><span class="comment">//加入矢量边界之后直接运行var </span></span><br><span class="line"><span class="keyword">var</span> <span class="variable constant_">ROI</span> = table.<span class="title function_">geometry</span>();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//Map.addLayer(ROI,&#123;&#125;,&#x27;ROI&#x27;);</span></span><br><span class="line"><span class="keyword">var</span> imgcol_PMLV2_v016_8d = ee.<span class="title class_">ImageCollection</span>(<span class="string">&#x27;projects/pml_evapotranspiration/PML/OUTPUT/PML_V2_8day_v016&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> imgcol_PMLV2_v016_8d = ee.<span class="title class_">ImageCollection</span>(imgcol_PMLV2_v016_8d.<span class="title function_">toList</span>(<span class="number">2000</span>));</span><br><span class="line"><span class="title function_">print</span>(imgcol_PMLV2_v016_8d);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> pkg_export = <span class="built_in">require</span>(<span class="string">&#x27;users/kongdd/pkgs:pkg_export.js&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> options = &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&quot;drive&quot;</span>,</span><br><span class="line">    <span class="attr">range</span>: [<span class="number">110</span>,<span class="number">34</span>,<span class="number">114</span>,<span class="number">40</span>],<span class="comment">//ROI, // [73, 25, 105, 40], </span></span><br><span class="line">    <span class="attr">cellsize</span>: <span class="number">1</span>/<span class="number">240</span>,</span><br><span class="line">    <span class="comment">// crsTransform : [463.312716528, 0, -20015109.354, 0, -463.312716527, 10007554.677], // prj.crsTransform;</span></span><br><span class="line">    <span class="comment">// scale        : 463.3127165275, // prj.scale</span></span><br><span class="line">    <span class="attr">crs</span>: <span class="string">&#x27;EPSG:4326&#x27;</span>, <span class="comment">// &#x27;SR-ORG:6974&#x27;, // EPSG:4326</span></span><br><span class="line">    <span class="attr">folder</span>: <span class="string">&#x27;ET0&#x27;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> imgcol_years = <span class="title function_">aggregateToYearly</span>(imgcol_PMLV2_v016_8d, <span class="number">2010</span>, <span class="number">2019</span>, <span class="number">0.01</span>);</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">aggregateToYearly</span>(<span class="params">imgcol, year_begin, year_end, scale_factor</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> bands = [<span class="string">&#x27;ET_pot&#x27;</span>]; <span class="comment">//,&#x27;qc&#x27;</span></span><br><span class="line">    <span class="keyword">var</span> years = ee.<span class="property">List</span>.<span class="title function_">sequence</span>(year_begin, year_end);</span><br><span class="line">    <span class="keyword">var</span> imgcol_years = years.<span class="title function_">map</span>(<span class="keyword">function</span>(<span class="params">year</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> date_begin = ee.<span class="property">Date</span>.<span class="title function_">fromYMD</span>(year,<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">var</span> date_end   = ee.<span class="property">Date</span>.<span class="title function_">fromYMD</span>(year,<span class="number">12</span>,<span class="number">31</span>);</span><br><span class="line">        <span class="keyword">var</span> ydays = date_begin.<span class="title function_">advance</span>(<span class="number">1</span>, <span class="string">&#x27;year&#x27;</span>).<span class="title function_">difference</span>(date_begin, <span class="string">&#x27;day&#x27;</span>);</span><br><span class="line">        <span class="keyword">var</span> imgcol_year = imgcol.<span class="title function_">filterDate</span>(date_begin, date_end);</span><br><span class="line">        <span class="keyword">var</span> scale = ydays.<span class="title function_">multiply</span>(scale_factor);</span><br><span class="line">        <span class="keyword">return</span> imgcol_year.<span class="title function_">select</span>(bands)</span><br><span class="line">            <span class="comment">//.multiply(scale_factor).</span></span><br><span class="line">            .<span class="title function_">mean</span>()</span><br><span class="line">            .<span class="title function_">multiply</span>(scale)</span><br><span class="line">            .<span class="title function_">toFloat</span>()</span><br><span class="line">            .<span class="title function_">set</span>(<span class="string">&#x27;system:time_start&#x27;</span>, date_begin.<span class="title function_">millis</span>())</span><br><span class="line">            .<span class="title function_">set</span>(<span class="string">&#x27;system:id&#x27;</span>, date_begin.<span class="title function_">format</span>());</span><br><span class="line">    &#125;);</span><br><span class="line">    imgcol_years = ee.<span class="title class_">ImageCollection</span>(imgcol_years);</span><br><span class="line">    <span class="comment">// pkg_export.ExportImg(img_year, task, range, cellsize, type, folder_yearly, crs, crsTransform);</span></span><br><span class="line">    <span class="keyword">return</span> imgcol_years;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> imgcol_years = imgcol_years.<span class="title function_">filterBounds</span>(<span class="variable constant_">ROI</span>);</span><br><span class="line"><span class="title function_">print</span>(imgcol_years);</span><br><span class="line"><span class="comment">//var batch = require(&#x27;users/fitoprincipe/geetools:batch&#x27;);</span></span><br><span class="line"><span class="comment">//batch.Download.ImageCollection.toDrive(imgcol_years,&quot;ETO&quot;, &#123;</span></span><br><span class="line"><span class="comment">//scale: 1/240&#125;)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">pkg_export.<span class="title class_">ExportImgCol</span>(imgcol_years.<span class="title function_">limit</span>(<span class="number">10</span>), <span class="string">&#x27;ET0&#x27;</span>, options);</span><br></pre></td></tr></table></figure>
<p>GEE批量导出方法：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">    <span class="keyword">var</span> runButtons = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;#task-pane&#x27;</span>).<span class="property">shadowRoot</span>.<span class="title function_">querySelectorAll</span>(<span class="string">&quot;.run-button&quot;</span>)</span><br><span class="line">     runButtons.<span class="title function_">forEach</span>(<span class="keyword">function</span>(<span class="params">e</span>) &#123;e.<span class="title function_">click</span>()&#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">runTaskList</span>()</span><br><span class="line"><span class="built_in">setTimeout</span>( </span><br><span class="line">    <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">       <span class="keyword">var</span> taskDialog = <span class="variable language_">document</span>.<span class="title function_">querySelectorAll</span>(<span class="string">&quot;ee-image-config-dialog&quot;</span>) <span class="comment">//table的话-image-改成-table-</span></span><br><span class="line">        taskDialog.<span class="title function_">forEach</span>(<span class="keyword">function</span>(<span class="params">e</span>) &#123;e.<span class="property">shadowRoot</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;ee-dialog&quot;</span>).<span class="property">shadowRoot</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;paper-dialog&quot;</span>).<span class="title function_">querySelector</span>(<span class="string">&quot;.ok-button&quot;</span>).<span class="title function_">click</span>()&#125;)</span><br><span class="line"> &#125;,<span class="number">5</span> * <span class="number">1000</span> );  </span><br></pre></td></tr></table></figure>
<h2 id="土地利用覆被必需"><a class="markdownIt-Anchor" href="#土地利用覆被必需"></a> 土地利用/覆被（必需）：</h2>
<p>每个栅格对应一个土地利用类型的GIS栅格数据集。 土地利用类型代码定义为<strong>整数</strong>。 </p>
<p>*命名：*用户自定义，但若为ESRI GRID格式，文件名不能有空格并且少于13个字， 若为TIF或IMG格式，命名可能更长。 </p>
<p>*格式：*GIS标准栅格文件（如：ESRI GRID，TIF或IMG），每个栅格对应一个土地利用类型代码（如：1表示森林，3表示草地，等）。地类代码必须与生物物理系数表中的地类代码一致。</p>
<p><em>数据获取得：</em></p>
<ol>
<li>Land cover classification gridded maps from 1992 to present derived from satellite observations <a href="https://cds.climate.copernicus.eu/cdsapp#!/dataset/satellite-land-cover?tab=overview" title="https://cds.climate.copernicus.eu/cdsapp#!/dataset/satellite-land-cover?tab=overview">https://cds.climate.copernicus.eu/cdsapp#!/dataset/satellite-land-cover?tab=overview</a></li>
<li>ESA全球10米<a href="https://esa-worldcover.org/en" title="https://esa-worldcover.org/en">https://esa-worldcover.org/en</a></li>
<li>GLOBELAND30 包含2000，2010，2020三期数据。<a href="http://www.globallandcover.com/defaults.html?src=/Scripts/map/defaults/download.html&amp;head=download&amp;type=data" title="http://www.globallandcover.com/defaults.html?src=/Scripts/map/defaults/download.html&amp;head=download&amp;type=data">http://www.globallandcover.com/defaults.html?src=/Scripts/map/defaults/download.html&amp;head=download&amp;type=data</a><br />
<code>note:</code>汾河流域在图幅N49_35,山西省全域需要图幅N49_30,N49_35,N49_40,N50_35,N50_40</li>
<li>Sentinel-2 Land Use/ Land Cover Downloader 2017-2021年数据，10米分辨率。 <a href="https://www.arcgis.com/apps/instant/media/index.html?appid=fc92d38533d440078f17678ebc20e8e2" title="https://www.arcgis.com/apps/instant/media/index.html?appid=fc92d38533d440078f17678ebc20e8e2">https://www.arcgis.com/apps/instant/media/index.html?appid=fc92d38533d440078f17678ebc20e8e2</a> </li>
<li>1990-2021全国30米数据（每年更新） <a href="https://zenodo.org/record/5816591#.YzQUF-xBwbk" title="https://zenodo.org/record/5816591#.YzQUF-xBwbk">https://zenodo.org/record/5816591#.YzQUF-xBwbk</a></li>
</ol>
<h2 id="流域必需"><a class="markdownIt-Anchor" href="#流域必需"></a> 流域（必需）：</h2>
<p>用多边形表示流域的图形文件（shapefile）。即与研究区水电生产研究相关的所有小流域图层。 </p>
<p><em>命名：</em> 用户定义，但文件名不能有空格 </p>
<p>*格式： *图形文件（.shp） </p>
<p>*属性表横列：*每一行表示一个小流域</p>
<p>*属性表纵列：*必须包含定义为整数的“ws_id”字段，每个小流域赋予唯一数值。</p>
<h2 id="次一级小流域必需"><a class="markdownIt-Anchor" href="#次一级小流域必需"></a> 次一级小流域（必需）：</h2>
<p>流域图层中选定区域中用多图形文件（shapefile）。生成次一级小流域的工具和方法，详见 “DEM数据处理”章节。</p>
<p>*格式：*图形文件（.shp） </p>
<p>*属性表横列：*每一行表示一个次一级小流域</p>
<p>*属性表纵列：*必须包含定义为整数的“subws_id”字段，每个次一级小流域赋予唯一数值。</p>
<h2 id="生物物理系数表必需"><a class="markdownIt-Anchor" href="#生物物理系数表必需"></a> 生物物理系数表（必需）：</h2>
<p>土地利用/覆被（LULC）类型表，包括用于该工具使用的生物物理系数数据。注意事项：这些数据主要针对每种土地利用类型属性而非栅格图栅格单元属性。</p>
<p>*命名：*文件名由字母、数字和下划线组成，不能有空格。</p>
<p>*格式：*ArcGIS模型的*.dbf或*.mdb格式，独立运行模块要求一个*.csv文件。</p>
<p>*属性表横列：*每一行表示一个土地利用类型 。</p>
<p>*属性表纵列：*每一列包含每种土地利用类型的不同属性，属性命名如下：</p>
<p>Lucode（土地利用类型代码）：每种土地利用类型地类代码（如：1表示森林， 3表示草地，等），必须与上述土地利用类型栅格图保持一致。</p>
<p>LULC_desc：土地利用类型的描述性命名（可选填）。</p>
<p> LULC_veg：包括使用的实际蒸散发AET计算公式。植被覆盖地类 （不包括湿地）赋值为1，其他土地利用类型（包括湿地、城市用地、水体）赋值为0。</p>
<p>root_depth：植被覆盖地类的最大根系深度，单位毫米（mm），取整数。植物根系深度通常指特定植物类型的根系生物量为95%的土层深度。对不适用一般 Budyko干燥指数（即应使用公式2计算实际蒸散发AET）的土地利用类型而言， 不需要根系深度数据，设为N/A。</p>
<p>Kc ：每种土地利用类型的植物蒸散系数，通过将植物生理学特性与苜蓿相比较，将苜蓿的参考作物蒸散修正为特定土地利用类型的潜在蒸散量。因此土地利用类型的植物蒸散系数取值为[0，1.5]的小数（在某些非常潮湿的热带区域，水分充足）。</p>
<h2 id="季节常数z必需"><a class="markdownIt-Anchor" href="#季节常数z必需"></a> 季节常数Z（必需）：</h2>
<p>是根据季节性降水分布定义的从1 到30排序浮动值。 </p>
<h2 id="用水需求表必需"><a class="markdownIt-Anchor" href="#用水需求表必需"></a> 用水需求表（必需）：</h2>
<p>土地利用类型表，表示不同土地利用类型的消耗性用水量。消耗性用水量是指提供植物和作物生长，被人类和畜牧消耗，或其他应从 流域水量平衡中扣除的水量。</p>
<p>*命名：*文件名由字母、数字和下划线组成，不能有空格。 </p>
<p>*格式：*ArcGIS模型的*.dbf或*.mdb格式，独立运行模块要求一个*.csv文件 属性表横列：每一行表示一个土地利用类型，并且必须包含土地利用栅格图中所 有土地覆被属性值。 </p>
<p>*属性表纵列：*每一列包含每种土地利用类型的不同用水需求属性，属性命名如下：</p>
<p>lucode（土地利用类型代码）：每种土地利用类型地类代码（如：1表示森林， 3表示草地，等），必须与上述土地利用类型栅格图保持一致。 </p>
<p>demand：每种土地利用类型的预测平均消耗性用水量。土地利用类型图中的用水量用立方米/年/栅格单元表示。注意事项：由于区域越大，相同土地覆被类型消耗的水量可能，因此用水量的栅格计算方法十分重要。</p>
<h1 id="结果分析"><a class="markdownIt-Anchor" href="#结果分析"></a> 结果分析</h1>
<p>output\per_pixel\fractp（分数）：模型估算每个栅格单元降水量的实际蒸散发占比（实际蒸发量/降水量）。这是栅格单元的实际蒸散发占降水量的平均值。</p>
<p>output\per_pixel\aet（mm）：模型估算栅格单元实际蒸散发。</p>
<p>output\per_pixel\wyield（mm）：模型估算栅格单元产水量。</p>
<ul>
<li>output\subwatershed_results_wyield.shp 和 output\subwatershed_results_wyield.csv：包含模型估算次一级流域生物物理学参数值的shapefile文件和表格，属性包括：
<ul>
<li>precip_mn（mm）：次一级流域栅格单元的平均降水量。</li>
<li>PET_mn（mm）：次一级流域栅格单元的平均潜在蒸散发。</li>
<li>AET_mn（mm）：次一级流域栅格单元的平均实际蒸散发。</li>
<li>wyield_mn（mm）：次一级流域栅格单元的平均产水量。</li>
<li>num_pixel：次一级流域栅格单元的数量。</li>
<li>wyield_vol（$ m^3  $）：次一级流域产水量体积。</li>
<li>wyield_ha（$ m^3  $）：次一级流域每公顷产水量体积。</li>
</ul>
</li>
<li>output\watershed_results_wyield.shp 和 output\watershed_results_wyield.csv ： 包含模型估算每个小流域生物物理学参数值的shapefile文件和表格： 运行产水量评估模块时，输出结果的生物物理学参数如下：
<ul>
<li>precip_mn（mm）：每个小流域栅格单元的平均降水量。</li>
<li>PET_mn（mm）：每个小流域栅格单元的平均潜在蒸散发。</li>
<li>AET_mn（mm）：每个小流域栅格单元的平均实际蒸散发。</li>
<li>wyield_mn（mm）：每个小流域栅格单元的平均产水量。</li>
<li>num_pixel：每个小流域栅格单元的数量。</li>
<li>wyield_vol（$ m^3  $）：每个小流域内产水量体积。</li>
<li>wyield_ha（$ m^3  $）：每个小流域每公顷产水量体积。 </li>
</ul>
</li>
</ul>
<p><strong><code>Note:</code></strong> **产水量（wyield_vol）**字段数据是模型估算研究区流域的每一个次一级流域的年平均<em>产汇流</em>水量。字段数值可以用于确定对全年产水量贡献最大的次一级流域。</p>
<p><a href="https://www.wolai.com/pLvSQy6dLBrwJX9ATDTiy4" title="日值（v3）数据">日值（v3）数据</a></p>
<p><a href="https://www.wolai.com/sWbxWLVBydbK2t5aT584Fa" title="使用EToCalculator 计算潜在蒸散发详细教程">使用EToCalculator 计算潜在蒸散发详细教程</a></p>
<p><a href="https://www.wolai.com/mQ6iivaJ3BAPg21kq2uXsE" title="编程分享-利用GEE得到研究区年、月、日降水量数据">编程分享-利用GEE得到研究区年、月、日降水量数据</a></p>
]]></content>
      <categories>
        <category>Ecosystem service</category>
        <category>Annual Water Yield</category>
      </categories>
      <tags>
        <tag>Ecosystem service</tag>
        <tag>Annual Water Yield</tag>
      </tags>
  </entry>
  <entry>
    <title>属性数据操作</title>
    <url>/2023/08/22/03-attribute-operations/</url>
    <content><![CDATA[<p>本章讲授如何基于属性来操作地理对象，例如矢量数据集中的公交站名和栅格数据集中像素的高程。对于矢量数据，意味着应用例如<code>subsetting</code>和<code>aggregation</code>方法（参见矢量属性提取子集和矢量属性聚合章节）。和创建属性移除空间信息章节演示了如何通过共享<strong>ID</strong>将数据连接到简单要素对象以及如何创建新变量。这些操作都有空间等效功能：例如，基于属性和空间对象的<code>subsetting</code>操作都可以使用R中的<code>[</code>运算符；您还可以使用<code>spatial joins</code>将两个地理数据集的属性进行连接。本章所培养的技能具有交叉传递性。<em>空间数据操作</em>章节将本章介绍的方法扩展到空间方面。</p>
<span id="more"></span>
<h1 id="前提条件"><a class="markdownIt-Anchor" href="#前提条件"></a> 前提条件</h1>
<ul>
<li>本章要求安装并且连接以下包：</li>
</ul>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line">library<span class="punctuation">(</span>sf<span class="punctuation">)</span> </span><br><span class="line">library<span class="punctuation">(</span>terra<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>dplyr<span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<ul>
<li>依赖于 <strong>spData</strong> 包，该包装载了本章代码示例所使用的数据集：</li>
</ul>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line">library<span class="punctuation">(</span>spData<span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<ul>
<li>另外，如果您希望在栅格数据汇总章节中运行数据&quot;整理&quot;操作，请确保已安装了<strong>tidyr</strong>包，或者安装了其所属的<strong>tidyverse</strong>包。</li>
</ul>
<h1 id="引言"><a class="markdownIt-Anchor" href="#引言"></a> 引言</h1>
<p>属性数据是与地理（几何）数据相关联的非空间信息。公共汽车站提供了一个简单的例子：除了名称之外，它的位置通常用经纬度坐标(几何数据)来表示。例如，位于伦敦<a href="https://www.openstreetmap.org/relation/6610626" title="Elephant &amp; Castle / New Kent Road">Elephant &amp; Castle / New Kent Road</a> 站的坐标为：经度 -0.098和纬度 51.495，在<em>空间数据类型</em>章节描述的 <code>sfc</code>表示中可以表示为<code>POINT (-0.098 51.495)</code>。诸如点属性的<code>name</code>属性（使用 Simple Features 术语）之类的属性是本章的主题。</p>
<p>另一个示例是栅格数据中特定网格单元的海拔值（属性）。与矢量数据模型不同，栅格数据模型间接存储了网格单元的坐标，这意味着属性和空间信息之间的区分不太清晰。为了阐明这一观点，可以想象一下栅格矩阵中第3行第4列的像素点。其空间位置由其在矩阵中的索引确定：在<code>x</code>方向上从原点向右（通常是东方和地图上的右方）移动四个单元格，在<code>y</code>方向上从原点向下（通常是南方和向下）移动三个单元格。栅格的分辨率定义了每个<code>x</code>和<code>y</code>步的距离，这些距离在头部文件中指定。头部文件是栅格数据集的关键组成部分，它指定了像素与地理坐标的关系（另见空间数据操作章节）。</p>
<p>本章讲授如何基于属性来操作地理对象，例如矢量数据集中的公交站名和栅格数据集中像素的高程。对于矢量数据，意味着应用例如<code>subsetting</code>和<code>aggregation</code>方法（参见矢量属性提取子集和矢量属性聚合章节。）和创建属性移除空间信息章节演示了如何通过共享<strong>ID</strong>将数据连接到简单要素对象以及如何创建新变量。这些操作都有空间等效功能：例如，基于属性和空间对象的<code>subsetting</code>操作都可以使用R中的<code>[</code>运算符；您还可以使用<code>spatial joins</code>将两个地理数据集的属性进行连接。本章所培养的技能具有交叉传递性。<em>空间数据操作</em>章节将本章介绍的方法扩展到空间方面。</p>
<p>在下一节深入探讨各种类型的<strong>矢量属性</strong>操作后，栅格数据操作章节介绍了<strong>栅格属性</strong>数据操作，演示了如何创建包含连续和分类属性的栅格图层，并从一个或多个图层中提取单元格的值（栅格子集）。栅格数据汇总章节提供了<strong>全局</strong>栅格操作的概述，这些操作可以用于总结整个栅格数据集。</p>
<h1 id="矢量数据操作"><a class="markdownIt-Anchor" href="#矢量数据操作"></a> 矢量数据操作</h1>
<p>地理矢量数据集在R中得到了很好的支持，这得益于<code>sf</code>类的出现，它是基于R的<code>data.frame</code>进行扩展的。与数据框类似，<code>sf</code>对象每列都有一个属性变量（例如&quot;name&quot;），每行代表一个观测值或<code>feature</code>（例如每个公交车站）。与基本数据框不同的是，<code>sf</code>对象具有一个<strong>几何列</strong>，其类型为<code>sfc</code>，每个行可以包含多个地理实体（单个和&quot;多&quot;点，线，多边形要素）。第<br />
<em>空间类</em>中进行了描述，演示了<code>plot()</code>和<code>Summary()</code>等<strong>通用</strong>方法是如何处理<code>sf</code>对象的。<code>sf</code>还提供了<strong>通用方法</strong>，允许<code>sf</code>对象像常规数据框一样运行，如<em>打印</em><strong>类</strong>的方法所示：</p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line">methods<span class="punctuation">(</span><span class="built_in">class</span> <span class="operator">=</span> <span class="string">&quot;sf&quot;</span><span class="punctuation">)</span> </span><br></pre></td></tr></table></figure>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line"><span class="comment">#&gt; [1] [             [[&lt;-          $&lt;-           aggregate    </span></span><br><span class="line"><span class="comment">#&gt; [5] as.data.frame cbind         coerce        filter       </span></span><br><span class="line"><span class="comment">#&gt; [9] identify      initialize    merge         plot        </span></span><br></pre></td></tr></table></figure>
<p>其中许多函数（<code>aggregate()</code>，<code>cbind()</code>，<code>merge()</code>，<code>rbind()</code>和<code>[</code>）用于操作数据框。例如，<code>rbind()</code>会将数据框的行&quot;一上一下&quot;连接在一起。<code>$&lt;-</code>可以创建新的列。<code>sf</code> 对象的一个重要特征是它们以相同的方式将<strong>空间数据</strong>和<strong>非空间数据</strong>存储为<code>data.frame</code>中的列。</p>
<blockquote>
<p>📌对象的几何列通常称为<code>geometry</code>或<code>geom</code>，但可以使用任何名称。例如，下面的命令创建了一个名为<code>g</code>的几何列:<br />
<code>st_sf(data.frame(n = world$name_long), g = world$geom)</code><br />
这使得从空间数据库导入的几何图形具有多种名称，如<code>wkb_geometry</code>和<code>The_geom</code>。</p>
</blockquote>
<p><code>sf</code>对象对于数据框可以扩展<code>tidyverse</code>类，<code>tbl_df</code>和<code>tbl</code>。因此，无论您使用基础R还是tidyverse函数进行数据分析，<code>sf</code>都可以释放R数据分析能力对地理数据的全部威力。<br />
<code>sf</code>对象还可以与高性能数据处理软件包<code>data.table</code>一起使用，尽管文献中有记载说明，它与<code>sf</code>对象不完全兼容，<a href="https://github.com/Rdatatable/data.table/issues/2273" title="Rdatatable/data.table#2273">Rdatatable/data.table#2273</a>。在使用这些功能之前，回顾怎样探索矢量数据对象的基本属性。让我们开始使用基本R函数来了解从 <strong>spData</strong> 软件包中的<code>world</code>数据集：</p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line"><span class="built_in">class</span><span class="punctuation">(</span>world<span class="punctuation">)</span></span><br><span class="line"><span class="comment">#&gt; [1] &quot;sf&quot;         &quot;tbl_df&quot;     &quot;tbl&quot;        &quot;data.frame&quot;</span></span><br><span class="line"><span class="built_in">dim</span><span class="punctuation">(</span>world<span class="punctuation">)</span></span><br><span class="line"><span class="comment">#&gt; [1] 177  11</span></span><br></pre></td></tr></table></figure>
<p><code>world</code>含有十个非地理列（以及一个几何列表列），共有近200行代表各个世界国家。函数<code>st_drop_geometry()</code>可保留仅为<code>sf</code>对象的属性数据，也就是删除其几何学属性：</p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line">world_df <span class="operator">=</span> st_drop_geometry<span class="punctuation">(</span>world<span class="punctuation">)</span></span><br><span class="line"><span class="built_in">class</span><span class="punctuation">(</span>world_df<span class="punctuation">)</span></span><br><span class="line"><span class="comment">#&gt; [1] &quot;tbl_df&quot;     &quot;tbl&quot;        &quot;data.frame&quot;</span></span><br><span class="line">ncol<span class="punctuation">(</span>world_df<span class="punctuation">)</span></span><br><span class="line"><span class="comment">#&gt; [1] 10</span></span><br></pre></td></tr></table></figure>
<p>在使用属性数据之前，删除几何列可能会很有用；当数据处理过程仅涉及属性数据时，处理速度可以更快，并且不一定总需要几何列。然而，在大多数情况下，保留几何列是有意义的，解释为什么几何列具有&quot;粘性&quot;（大多数属性操作之后仍然存在，除非特别删除。）。在<code>sf</code>对象上进行非空间数据操作仅在适当时更改对象的几何结构（例如，在聚合后消除相邻多边形之间的边界）。掌握地理属性数据操作技能意味着掌握操作数据框的技能。</p>
<p>对于许多应用程序来说，tidyverse中的<strong>dplyr</strong> 包为处理数据框提供了有效的方法。与其前身<strong>sp</strong>相比，<strong>sf</strong>具有<strong>tidyverse</strong>兼容性的优势，但需要避免一些陷阱（详情请参见 <a href="https://geocompx.github.io/geocompkg/articles/tidyverse-pitfalls.html" title="geocompx.org">geocompx.org</a> 上的补充<code>tidyverse-pitfalls</code>文献）。</p>
<h2 id="矢量属性提取子集"><a class="markdownIt-Anchor" href="#矢量属性提取子集"></a> 矢量属性提取子集</h2>
<p>基础R的子集提取方法包括<code>[</code>和<code>subset()</code>。在<strong>dplyr</strong>中，子集提取数据的关键函数是<code>filter()</code>和<code>slice()</code>用于子集提取行，而<code>select()</code>用于子集提取列。两种方法都可以保持 <code>sf</code>对象中属性数据的空间组件不变。然而，使用运算符<code>$</code>或<strong>dplyr</strong>函数<code>pull()</code>提取单个属性列作为向量会导致几何数据的丢失，我们将在后文中进一步阐述。本节重点关注如何对<code>sf</code>数据框进行子集提取，如果进一步了解如何对向量和非地理数据框进行子集提取，建议参考《An Introduction to R》第<a href="https://cran.r-project.org/doc/manuals/r-release/R-intro.html#Index-vectors" title="2.7">2.7</a> 节以及《Advanced R Programming》第<a href="https://adv-r.hadley.nz/subsetting.html" title="4">4</a>章。</p>
<p><code>[</code>操作符可以对行和列提取子集。方括号直接放在数据框对象名称之后，里面的索引指定要保留的元素。命令<code>object[i, j]</code>意味着：返回由<code>i</code>表示的行和由<code>j</code>表示的列，其中<code>i</code>和<code>j</code>通常包含整数或<code>TRUE</code>和<code>FALSE</code>（索引也可以是字符串，表示行或列名称）。例如，<code>object[5, 1:3]</code>意味着：返回包含第5行和第1到第3列的数据，结果应该是一个只有1行和3列的数据框，如果是<code>sf</code>对象，则还要包含第4个几何列。留下<code>i</code>或<code>j</code>为空会返回所有的行或列，因此<code>world[1:5, ]</code>返回前5行和所有11列。下面的示例演示了使用基本<strong>R</strong>进行子集提取的方法。猜 测每个命令返回的<code>sf</code>数据框的行数和列数，并在自己的计算机上检查结果（更多练习请参见本章末尾）：</p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line">world<span class="punctuation">[</span><span class="number">1</span><span class="operator">:</span><span class="number">6</span><span class="punctuation">,</span> <span class="punctuation">]</span>    <span class="comment"># 按位置提取行</span></span><br><span class="line">world<span class="punctuation">[</span><span class="punctuation">,</span> <span class="number">1</span><span class="operator">:</span><span class="number">3</span><span class="punctuation">]</span>    <span class="comment"># 按位置提取列</span></span><br><span class="line">world<span class="punctuation">[</span><span class="number">1</span><span class="operator">:</span><span class="number">6</span><span class="punctuation">,</span> <span class="number">1</span><span class="operator">:</span><span class="number">3</span><span class="punctuation">]</span> <span class="comment"># 按位置提取行和列</span></span><br><span class="line">world<span class="punctuation">[</span><span class="punctuation">,</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;name_long&quot;</span><span class="punctuation">,</span> <span class="string">&quot;pop&quot;</span><span class="punctuation">)</span><span class="punctuation">]</span> <span class="comment"># 按名称提取列</span></span><br><span class="line">world<span class="punctuation">[</span><span class="punctuation">,</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="built_in">T</span><span class="punctuation">,</span> <span class="built_in">T</span><span class="punctuation">,</span> <span class="built_in">F</span><span class="punctuation">,</span> <span class="built_in">F</span><span class="punctuation">,</span> <span class="built_in">F</span><span class="punctuation">,</span> <span class="built_in">F</span><span class="punctuation">,</span> <span class="built_in">F</span><span class="punctuation">,</span> <span class="built_in">T</span><span class="punctuation">,</span> <span class="built_in">T</span><span class="punctuation">,</span> <span class="built_in">F</span><span class="punctuation">,</span> <span class="built_in">F</span><span class="punctuation">)</span><span class="punctuation">]</span> <span class="comment"># 按逻辑索引提取</span></span><br><span class="line">world<span class="punctuation">[</span><span class="punctuation">,</span> <span class="number">888</span><span class="punctuation">]</span> <span class="comment"># 索引代表不存在的列</span></span><br></pre></td></tr></table></figure>
<p>下面的代码块演示了使用<code>logical</code>向量进行子集提取的实用性。这就创造了一个新的对象，<code>small_countries</code>，包括面积小于 10,000 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><msup><mi>m</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">km^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span>的国家:</p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line">i_small <span class="operator">=</span> world<span class="operator">$</span>area_km2 <span class="operator">&lt;</span> <span class="number">10000</span></span><br><span class="line">summary<span class="punctuation">(</span>i_small<span class="punctuation">)</span> <span class="comment"># 逻辑向量</span></span><br><span class="line"><span class="comment">#&gt;    Mode   FALSE    TRUE </span></span><br><span class="line"><span class="comment">#&gt; logical     170       7</span></span><br><span class="line">small_countries <span class="operator">=</span> world<span class="punctuation">[</span>i_small<span class="punctuation">,</span> <span class="punctuation">]</span></span><br></pre></td></tr></table></figure>
<p>中间的<code>i_small</code>（表示小国家的索引的缩写）是一个逻辑向量，可用于按表面积对<strong>世界</strong>上最小的七个国家提取子集。更简洁的命令省略中间对象，生成相同的结果：</p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line">small_countries <span class="operator">=</span> world<span class="punctuation">[</span>world<span class="operator">$</span>area_km2 <span class="operator">&lt;</span> <span class="number">10000</span><span class="punctuation">,</span> <span class="punctuation">]</span></span><br></pre></td></tr></table></figure>
<p>基础R函数<code>subset()</code>提供了另外一种方式：</p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line">small_countries <span class="operator">=</span> subset<span class="punctuation">(</span>world<span class="punctuation">,</span> area_km2 <span class="operator">&lt;</span> <span class="number">10000</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<p>基础的R函数成熟、稳定且广泛使用，使它们成为一种非常可靠的选择，特别是在强调<strong>重现性</strong>和<strong>可靠性</strong>的情况下。<strong>dplyr</strong> 函数使得&quot;tidy&quot;的工作流成为可能，其中一些人（包括本书的作者）在交互式数据分析中发现这些函数直观且富有成效，特别与RStudio等代码编辑器相结合，可以实现列名的<a href="https://support.posit.co/hc/en-us/articles/205273297-Code-Completion-in-the-RStudio-IDE" title="auto-completion">auto-completion</a>。下面演示了使用<strong>dplyr</strong>函数进行子集提取中的关键函数，包括<code>sf</code>数据框架。</p>
<p>&lt;!-- 根据以下基准，下面的句子似乎是不真实的。 --&gt; &lt;!-- `dplyr`在某些操作中也比基础 R 快，因为它的 C++ 索引{C++}后端。 --&gt; &lt;!-- 关于dbplyr的一些问题？我从来没有见过有人在实际中经常使用它来处理空间数据，所以暂时先不涉及与数据库的集成部分。（RL 2021-10） --&gt; &lt;!-- 主要的 **dplyr** 子集提取功能包括 `select()`, `slice()`, `filter()` and `pull()`。 --&gt;</p>
<p><code>select()</code>按照名称和位置选择列。例如，你可以利用下面的命令只选择<code>name_long</code>和<code>pop</code>两列：</p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line">world1 <span class="operator">=</span> select<span class="punctuation">(</span>world<span class="punctuation">,</span> name_long<span class="punctuation">,</span> pop<span class="punctuation">)</span></span><br><span class="line"><span class="built_in">names</span><span class="punctuation">(</span>world1<span class="punctuation">)</span></span><br><span class="line"><span class="comment">#&gt; [1] &quot;name_long&quot; &quot;pop&quot;       &quot;geom&quot;</span></span><br></pre></td></tr></table></figure>
<p>注意：与基础R中的等效命令一样，（<code>world[, c(&quot;name_long&quot;, &quot;pop&quot;)]</code>）, “粘性” <code>geom</code>列保留。<code>select()</code>还允许在<code>:</code>操作符的帮助下选择一系列列变量：</p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line"><span class="comment"># name_long 和 pop (包括)之间的所有列</span></span><br><span class="line">world2 <span class="operator">=</span> select<span class="punctuation">(</span>world<span class="punctuation">,</span> name_long<span class="operator">:</span>pop<span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<p>用<code>-</code>操作符去除特定的列：</p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 除了 subregion 和 area_km2 (包括)之外的所有列</span></span><br><span class="line">world3 <span class="operator">=</span> select<span class="punctuation">(</span>world<span class="punctuation">,</span> <span class="operator">-</span>subregion<span class="punctuation">,</span> <span class="operator">-</span>area_km2<span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<p><code>new_name = old_name</code>语法可以同时提取子集和重命名列变量:</p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line">world4 <span class="operator">=</span> select<span class="punctuation">(</span>world<span class="punctuation">,</span> name_long<span class="punctuation">,</span> population <span class="operator">=</span> pop<span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<p>值得注意的是：上面的命令比基础R等价的命令更简洁，基础R等价的命令需要两行代码：</p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line">world5 <span class="operator">=</span> world<span class="punctuation">[</span><span class="punctuation">,</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;name_long&quot;</span><span class="punctuation">,</span> <span class="string">&quot;pop&quot;</span><span class="punctuation">)</span><span class="punctuation">]</span>                <span class="comment"># 通过名称提取子列</span></span><br><span class="line"><span class="built_in">names</span><span class="punctuation">(</span>world5<span class="punctuation">)</span><span class="punctuation">[</span><span class="built_in">names</span><span class="punctuation">(</span>world5<span class="punctuation">)</span> <span class="operator">==</span> <span class="string">&quot;pop&quot;</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="string">&quot;population&quot;</span>   <span class="comment"># 手动重命名</span></span><br></pre></td></tr></table></figure>
<p><code>select()</code>还可以使用’helper functions’ 进行更高级的自己提取操作，包括<code>contains()</code>，<code>starts_with()</code>和<code>num_range()</code>（用<code>?select</code>产看帮助页面获取更多细节）。</p>
<p>大部分 <strong>dplyr</strong> 函数返回数据框，但是你可以用<code>pull()</code>单独提取一列作为向量。&lt;!–注意：我注释掉下面的语句，因为它对`sf`对象不适用，而且数据框和`sf`对象的行为不同，有些令人困惑。–&gt; &lt;!-- 相比之下，基础 R（参见`? [`）中的子集运算符试图返回尽可能小维度的对象。 --&gt; &lt;!-- 这意味着选择一列返回一个以 R 为基础的向量，如下面的代码块所示，它返回一个表示`world`中国家人口的数字向量: --&gt;使用列表提取子集操作符<code>$</code>和<code>[[</code> ，可以在基础 R 中得到相同的结果，以下三个命令返回相同的数值向量:</p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 结果返回为向量</span></span><br><span class="line">pull<span class="punctuation">(</span>world<span class="punctuation">,</span> pop<span class="punctuation">)</span></span><br><span class="line">world<span class="operator">$</span>pop</span><br><span class="line">world<span class="punctuation">[[</span><span class="string">&quot;pop&quot;</span><span class="punctuation">]</span><span class="punctuation">]</span></span><br></pre></td></tr></table></figure>
<p>&lt;!-- 以下内容已注释，因其容易引起困惑且在其他地方有更好的涵盖（RL，2021-10）。 --&gt;</p>
<p>&lt;!-- 要关闭此行为，请将`drop`参数设置为`FALSE`。 --&gt;</p>
<p><code>slice()</code>是行选择工具等同于 <code>select()</code>。例如，下面的代码块选择了1到6行：</p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line">slice<span class="punctuation">(</span>world<span class="punctuation">,</span> <span class="number">1</span><span class="operator">:</span><span class="number">6</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<p><code>filter()</code>是<strong>dplyr</strong>等价于基础 R 的<code>subset()</code>函数。它只保留符合给定标准的行，例如，只保留面积低于某一阈值或平均预期寿命高的国家，如下例所示：</p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line">world7 <span class="operator">=</span> filter<span class="punctuation">(</span>world<span class="punctuation">,</span> area_km2 <span class="operator">&lt;</span> <span class="number">10000</span><span class="punctuation">)</span>  <span class="comment"># 面积小的国家</span></span><br><span class="line">world7 <span class="operator">=</span> filter<span class="punctuation">(</span>world<span class="punctuation">,</span> lifeExp <span class="operator">&gt;</span> <span class="number">82</span><span class="punctuation">)</span>      <span class="comment"># 预期寿命高的国家</span></span><br></pre></td></tr></table></figure>
<p>比较运算符的标准集合可以在<code>filter()</code>函数中使用，如表所示：</p>
<p>Table: Comparison operators that return Booleans (TRUE/FALSE).</p>
<table>
<thead>
<tr>
<th>Symbol</th>
<th>Name</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>==</code></td>
<td>Equal to</td>
</tr>
<tr>
<td><code>!=</code></td>
<td>Not equal to</td>
</tr>
<tr>
<td><code>&gt;</code>, <code>&lt;</code></td>
<td>Greater/Less than</td>
</tr>
<tr>
<td><code>&gt;=</code>, <code>&lt;=</code></td>
<td>Greater/Less than or equal</td>
</tr>
<tr>
<td><code>&amp;</code>,`</td>
<td><code>,</code>!`</td>
</tr>
</tbody>
</table>
<h2 id="管道连接命令"><a class="markdownIt-Anchor" href="#管道连接命令"></a> 管道连接命令</h2>
<p>使用<strong>dplyr</strong>函数的工作流的关键是<a href="http://r4ds.had.co.nz/pipes.html" title="'pipe'">’pipe’</a>操作符<code>%&gt;%</code>（或者自R <code>4.1.0</code>以来的内置管道<code>|&gt;</code>），名称取自Unix管道 <code>|</code>。管道启用表达式代码：前一个函数的输出成为下一个函数的第一个参数，从而启用<em>连接</em>。如下所示，其中只有来自亚洲的国家从<code>world</code>数据集中筛选，接下来对象是按列（<code>name_long</code>和<code>continent</code>）和前5行（结果未显示）分列的子集。</p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line">world7 <span class="operator">=</span> world <span class="operator">|&gt;</span></span><br><span class="line">  filter<span class="punctuation">(</span>continent <span class="operator">==</span> <span class="string">&quot;Asia&quot;</span><span class="punctuation">)</span> <span class="operator">|&gt;</span></span><br><span class="line">  select<span class="punctuation">(</span>name_long<span class="punctuation">,</span> continent<span class="punctuation">)</span> <span class="operator">|&gt;</span></span><br><span class="line">  slice<span class="punctuation">(</span><span class="number">1</span><span class="operator">:</span><span class="number">5</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<p>上面的代码块显示了管道操作符如何允许以明确的顺序编写命令：从上到下（逐行）和从左到右运行。管道操作的另一种替代方法是嵌套函数调用，这种方法更难理解：</p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line">world8 <span class="operator">=</span> slice<span class="punctuation">(</span></span><br><span class="line">  select<span class="punctuation">(</span></span><br><span class="line">    filter<span class="punctuation">(</span>world<span class="punctuation">,</span> continent <span class="operator">==</span> <span class="string">&quot;Asia&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    name_long<span class="punctuation">,</span> continent<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">  <span class="number">1</span><span class="operator">:</span><span class="number">5</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<p>另一种选择是将操作分为多个自包含行，特别是在开发新的 R 程序包时推荐使用此方法，这种方法的优点是可以通过具有不同名称的中间结果进行保存以便后续调试（但缺点是冗长，如果进行交互式分析时还会使全局环境凌乱）：</p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line">world9_filtered <span class="operator">=</span> filter<span class="punctuation">(</span>world<span class="punctuation">,</span> continent <span class="operator">==</span> <span class="string">&quot;Asia&quot;</span><span class="punctuation">)</span></span><br><span class="line">world9_selected <span class="operator">=</span> select<span class="punctuation">(</span>world9_filtered<span class="punctuation">,</span> continent<span class="punctuation">)</span></span><br><span class="line">world9 <span class="operator">=</span> slice<span class="punctuation">(</span>world9_selected<span class="punctuation">,</span> <span class="number">1</span><span class="operator">:</span><span class="number">5</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<p>每种方法都有优缺点，其重要性取决于您的编程风格和应用程序。对于交互式数据分析（本章的重点），我们发现管道操作快速而直观，特别是与<a href="https://support.posit.co/hc/en-us/articles/200711853-Keyboard-Shortcuts-in-the-RStudio-IDE" title="RStudio">RStudio</a>/<a href="https://github.com/REditorSupport/vscode-R/wiki/Keyboard-shortcuts" title="VSCode">VSCode</a>快捷方式相结合时，可以创建管道并<a href="https://support.posit.co/hc/en-us/articles/205273297-Code-Completion-in-the-RStudio-IDE" title="自动完成">自动完成</a>变量名。</p>
<h2 id="矢量属性聚合"><a class="markdownIt-Anchor" href="#矢量属性聚合"></a> 矢量属性聚合</h2>
<p>聚合涉及使用一个或多个&quot;分组变量&quot;对数据进行汇总，通常是从要进行聚合的数据框的列中选择的（地理聚合在下一章中介绍）。属性聚合的一个例子是根据以国家为单位的数据（每个国家一行）计算每个大洲的人口数量。<code>world</code>数据集包含了必要的要素：<code>pop</code>和<code>continent</code>列分别代表人口和分组变量。目的是找到每个大洲的国家人口总和（<code>sum()</code>），从而得到一个较小的数据框（聚合是一种数据缩减的形式，对于处理大型数据集时，聚合是有用的前期步骤）。可以使用基本R函数<code>aggregate()</code>来完成此操作，步骤如下所示：</p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line">world_agg1 <span class="operator">=</span> aggregate<span class="punctuation">(</span>pop <span class="operator">~</span> continent<span class="punctuation">,</span> FUN <span class="operator">=</span> <span class="built_in">sum</span><span class="punctuation">,</span> data <span class="operator">=</span> world<span class="punctuation">,</span></span><br><span class="line">                       na.rm <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span></span><br><span class="line"><span class="built_in">class</span><span class="punctuation">(</span>world_agg1<span class="punctuation">)</span></span><br><span class="line"><span class="comment">#&gt; [1] &quot;data.frame&quot;</span></span><br></pre></td></tr></table></figure>
<p>结果是一个6行的非空间数据框，每一行代表一个大洲，两列分别报告了每个大洲的名称和人口（参见表)，显示前三个人口最多的大洲的结果）。</p>
<p><code>aggregate()</code>是一个<a href="https://adv-r.hadley.nz/s3.html" title="泛函数">泛函数</a>，这意味着它的行为取决于它的输入。<strong>sf</strong>提供了<code>aggregate.sf()</code>方法，当<code>x</code>是一个<code>sf</code>对象且提供了一个<code>by</code>参数时，它会自动激活：</p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line">world_agg2 <span class="operator">=</span> aggregate<span class="punctuation">(</span>world<span class="punctuation">[</span><span class="string">&quot;pop&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span> <span class="built_in">list</span><span class="punctuation">(</span>world<span class="operator">$</span>continent<span class="punctuation">)</span><span class="punctuation">,</span> FUN <span class="operator">=</span> <span class="built_in">sum</span><span class="punctuation">,</span> </span><br><span class="line">                       na.rm <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span></span><br><span class="line"><span class="built_in">class</span><span class="punctuation">(</span>world_agg2<span class="punctuation">)</span></span><br><span class="line"><span class="comment">#&gt; [1] &quot;sf&quot;         &quot;data.frame&quot;</span></span><br><span class="line">nrow<span class="punctuation">(</span>world_agg2<span class="punctuation">)</span></span><br><span class="line"><span class="comment">#&gt; [1] 8</span></span><br></pre></td></tr></table></figure>
<p>由此产生的<code>world_agg2</code>对象是一个包含8个特征的空间对象，这些特征代表世界的大陆(和开放的海洋)。</p>
<p><code>group_by() |&gt; summarize()</code>是 <strong>dplyr</strong> 中与<code>aggregate()</code>等效的函数，其中在<code>group_by()</code>函数中提供的变量名称指定了分组变量，而对要进行汇总的信息则是通过传递给 <code>summarize()</code>函数来指定的，如下所示：</p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line">world_agg3 <span class="operator">=</span> world <span class="operator">|&gt;</span></span><br><span class="line">  group_by<span class="punctuation">(</span>continent<span class="punctuation">)</span> <span class="operator">|&gt;</span></span><br><span class="line">  summarize<span class="punctuation">(</span>pop <span class="operator">=</span> <span class="built_in">sum</span><span class="punctuation">(</span>pop<span class="punctuation">,</span> na.rm <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<p>这种方法可能看起来更复杂，但它具有以下好处：灵活性、可读性以及对新列名称的控制。下面的命令示例展示了这种灵活性，它不仅计算了人口数量，还计算了每个大洲的面积和国家数量：</p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line">world_agg4  <span class="operator">=</span> world <span class="operator">|&gt;</span> </span><br><span class="line">  group_by<span class="punctuation">(</span>continent<span class="punctuation">)</span> <span class="operator">|&gt;</span> </span><br><span class="line">  summarize<span class="punctuation">(</span>Pop <span class="operator">=</span> <span class="built_in">sum</span><span class="punctuation">(</span>pop<span class="punctuation">,</span> na.rm <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span><span class="punctuation">,</span> Area <span class="operator">=</span> <span class="built_in">sum</span><span class="punctuation">(</span>area_km2<span class="punctuation">)</span><span class="punctuation">,</span> N <span class="operator">=</span> n<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<p>在前一个代码块中，<code>Pop</code>、<code>Area</code>和<code>N</code>是结果中的列名，<code>sum()</code>和<code>n()</code>是聚合函数。这些聚合函数返回的<code>sf</code>对象具有以大洲表示的行和包含每个陆地和相关岛屿的多个多边形的几何信息（这得益于几何操作<strong>union</strong>，如几何合并节所述）。</p>
<p>让我们结合目前已经学习到的<strong>dplyr</strong>函数知识，通过将多个命令链接起来以总结全球各大洲的属性数据。以下命令使用<code>mutate()</code>函数计算人口密度，使用<code>dplyr::arrange()</code>函数按国家数量排列大洲，使用<code>dplyr::slice_max()</code>函数保留人口最多的3个洲，并呈现结果简单表格：</p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line">world_agg5 <span class="operator">=</span> world <span class="operator">|&gt;</span> </span><br><span class="line">  st_drop_geometry<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">|&gt;</span>                      <span class="comment"># 去掉几何</span></span><br><span class="line">  select<span class="punctuation">(</span>pop<span class="punctuation">,</span> continent<span class="punctuation">,</span> area_km2<span class="punctuation">)</span> <span class="operator">|&gt;</span>        <span class="comment"># 提取子集  </span></span><br><span class="line">  group_by<span class="punctuation">(</span>continent<span class="punctuation">)</span> <span class="operator">|&gt;</span>                     <span class="comment"># 分组、汇总</span></span><br><span class="line">  summarize<span class="punctuation">(</span>Pop <span class="operator">=</span> <span class="built_in">sum</span><span class="punctuation">(</span>pop<span class="punctuation">,</span> na.rm <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span><span class="punctuation">,</span> Area <span class="operator">=</span> <span class="built_in">sum</span><span class="punctuation">(</span>area_km2<span class="punctuation">)</span><span class="punctuation">,</span> N <span class="operator">=</span> n<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">|&gt;</span></span><br><span class="line">  mutate<span class="punctuation">(</span>Density <span class="operator">=</span> <span class="built_in">round</span><span class="punctuation">(</span>Pop <span class="operator">/</span> Area<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">|&gt;</span>     <span class="comment"># 计算人口密度</span></span><br><span class="line">  slice_max<span class="punctuation">(</span>Pop<span class="punctuation">,</span> n <span class="operator">=</span> <span class="number">3</span><span class="punctuation">)</span> <span class="operator">|&gt;</span>                   <span class="comment"># 保留最大的3行</span></span><br><span class="line">  arrange<span class="punctuation">(</span>desc<span class="punctuation">(</span>N<span class="punctuation">)</span><span class="punctuation">)</span>                           <span class="comment"># 国家数量降序</span></span><br></pre></td></tr></table></figure>
<p>Table: The top 3 most populous continents ordered by number of countries.</p>
<table>
<thead>
<tr>
<th>continent</th>
<th>Pop</th>
<th>Area</th>
<th>N</th>
<th>Density</th>
</tr>
</thead>
<tbody>
<tr>
<td>Africa</td>
<td>1154946633</td>
<td>29946198</td>
<td>51</td>
<td>39</td>
</tr>
<tr>
<td>Asia</td>
<td>4311408059</td>
<td>31252459</td>
<td>47</td>
<td>138</td>
</tr>
<tr>
<td>Europe</td>
<td>669036256</td>
<td>23065219</td>
<td>39</td>
<td>29</td>
</tr>
</tbody>
</table>
<blockquote>
<p>更多细节可在帮助页面中查看（可通过<code>?summarize</code>和<code>vignette(package = &quot;dplyr&quot;)</code>访问）以及<a href="http://r4ds.had.co.nz/transform.html#grouped-summaries-with-summarize" title="R for Data Science">R for Data Science</a>第5章。</p>
</blockquote>
<h2 id="矢量属性连接"><a class="markdownIt-Anchor" href="#矢量属性连接"></a> 矢量属性连接</h2>
<p>在数据准备中，合并不同来源的数据是一种常见的任务。连接（<strong>Join</strong>）函数通过基于共享的&quot;key&quot;变量来合并表格。<strong>dplyr</strong>有多个连接函数，包括<code>left_join()</code>和<code>inner_join()</code>，详见<code>vignette(&quot;two-table&quot;)</code>以获取完整列表。这些函数名称遵循数据库语言<a href="http://r4ds.had.co.nz/relational-data.html" title="SQL">SQL</a>中使用的惯例。本部分重点讨论将非空间数据集与<code>sf</code>对象连接的过程。<strong>dplyr连接函数</strong>在数据框和<code>sf</code>对象上的操作相同，唯一重要的区别是<code>geometry</code>列表列。数据合并的结果可以是<code>sf</code>或<code>data.frame</code>对象。在空间数据中，最常见的属性合并类型是将<code>sf</code>对象作为第一个参数，并从作为第二个参数指定的<code>data.frame</code>中添加列。</p>
<p>为了展示连接，我们将把咖啡生产数据和<code>world</code>数据集合并。咖啡数据存储在一个名为<code>coffee_data</code>的数据框中，来自<strong>spData</strong>包（详情请参见<code>?coffee_data</code>）。它有3列：<code>name_long</code>列记录主要咖啡生产国家的名称，<code>coffee_production_2016</code>和<code>coffee_production_2017</code>列分别包含每年以60公斤袋为单位的咖啡生产估值。'left join’保留第一个数据集，将<code>world</code>与<code>coffee_data</code>合并：</p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line">world_coffee <span class="operator">=</span> left_join<span class="punctuation">(</span>world<span class="punctuation">,</span> coffee_data<span class="punctuation">)</span></span><br><span class="line"><span class="comment">#&gt; Joining with `by = join_by(name_long)`</span></span><br><span class="line"><span class="built_in">class</span><span class="punctuation">(</span>world_coffee<span class="punctuation">)</span></span><br><span class="line"><span class="comment">#&gt; [1] &quot;sf&quot;         &quot;tbl_df&quot;     &quot;tbl&quot;        &quot;data.frame&quot;</span></span><br></pre></td></tr></table></figure>
<p>由于输入数据集共享’key variable’（<code>name_long</code>），因此连接操作可以在不使用<code>by</code>参数的情况下完成（有关详细信息，请参见<code>?left_join</code>）。结果是一个与原始<code>world</code>对象相同的<code>sf</code>对象，但具有两个新变量（列索引为11和12）的咖啡产量。这可以绘制成地图，如下<a href="https://scy11.oss-cn-beijing.aliyuncs.com/img/202308230009131.png" title="🖼️ 图片">🖼️ 图片</a>的<code>plot()</code>函数所示：</p>
<p><img data-src="https://scy11.oss-cn-beijing.aliyuncs.com/img/202308230009131.png" alt="" /></p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line"><span class="built_in">names</span><span class="punctuation">(</span>world_coffee<span class="punctuation">)</span></span><br><span class="line"><span class="comment">#&gt;  [1] &quot;iso_a2&quot;                 &quot;name_long&quot;              &quot;continent&quot;             </span></span><br><span class="line"><span class="comment">#&gt;  [4] &quot;region_un&quot;              &quot;subregion&quot;              &quot;type&quot;                  </span></span><br><span class="line"><span class="comment">#&gt;  [7] &quot;area_km2&quot;               &quot;pop&quot;                    &quot;lifeExp&quot;               </span></span><br><span class="line"><span class="comment">#&gt; [10] &quot;gdpPercap&quot;              &quot;geom&quot;                   &quot;coffee_production_2016&quot;</span></span><br><span class="line"><span class="comment">#&gt; [13] &quot;coffee_production_2017&quot;</span></span><br><span class="line">plot<span class="punctuation">(</span>world_coffee<span class="punctuation">[</span><span class="string">&quot;coffee_production_2017&quot;</span><span class="punctuation">]</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<p>为了使连接生效，两个数据集都必须提供’key variable’ 。默认情况下，<strong>dplyr</strong>会使用所有名称匹配的变量。在这种情况下，<code>world_coffee</code>和<code>world</code>两个对象都包含一个名为<code>name_long</code>的变量，这解释了信息<code>Joining with</code> <code>by = join_by(name_long)</code>。在大多数名称不同的情况下，您有两个选项：</p>
<ol>
<li>重命名某个对象中的key variable，使其与其他对象匹配。</li>
<li>使用<code>by</code>参数指明连接变量。</li>
</ol>
<p>后一种方法在<code>coffee_data</code>的重命名版本中演示如下:</p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line">coffee_renamed <span class="operator">=</span> rename<span class="punctuation">(</span>coffee_data<span class="punctuation">,</span> nm <span class="operator">=</span> name_long<span class="punctuation">)</span></span><br><span class="line">world_coffee2 <span class="operator">=</span> left_join<span class="punctuation">(</span>world<span class="punctuation">,</span> coffee_renamed<span class="punctuation">,</span> by <span class="operator">=</span> join_by<span class="punctuation">(</span>name_long <span class="operator">==</span> nm<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">world_coffee100 <span class="operator">=</span> left_join<span class="punctuation">(</span>world<span class="punctuation">,</span> coffee_renamed<span class="punctuation">,</span> by <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;name_long&quot;</span> <span class="operator">=</span> <span class="string">&quot;nm&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<p>请注意，在原始对象中保留名称，意味着<code>world_coffee</code>和新对象<code>world_coffee2</code>是相同的。结果的另一个特点是具有与原始数据集相同的行数。尽管<code>coffee_data</code>中仅有47行数据，但<code>world_coffee</code>和<code>world_coffee2</code>中保留了所有177个国家记录：在原始数据集中没有匹配的行会被赋予新咖啡生产变量的<code>NA</code>值。如果我们只想保留具有键变量匹配的国家怎么办？在这种情况下，可以使用<strong>内连接</strong>：</p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line">world_coffee_inner <span class="operator">=</span> inner_join<span class="punctuation">(</span>world<span class="punctuation">,</span> coffee_data<span class="punctuation">)</span></span><br><span class="line"><span class="comment">#&gt; Joining with `by = join_by(name_long)`</span></span><br><span class="line">nrow<span class="punctuation">(</span>world_coffee_inner<span class="punctuation">)</span></span><br><span class="line"><span class="comment">#&gt; [1] 45</span></span><br></pre></td></tr></table></figure>
<p><code>inner_join()</code>的结果只有45行，而<code>coffee_data</code>中有47行。剩下的行发生了什么？我们可以使用<code>setdiff()</code>函数来<strong>识别未匹配行</strong>，如下所示：</p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line">setdiff<span class="punctuation">(</span>coffee_data<span class="operator">$</span>name_long<span class="punctuation">,</span> world<span class="operator">$</span>name_long<span class="punctuation">)</span></span><br><span class="line"><span class="comment">#&gt; [1] &quot;Congo, Dem. Rep. of&quot; &quot;Others&quot;</span></span><br></pre></td></tr></table></figure>
<p>结果显示，<code>Others</code>占据了<code>world</code>数据集中不存在的一行，而<code>Democratic Republic of the Congo</code>的名称占据了另一行: 名称缩写，导致连接错误。下面的命令使用<strong>stringr</strong>包中的字符串匹配（<em>regex</em>）函数来确认<code>Congo, Dem. Rep. of</code>应为:</p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line">drc <span class="operator">=</span> stringr<span class="operator">::</span>str_subset<span class="punctuation">(</span>world<span class="operator">$</span>name_long<span class="punctuation">,</span> <span class="string">&quot;Dem*.+Congo&quot;</span><span class="punctuation">)</span></span><br><span class="line">drc</span><br><span class="line"><span class="comment">#&gt; [1] &quot;Democratic Republic of the Congo&quot;</span></span><br></pre></td></tr></table></figure>
<p>为了解决这个问题，我们将创建一个新版本的<code>coffee_data</code>并更新名称。<code>inner_join()</code>更新后的数据框返回一个包含所有46个咖啡生产国的结果:</p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line">coffee_data<span class="operator">$</span>name_long<span class="punctuation">[</span>grepl<span class="punctuation">(</span><span class="string">&quot;Congo,&quot;</span><span class="punctuation">,</span> coffee_data<span class="operator">$</span>name_long<span class="punctuation">)</span><span class="punctuation">]</span> <span class="operator">=</span> drc</span><br><span class="line">world_coffee_match <span class="operator">=</span> inner_join<span class="punctuation">(</span>world<span class="punctuation">,</span> coffee_data<span class="punctuation">)</span></span><br><span class="line"><span class="comment">#&gt; Joining with `by = join_by(name_long)`</span></span><br><span class="line">nrow<span class="punctuation">(</span>world_coffee_match<span class="punctuation">)</span></span><br><span class="line"><span class="comment">#&gt; [1] 46</span></span><br></pre></td></tr></table></figure>
<p>也可以从另一个方向连接：从非空间数据集开始，并从简单要素对象中添加变量。下面演示了这一点，从<code>coffee_data</code>对象开始，并从原始<code>world</code>数据集中添加变量。与前面的连接相比，结果<strong>不是</strong>另一个简单要素对象，而是一个<strong>tidyverse</strong>数据框格式的tibble。连接的输出往往与其第一个参数相匹配：</p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line">coffee_world <span class="operator">=</span> left_join<span class="punctuation">(</span>coffee_data<span class="punctuation">,</span> world<span class="punctuation">)</span></span><br><span class="line"><span class="comment">#&gt; Joining with `by = join_by(name_long)`</span></span><br><span class="line"><span class="built_in">class</span><span class="punctuation">(</span>coffee_world<span class="punctuation">)</span></span><br><span class="line"><span class="comment">#&gt; [1] &quot;tbl_df&quot;     &quot;tbl&quot;        &quot;data.frame&quot;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>📌在大多数情况下，几何列只在<code>sf</code>对象中有用。<br />
只有当R“知道”它是由如<code>sf</code>等空间包定义的空间对象时，几何列才能用于创建地图和空间操作。<br />
幸运的是，具有几何列表列（如<code>coffee_world</code>）的非空间数据框可以如下方式强制转换为<code>sf</code>对象：<code>st_as_sf(coffee_world)</code>。</p>
</blockquote>
<p>本节涵盖了大部分的连接使用情况。如需更多信息，我们建议阅读<a href="https://r4ds.had.co.nz/relational-data.html?q=join#relational-data" title="Relational data">Relational data</a>章节，本书附带的<strong>geocompkg</strong>包中的<a href="https://geocompx.github.io/geocompkg/articles/join.html" title="join vignette">join vignette</a>，以及描述<strong>data.table</strong>和其他包中的连接方法的文档。<strong>空间连接</strong>将在下一章<em>空间连接</em>中讲述。</p>
<h2 id="创建属性移除空间信息"><a class="markdownIt-Anchor" href="#创建属性移除空间信息"></a> 创建属性移除空间信息</h2>
<p>通常，我们想要根据已有的列创建新的列。例如，我们想要计算每个国家的人口密度。为此，我们需要将一个人口列（这里是<code>pop</code>）除以一个面积列（这里是<code>area_km2</code>），其中单位面积为平方千米。使用基础R，我们可以输入：</p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line">world_new <span class="operator">=</span> world <span class="comment"># 不要覆盖原始数据</span></span><br><span class="line">world_new<span class="operator">$</span>pop_dens <span class="operator">=</span> world_new<span class="operator">$</span>pop <span class="operator">/</span> world_new<span class="operator">$</span>area_km2</span><br></pre></td></tr></table></figure>
<p>另外，我们还可以使用<strong>dplyr</strong>函数-<code>mutate()</code>或<code>transmute()</code>。<code>mutate()</code>在<code>sf</code>对象的倒数第二个位置添加新的列（最后一个位置是保留给几何图形的）：</p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line">world_new2 <span class="operator">=</span> world <span class="operator">|&gt;</span> </span><br><span class="line">  mutate<span class="punctuation">(</span>pop_dens <span class="operator">=</span> pop <span class="operator">/</span> area_km2<span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<p><code>mutate()</code>和<code>transmute()</code>的区别在于<code>transmute()</code>会删除所有其他已存在的列（除了<strong>sticky geometry</strong>列）。</p>
<p><code>unite()</code>函数来自<strong>tidyr</strong>包（该包提供了许多重塑数据集的有用函数，包括<code>pivot_longer()</code>），<code>unite()</code>函数将现有的列拼接在一起。例如我们想要将<code>continent</code>和<code>region_un</code>列合并成一个名为<code>con_reg</code>的新列。另外，我们可以定义一个分隔符（这里是冒号<code>:</code>），用于定义输入列的值应该如何拼接，并且确定是否删除原始列（这里是<code>TRUE</code>）。</p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line">world_unite <span class="operator">=</span> world <span class="operator">|&gt;</span></span><br><span class="line">  tidyr<span class="operator">::</span>unite<span class="punctuation">(</span><span class="string">&quot;con_reg&quot;</span><span class="punctuation">,</span> continent<span class="operator">:</span>region_un<span class="punctuation">,</span> sep <span class="operator">=</span> <span class="string">&quot;:&quot;</span><span class="punctuation">,</span> remove <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<p>生成的<code>sf</code>对象有一个名为<code>con_reg</code>的新列，代表每个国家的大陆和地区，例如，<code>South America:Americas</code>代表阿根廷和其他南美洲国家。<strong>tidyr</strong> 的<code>separate()</code>函数的作用与<code>unite()</code>相反: 它使用正则表达式或字符位置将一列拆分为多列。</p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line">world_separate <span class="operator">=</span> world_unite <span class="operator">|&gt;</span></span><br><span class="line">  tidyr<span class="operator">::</span>separate<span class="punctuation">(</span>con_reg<span class="punctuation">,</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;continent&quot;</span><span class="punctuation">,</span> <span class="string">&quot;region_un&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> sep <span class="operator">=</span> <span class="string">&quot;:&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<p><strong>dplyr函数</strong><code>rename()</code>和基础 R 中的<code>setNames()</code>函数用于重命名列变量。<code>rename()</code>函数用新名称代替就名称。例如，下面的命令重命名<code>name_long</code>列为<code>name</code>：</p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line">world <span class="operator">|&gt;</span> </span><br><span class="line">  rename<span class="punctuation">(</span>name <span class="operator">=</span> name_long<span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<p><code>setNames()</code>函数一次性改变全部列名，并需要一个与各列匹配的字符向量。下面的示例说明了这一点，输出相同的<code>world</code>对象，但列名变得非常简单：</p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line">new_names <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;i&quot;</span><span class="punctuation">,</span> <span class="string">&quot;n&quot;</span><span class="punctuation">,</span> <span class="string">&quot;c&quot;</span><span class="punctuation">,</span> <span class="string">&quot;r&quot;</span><span class="punctuation">,</span> <span class="string">&quot;s&quot;</span><span class="punctuation">,</span> <span class="string">&quot;t&quot;</span><span class="punctuation">,</span> <span class="string">&quot;a&quot;</span><span class="punctuation">,</span> <span class="string">&quot;p&quot;</span><span class="punctuation">,</span> <span class="string">&quot;l&quot;</span><span class="punctuation">,</span> <span class="string">&quot;gP&quot;</span><span class="punctuation">,</span> <span class="string">&quot;geom&quot;</span><span class="punctuation">)</span></span><br><span class="line">world_new_names <span class="operator">=</span> world <span class="operator">|&gt;</span></span><br><span class="line">  setNames<span class="punctuation">(</span>new_names<span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<p>每个属性数据操作都保留简单要素的几何特征。有时候去除几何特征是有意义的。例如，为了加快聚合速度。请使用<code>st_drop_geometry()</code>进行操作，而不是手动使用诸如<code>select(world, -geom)</code>等命令，如下所示。</p>
<p><code>st_geometry(world_st) = NULL</code> also works to remove the geometry from <code>world</code>, but overwrites the original object.</p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line">world_data <span class="operator">=</span> world <span class="operator">|&gt;</span> st_drop_geometry<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"><span class="built_in">class</span><span class="punctuation">(</span>world_data<span class="punctuation">)</span></span><br><span class="line"><span class="comment">#&gt; [1] &quot;tbl_df&quot;     &quot;tbl&quot;     &quot;data.frame&quot;</span></span><br></pre></td></tr></table></figure>
<h1 id="栅格数据操作"><a class="markdownIt-Anchor" href="#栅格数据操作"></a> 栅格数据操作</h1>
<p>与简单要素基础下的矢量数据模型相反（它将点、线和多边形表示为空间中的离散实体），栅格数据表示连续表面。本节将展示如何<em>从头</em>开始创建栅格对象，并基于<em>terra介绍</em>章节进行构建。由于它们独特的结构，对栅格数据集的子集提取和其他操作以不同的方式进行，在栅格数据提取子集章节中展示。</p>
<p>以下代码重新创建了在<em>栅格类</em>节使用的栅格数据集，其结果在<a href="https://scy11.oss-cn-beijing.aliyuncs.com/img/202308230031352.png" title="🖼️ 图片">🖼️ 图片</a>中展示。这展示了<code>rast()</code>函数如何工作来创建一个名为<code>elev</code>的示例栅格（表示高程）的示例。</p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line">elev <span class="operator">=</span> rast<span class="punctuation">(</span>nrows <span class="operator">=</span> <span class="number">6</span><span class="punctuation">,</span> ncols <span class="operator">=</span> <span class="number">6</span><span class="punctuation">,</span></span><br><span class="line">            xmin <span class="operator">=</span> <span class="operator">-</span><span class="number">1.5</span><span class="punctuation">,</span> xmax <span class="operator">=</span> <span class="number">1.5</span><span class="punctuation">,</span> ymin <span class="operator">=</span> <span class="operator">-</span><span class="number">1.5</span><span class="punctuation">,</span> ymax <span class="operator">=</span> <span class="number">1.5</span><span class="punctuation">,</span></span><br><span class="line">            vals <span class="operator">=</span> <span class="number">1</span><span class="operator">:</span><span class="number">36</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<p><img data-src="https://scy11.oss-cn-beijing.aliyuncs.com/img/202308230031352.png" alt="" /></p>
<p>结果是一个具有6行和6列的栅格对象（由<code>nrow</code>和<code>ncol</code>参数指定），以及x和y方向上的最小和最大空间范围（<code>xmin</code>，<code>xmax</code>，<code>ymin</code>，<code>ymax</code>）。<code>vals</code>参数设置每个单元格包含的值：在这种情况下，是从1到36的数值数据。Raster对象还可以包含在R中<code>logical</code>或<code>factor</code>类变量形式表示的分类值。以下代码创建了图所示的栅格数据集：</p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line">grain_order <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;clay&quot;</span><span class="punctuation">,</span> <span class="string">&quot;silt&quot;</span><span class="punctuation">,</span> <span class="string">&quot;sand&quot;</span><span class="punctuation">)</span></span><br><span class="line">grain_char <span class="operator">=</span> sample<span class="punctuation">(</span>grain_order<span class="punctuation">,</span> <span class="number">36</span><span class="punctuation">,</span> replace <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span></span><br><span class="line">grain_fact <span class="operator">=</span> factor<span class="punctuation">(</span>grain_char<span class="punctuation">,</span> levels <span class="operator">=</span> grain_order<span class="punctuation">)</span></span><br><span class="line">grain <span class="operator">=</span> rast<span class="punctuation">(</span>nrows <span class="operator">=</span> <span class="number">6</span><span class="punctuation">,</span> ncols <span class="operator">=</span> <span class="number">6</span><span class="punctuation">,</span> </span><br><span class="line">             xmin <span class="operator">=</span> <span class="operator">-</span><span class="number">1.5</span><span class="punctuation">,</span> xmax <span class="operator">=</span> <span class="number">1.5</span><span class="punctuation">,</span> ymin <span class="operator">=</span> <span class="operator">-</span><span class="number">1.5</span><span class="punctuation">,</span> ymax <span class="operator">=</span> <span class="number">1.5</span><span class="punctuation">,</span></span><br><span class="line">             vals <span class="operator">=</span> grain_fact<span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<p>栅格对象将相应的查找表或&quot;栅格属性表&quot;（RAT）存储为数据框列表，可以使用<code>cats(grain)</code>查看（有关更多信息，请参见<code>?cats()</code>）。该列表的每个元素都是一个栅格层。还可以使用<code>levels()</code>函数检索和添加新的或替换现有的因子级别：</p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line">levels<span class="punctuation">(</span>grain<span class="punctuation">)</span> <span class="operator">=</span> data.frame<span class="punctuation">(</span>value <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">)</span><span class="punctuation">,</span> wetness <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;wet&quot;</span><span class="punctuation">,</span> <span class="string">&quot;moist&quot;</span><span class="punctuation">,</span> <span class="string">&quot;dry&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">levels<span class="punctuation">(</span>grain<span class="punctuation">)</span></span><br><span class="line"><span class="comment">#&gt; [[1]]</span></span><br><span class="line"><span class="comment">#&gt;   value wetness</span></span><br><span class="line"><span class="comment">#&gt; 1     0     wet</span></span><br><span class="line"><span class="comment">#&gt; 2     1   moist</span></span><br><span class="line"><span class="comment">#&gt; 3     2     dry</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>📌分类栅格对象还可以使用颜色表存储与每个值相关联的颜色信息。<br />
颜色表是一个数据框，有三个（红色、绿色、蓝色）或四个（Alpha）列，其中每一行与一个值相关联。<br />
在<strong>terra</strong>中，可以使用<code>coltab()</code>函数查看或设置颜色表（请参阅 <code>?coltab</code>）。<br />
需要注意的是，将带有颜色表的栅格对象保存到文件（例如GeoTIFF）中也会保存颜色信息。</p>
</blockquote>
<h2 id="栅格数据提取子集"><a class="markdownIt-Anchor" href="#栅格数据提取子集"></a> 栅格数据提取子集</h2>
<p>用基础R中的<code>[</code>操作符提取栅格数据子集，改运算符接受多种输入：</p>
<ul>
<li>行-列索引</li>
<li>单元格 IDs</li>
<li>坐标系（见<em>空间栅格子集提取</em>节）</li>
<li>其他的空间对象（见<em>空间栅格子集提取</em>节）</li>
</ul>
<p>在这里，我们只展示前两个选项，因为它们可以被视为非空间操作。如果我们需要一个空间对象来对另一个对象进行子集提取，或者输出是一个空间对象，我们将其称为空间子集操作。因此，后两个选项将在下一章中进行展示（见<em>空间栅格子集提取</em>节）。</p>
<p>前两个子集操作选项在下面的命令中进行了演示——两者都返回栅格对象<code>elev</code>中左上角像素的值（结果未显示）：</p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line"><span class="comment"># row 1, column 1</span></span><br><span class="line">elev<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">]</span></span><br><span class="line"><span class="comment"># cell ID 1</span></span><br><span class="line">elev<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span></span><br></pre></td></tr></table></figure>
<p>多层栅格对象的子集提取将返回每层的单元格值。例如，<code>two_layers = c(grain, elev)</code>；<code>two_layers[1]</code>返回一个包含一行两列的数据框架——每层一列。若要提取所有值或完整行，还可以使用<code>values()</code>。</p>
<p>可以通过与子集提取操作一起覆盖现有值来修改单元格值。例如，下面的代码块将<code>elev</code>的左上单元格设置为0（结果未显示）：</p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line">elev<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">elev<span class="punctuation">[</span><span class="punctuation">]</span></span><br></pre></td></tr></table></figure>
<p>留空方括号是使用<code>values()</code>检索栅格的所有值的快捷方式，通过此方式也可以修改多个单元格:</p>
<p>替换多层栅格的值可以使用矩阵，其列数与层数相同，行数与可替换单元格数相同（结果未显示）：</p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line">two_layers <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span>grain<span class="punctuation">,</span> elev<span class="punctuation">)</span> </span><br><span class="line">two_layers<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="operator">=</span> cbind<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">4</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">two_layers<span class="punctuation">[</span><span class="punctuation">]</span></span><br></pre></td></tr></table></figure>
<h2 id="栅格数据汇总"><a class="markdownIt-Anchor" href="#栅格数据汇总"></a> 栅格数据汇总</h2>
<p>terra包含提取整个栅格数据描述性统计信息的功能。通过输入栅格对象的名称并将其打印到控制台，可以返回栅格的最小值和最大值。<code>summary()</code>提供了常见的描述性统计量——最小值、最大值、四分位数以及连续型栅格<code>NA</code>的数量，以及分类型栅格中每个类别的单元格数量。进一步的总结操作，例如标准偏差（见下文）或自定义总结统计量，可以通过<code>global()</code>计算得出。</p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line">global<span class="punctuation">(</span>elev<span class="punctuation">,</span> sd<span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>如果您向<code>summary()</code>和<code>global()</code>函数提供一个多层栅格对象，它们将分别总结每一个层次，可以通过运行以下命令进行演示：<code>summary(c(elev, grain))</code>。</p>
</blockquote>
<p>此外，<code>freq()</code>函数允许获取分类值的频率表。栅格值统计可以以多种方式进行可视化。特定的函数，如<code>boxplot()</code>、<code>density()</code>、<code>hist()</code>和<code>pairs()</code>也适用于栅格对象，如下方命令创建的直方图所示（未显示）：</p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line">hist<span class="punctuation">(</span>elev<span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<p>如果所需的可视化函数无法与栅格对象一起使用，可以使用<code>values()</code>函数提取要绘制的栅格数据（参见栅格数据提取子集节）。</p>
<p>描述性栅格统计属于所谓的<strong>全局</strong>栅格操作。这些以及其他典型的栅格处理操作是<strong>地图代数</strong>方案的一部分，将在下一章（<em>地图代数</em>节）中介绍。</p>
<blockquote>
<p>📌一些函数名在包之间发生了冲突（例如，<code>extract()</code>函数在<strong>terra</strong>和<strong>tidyr</strong>包中都有）。<br />
除了不通过引用函数来加载包（例如，<code>tidyr::extract()</code>），还有一种避免函数名冲突的方法是使用<code>detach()</code>取消加载引起问题的包。<br />
例如，下面的命令可以卸载<code>terra</code>包（这也可以在 RStudio的默认右下角窗格中的<em>package</em>选项卡中完成）：<code>detach(&quot;package:terra&quot;, unload = TRUE, force = TRUE)</code>。在使用<code>force</code>参数时，即使其他包依赖于该包，也可以确保分离该包。<br />
然而，这可能会导致依赖于已分离包的包受到限制的可用性，因此不建议使用该参数。</p>
</blockquote>
<h2 id="练习"><a class="markdownIt-Anchor" href="#练习"></a> 练习</h2>
<p>For these exercises we will use the <code>us_states</code> and <code>us_states_df</code> datasets from the <strong>spData</strong> package.<br />
You must have attached the package, and other packages used in the attribute operations chapter (<strong>sf</strong>, <strong>dplyr</strong>, <strong>terra</strong>) with commands such as <code>library(spData)</code> before attempting these exercises:</p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line">library<span class="punctuation">(</span>sf<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>dplyr<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>terra<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>spData<span class="punctuation">)</span></span><br><span class="line">data<span class="punctuation">(</span>us_states<span class="punctuation">)</span></span><br><span class="line">data<span class="punctuation">(</span>us_states_df<span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<p><code>us_states</code> is a spatial object (of class <code>sf</code>), containing geometry and a few attributes (including name, region, area, and population) of states within the contiguous United States.<br />
<code>us_states_df</code> is a data frame (of class <code>data.frame</code>) containing the name and additional variables (including median income and poverty level, for the years 2010 and 2015) of US states, including Alaska, Hawaii and Puerto Rico.<br />
The data comes from the United States Census Bureau, and is documented in <code>?us_states</code> and <code>?us_states_df</code>.</p>
<p>E1. Create a new object called <code>us_states_name</code> that contains only the <code>NAME</code> column from the <code>us_states</code> object using either base R (<code>[</code>) or tidyverse (<code>select()</code>) syntax.<br />
What is the class of the new object and what makes it geographic?</p>
<p>E2. Select columns from the <code>us_states</code> object which contain population data.<br />
Obtain the same result using a different command (bonus: try to find three ways of obtaining the same result).<br />
Hint: try to use helper functions, such as <code>contains</code> or <code>matches</code> from <strong>dplyr</strong> (see <code>?contains</code>).</p>
<p>E3. Find all states with the following characteristics (bonus find <em>and</em> plot them):</p>
<ul>
<li>Belong to the Midwest region.</li>
<li>Belong to the West region, have an area below 250,000 km<sup>2</sup> <em>and</em> in 2015 a population greater than 5,000,000 residents (hint: you may need to use the function <code>units::set_units()</code> or <code>as.numeric()</code>).</li>
<li>Belong to the South region, had an area larger than 150,000 km<sup>2</sup> or a total population in 2015 larger than 7,000,000 residents.</li>
</ul>
<p>E4. What was the total population in 2015 in the <code>us_states</code> dataset?<br />
What was the minimum and maximum total population in 2015?</p>
<p>E5. How many states are there in each region?</p>
<p>E6. What was the minimum and maximum total population in 2015 in each region?<br />
What was the total population in 2015 in each region?</p>
<p>E7. Add variables from <code>us_states_df</code> to <code>us_states</code>, and create a new object called <code>us_states_stats</code>.<br />
What function did you use and why?<br />
Which variable is the key in both datasets?<br />
What is the class of the new object?</p>
<p>E8. <code>us_states_df</code> has two more rows than <code>us_states</code>.<br />
How can you find them? (hint: try to use the <code>dplyr::anti_join()</code> function)</p>
<p>E9. What was the population density in 2015 in each state?<br />
What was the population density in 2010 in each state?</p>
<p>E10. How much has population density changed between 2010 and 2015 in each state?<br />
Calculate the change in percentages and map them.</p>
<p>E11. Change the columns’ names in <code>us_states</code> to lowercase. (Hint: helper functions - <code>tolower()</code> and <code>colnames()</code> may help.)</p>
<p>E12. Using <code>us_states</code> and <code>us_states_df</code> create a new object called <code>us_states_sel</code>.<br />
The new object should have only two variables - <code>median_income_15</code> and <code>geometry</code>.<br />
Change the name of the <code>median_income_15</code> column to <code>Income</code>.</p>
<p>E13. Calculate the change in the number of residents living below the poverty level between 2010 and 2015 for each state. (Hint: See ?us_states_df for documentation on the poverty level columns.)<br />
Bonus: Calculate the change in the <em>percentage</em> of residents living below the poverty level in each state.</p>
<p>E14. What was the minimum, average and maximum state’s number of people living below the poverty line in 2015 for each region?<br />
Bonus: What is the region with the largest increase in people living below the poverty line?</p>
<p>E15. Create a raster from scratch with nine rows and columns and a resolution of 0.5 decimal degrees (WGS84).<br />
Fill it with random numbers.<br />
Extract the values of the four corner cells.</p>
<p>E16. What is the most common class of our example raster <code>grain</code>?</p>
<p>E17. Plot the histogram and the boxplot of the <code>dem.tif</code> file from the <strong>spDataLarge</strong> package (<code>system.file(&quot;raster/dem.tif&quot;, package = &quot;spDataLarge&quot;)</code>).</p>
]]></content>
      <categories>
        <category>R</category>
        <category>Geocomputaion</category>
      </categories>
      <tags>
        <tag>R</tag>
        <tag>Geocomputaion</tag>
      </tags>
  </entry>
</search>
